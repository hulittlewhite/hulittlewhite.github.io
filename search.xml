<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®ä¹‹ Spring Security</title>
      <link href="/2023/03/08/community7/"/>
      <url>/2023/03/08/community7/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Spring-Security"><a href="#1-Spring-Security" class="headerlink" title="1. Spring Security"></a>1. Spring Security</h1><ul><li> ç®€ä»‹ ï¼š<ul><li>Spring Security æ˜¯ä¸€ä¸ªä¸“æ³¨äºä¸º Java åº”ç”¨ç¨‹åºæä¾›èº«ä»½è®¤è¯å’Œæˆæƒçš„æ¡†æ¶ï¼Œå…¶å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥è½»æ¾æ‰©å±•ä»¥æ»¡è¶³è‡ªå®šä¹‰éœ€æ±‚ã€‚</li></ul></li><li> ç‰¹å¾ï¼š<ul><li> å¯¹èº«ä»½çš„è®¤è¯ã€æˆæƒæä¾›å…¨é¢çš„ã€å¯æ‰©å±•çš„æ”¯æŒã€‚</li><li> é˜²æ­¢å„ç§æ”»å‡»ï¼Œå¦‚ä¼šè¯å›ºå®šæ”»å‡»ã€ç‚¹å‡»åŠ«æŒã€CSRF æ”»å‡»ç­‰ã€‚</li><li> æ”¯æŒä¸ Servlet APIã€Spring MVC ç­‰ Web æŠ€æœ¯é›†æˆã€‚</li></ul></li></ul><h1 id="2- æƒé™æ§åˆ¶"><a href="#2- æƒé™æ§åˆ¶" class="headerlink" title="2. æƒé™æ§åˆ¶"></a>2. æƒé™æ§åˆ¶ </h1><ul><li> ç™»å½•æ£€æŸ¥ï¼š<ul><li> å¼ƒç”¨åŸå…ˆé‡‡ç”¨çš„æ‹¦æˆªå™¨æ£€æŸ¥ç”¨æˆ·ç™»å½• (è¿‡äºç®€å•)ã€‚</li></ul></li><li> æˆæƒé…ç½®ï¼š<ul><li> å¯¹å½“å‰ç³»ç»Ÿå†…åŒ…å«çš„æ‰€æœ‰çš„è¯·æ±‚ï¼Œåˆ†é…è®¿é—®æƒé™ï¼ˆæ™®é€šç”¨æˆ·ã€ç‰ˆä¸»ã€ç®¡ç†å‘˜ï¼‰ã€‚</li></ul></li><li> è®¤è¯æ–¹æ¡ˆï¼š<ul><li> ç»•è¿‡ Security è®¤è¯æµç¨‹ï¼Œé‡‡ç”¨ç³»ç»ŸåŸæ¥çš„è®¤è¯æ–¹æ¡ˆã€‚</li></ul></li><li>CSRF é…ç½®ï¼š<ul><li> é˜²æ­¢ CSRF æ”»å‡»çš„åŸºæœ¬åŸç†ï¼Œä»¥åŠè¡¨å•ã€AJAX ç›¸å…³çš„é…ç½®ã€‚</li></ul></li></ul><h1 id="3- ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤"><a href="#3- ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤" class="headerlink" title="3. ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤"></a>3. ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤ </h1><ul><li> åŠŸèƒ½å®ç° <ul><li> ç‚¹å‡»æŒ‰é’®â€œç½®é¡¶â€ï¼Œä¿®æ”¹å¸–å­çš„ç±»å‹ã€‚</li><li> ç‚¹å‡»æŒ‰é’®â€œåŠ ç²¾â€ã€â€œåˆ é™¤â€ï¼Œä¿®æ”¹å¸–å­çš„çŠ¶æ€ã€‚</li></ul></li><li> æƒé™ç®¡ç† <ul><li> ç‰ˆä¸»å¯ä»¥æ‰§è¡Œâ€œç½®é¡¶â€ã€â€œåŠ ç²¾â€æ“ä½œã€‚</li><li> ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œâ€œåˆ é™¤â€æ“ä½œã€‚</li></ul></li><li> æŒ‰é’®æ˜¾ç¤º <ul><li> ç‰ˆä¸»å¯ä»¥çœ‹åˆ°â€œç½®é¡¶â€ã€â€œåŠ ç²¾â€æŒ‰é’®ã€‚</li><li> ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°â€œåˆ é™¤â€æŒ‰é’®ã€‚</li></ul></li></ul><h1 id="4-Redis- é«˜çº§æ•°æ®ç±»å‹"><a href="#4-Redis- é«˜çº§æ•°æ®ç±»å‹" class="headerlink" title="4. Redis é«˜çº§æ•°æ®ç±»å‹"></a>4. Redis é«˜çº§æ•°æ®ç±»å‹ </h1><ul><li>HyperLogLog<ul><li> é‡‡ç”¨ä¸€ç§åŸºæ•°ç®—æ³•ï¼Œç”¨äºå®Œæˆç‹¬ç«‹æ€»æ•°çš„ç»Ÿè®¡ã€‚</li><li> å æ®ç©ºé—´å°ï¼Œæ— è®ºç»Ÿè®¡å¤šå°‘ä¸ªæ•°æ®ï¼Œåªå  12K çš„å†…å­˜ç©ºé—´ã€‚</li><li> ä¸ç²¾ç¡®çš„ç»Ÿè®¡ç®—æ³•ï¼Œæ ‡å‡†è¯¯å·®ä¸º 0.81% ã€‚</li></ul></li><li>Bitmap<ul><li> ä¸æ˜¯ä¸€ç§ç‹¬ç«‹çš„æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šå°±æ˜¯å­—ç¬¦ä¸²ã€‚</li><li> æ”¯æŒæŒ‰ä½å­˜å–æ•°æ®ï¼Œå¯ä»¥å°†å…¶çœ‹æˆæ˜¯ byte æ•°ç»„ã€‚</li><li> é€‚åˆå­˜å‚¨ç´¢å¤§é‡çš„è¿ç»­çš„æ•°æ®çš„å¸ƒå°”å€¼ã€‚</li></ul></li></ul><h1 id="5- ç½‘ç«™æ•°æ®ç»Ÿè®¡"><a href="#5- ç½‘ç«™æ•°æ®ç»Ÿè®¡" class="headerlink" title="5. ç½‘ç«™æ•°æ®ç»Ÿè®¡"></a>5. ç½‘ç«™æ•°æ®ç»Ÿè®¡ </h1><ul><li>UVï¼ˆUnique Visitorï¼‰ <ul><li> ç‹¬ç«‹è®¿å®¢ï¼Œéœ€é€šè¿‡ç”¨æˆ· IP æ’é‡ç»Ÿè®¡æ•°æ®ã€‚ </li><li> æ¯æ¬¡è®¿é—®éƒ½è¦è¿›è¡Œç»Ÿè®¡ã€‚ </li><li>HyperLogLog ï¼Œæ€§èƒ½å¥½ï¼Œä¸”å­˜å‚¨ç©ºé—´å°ã€‚</li></ul></li><li>DAUï¼ˆDaily Active Userï¼‰ </li><li> æ—¥æ´»è·ƒç”¨æˆ·ï¼Œéœ€é€šè¿‡ç”¨æˆ· ID æ’é‡ç»Ÿè®¡æ•°æ®ã€‚ </li><li> è®¿é—®è¿‡ä¸€æ¬¡ï¼Œåˆ™è®¤ä¸ºå…¶æ´»è·ƒã€‚ </li><li>Bitmapï¼Œæ€§èƒ½å¥½ã€ä¸”å¯ä»¥ç»Ÿè®¡ç²¾ç¡®çš„ç»“æœã€‚</li></ul><h1 id="6- ä»»åŠ¡æ‰§è¡Œå’Œè°ƒåº¦"><a href="#6- ä»»åŠ¡æ‰§è¡Œå’Œè°ƒåº¦" class="headerlink" title="6. ä»»åŠ¡æ‰§è¡Œå’Œè°ƒåº¦"></a>6. ä»»åŠ¡æ‰§è¡Œå’Œè°ƒåº¦ </h1><ul><li>JDK çº¿ç¨‹æ±  <ul><li>ExcecutorService </li><li>ScheduledExecutorService</li></ul></li><li>Spring çº¿ç¨‹æ±  <ul><li>ThreadPoolTaskExecutor </li><li>ThreadPoolTaskScheduler</li></ul></li><li> åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ <ul><li>Spring Quartz</li></ul></li></ul><h1 id="7- çƒ­å¸–æ’è¡Œ"><a href="#7- çƒ­å¸–æ’è¡Œ" class="headerlink" title="7. çƒ­å¸–æ’è¡Œ"></a>7. çƒ­å¸–æ’è¡Œ </h1><ul><li>Hacker News <ul><li>Score &#x3D; (P-1) &#x2F; (T+2) ^ G</li></ul></li><li>StackOverflow <ul><li>(log(Qviews)*4) + ((Qanswers * Qscore)&#x2F;5) + sum(Ascores)</li><li>((QageInHours + 1) - ((QageInHours - Qupdated)&#x2F;2)) ^ 1.5</li></ul></li><li>School<ul><li>log(ç²¾ååˆ† + è¯„è®ºæ•° * 10 + ç‚¹èµæ•° * 2 + æ”¶è—æ•° * 2) + (å‘å¸ƒæ—¶é—´ â€“ School çºªå…ƒ)</li></ul></li></ul><h1 id="8- ç”Ÿæˆé•¿å›¾"><a href="#8- ç”Ÿæˆé•¿å›¾" class="headerlink" title="8. ç”Ÿæˆé•¿å›¾"></a>8. ç”Ÿæˆé•¿å›¾ </h1><ul><li><p>wkhtmltopdf </p><ul><li>wkhtmltopdf url file </li><li>wkhtmltoimage url file</li></ul></li><li><p>java </p><ul><li>Runtime.getRuntime().exec()</li></ul></li></ul><h1 id="9- å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘æœåŠ¡å™¨"><a href="#9- å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘æœåŠ¡å™¨" class="headerlink" title="9. å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘æœåŠ¡å™¨"></a>9. å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘æœåŠ¡å™¨ </h1><ul><li> å®¢æˆ·ç«¯ä¸Šä¼  <ul><li> å®¢æˆ·ç«¯å°†æ•°æ®æäº¤ç»™äº‘æœåŠ¡å™¨ï¼Œå¹¶ç­‰å¾…å…¶å“åº”ã€‚ </li><li> ç”¨æˆ·ä¸Šä¼ å¤´åƒæ—¶ï¼Œå°†è¡¨å•æ•°æ®æäº¤ç»™äº‘æœåŠ¡å™¨ã€‚</li></ul></li><li> æœåŠ¡å™¨ç›´ä¼  <ul><li> åº”ç”¨æœåŠ¡å™¨å°†æ•°æ®ç›´æ¥æäº¤ç»™äº‘æœåŠ¡å™¨ï¼Œå¹¶ç­‰å¾…å…¶å“åº”ã€‚ </li><li> åˆ†äº«æ—¶ï¼ŒæœåŠ¡ç«¯å°†è‡ªåŠ¨ç”Ÿæˆçš„å›¾ç‰‡ï¼Œç›´æ¥æäº¤ç»™äº‘æœåŠ¡å™¨ã€‚</li></ul></li></ul><h1 id="10- ä¼˜åŒ–ç½‘ç«™çš„æ€§èƒ½"><a href="#10- ä¼˜åŒ–ç½‘ç«™çš„æ€§èƒ½" class="headerlink" title="10. ä¼˜åŒ–ç½‘ç«™çš„æ€§èƒ½"></a>10. ä¼˜åŒ–ç½‘ç«™çš„æ€§èƒ½ </h1><ul><li> æœ¬åœ°ç¼“å­˜ <ul><li> å°†æ•°æ®ç¼“å­˜åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œæ€§èƒ½æœ€å¥½ã€‚ </li><li> å¸¸ç”¨ç¼“å­˜å·¥å…·ï¼šEhcacheã€Guavaã€Caffeine ç­‰ã€‚</li></ul></li><li> åˆ†å¸ƒå¼ç¼“å­˜ <ul><li> å°†æ•°æ®ç¼“å­˜åœ¨ NoSQL æ•°æ®åº“ä¸Šï¼Œè·¨æœåŠ¡å™¨ã€‚ </li><li> å¸¸ç”¨ç¼“å­˜å·¥å…·ï¼šMemCacheã€Redis ç­‰ã€‚</li></ul></li><li> å¤šçº§ç¼“å­˜ <ul><li> ä¸€çº§ç¼“å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰&#x3D;&#x3D;&gt; äºŒçº§ç¼“å­˜ï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰&#x3D;&#x3D;&gt; DB </li><li> é¿å…ç¼“å­˜é›ªå´©ï¼ˆç¼“å­˜å¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚ç›´è¾¾ DB ï¼‰ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®ä¹‹ Elasticsearch</title>
      <link href="/2023/03/08/community6/"/>
      <url>/2023/03/08/community6/</url>
      
        <content type="html"><![CDATA[<p>ğŸŒŸ æœ¬å¸–è®°å½• Spring Boot æ•´åˆ Elasticsearch å®ç°æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®çš„æœç´¢åŠŸèƒ½ã€‚</p><p>ğŸŒŸ å‡†å¤‡å·¥ä½œï¼š</p><ol><li> å¼•å…¥ Elasticsearch ä¾èµ–åˆ° pom.xml æ–‡ä»¶ä¸­ï¼š</li></ol><pre><code class="xml">&lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><ol start="2"><li> åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½® Elasticsearch çš„é›†ç¾¤åå’ŒèŠ‚ç‚¹ï¼š</li></ol><pre><code class="properties"># ElasticsearchPropertiesspring.data.elasticsearch.cluster-name=nowcoderspring.data.elasticsearch.cluster-nodes=127.0.0.1:9300</code></pre><ol start="3"><li> åœ¨ CommunityApplication.java æ–‡ä»¶ä¸­æ–°å¢æ–¹æ³• <code>init()</code> ï¼šè§£å†³ netty å¯åŠ¨å†²çªã€‚</li></ol><pre><code class="java">@SpringBootApplicationpublic class CommunityApplication &#123;    @PostConstruct    public void init() &#123;        // è§£å†³ netty å¯åŠ¨å†²çªé—®é¢˜        // see Netty4Utils.setAvailableProcessors()        System.setProperty(&quot;es.set.netty.runtime.available.processors&quot;, &quot;false&quot;);    &#125;    public static void main(String[] args) &#123;        SpringApplication.run(CommunityApplication.class, args);    &#125;&#125;</code></pre><h1 id="1- å»ºç«‹å®ä½“ç±»å±æ€§åˆ° -ES- ç´¢å¼•çš„æ˜ å°„"><a href="#1- å»ºç«‹å®ä½“ç±»å±æ€§åˆ° -ES- ç´¢å¼•çš„æ˜ å°„" class="headerlink" title="1. å»ºç«‹å®ä½“ç±»å±æ€§åˆ° ES ç´¢å¼•çš„æ˜ å°„"></a>1. å»ºç«‹å®ä½“ç±»å±æ€§åˆ° ES ç´¢å¼•çš„æ˜ å°„ </h1><ul><li> åœ¨å®ä½“ç±» DiscussPost ä¸Šæ–°å¢æ³¨è§£ <code>@Document</code></li><li> å°†å®ä½“ç±» DiscussPost çš„å±æ€§ä¸ Elasticsearch ç´¢å¼•å»ºç«‹æ˜ å°„å…³ç³»ã€‚</li></ul><pre><code class="java">@Document(indexName = &quot;discusspost&quot;, type = &quot;_doc&quot;, shards = 6, replicas = 3)public class DiscussPost &#123;    @Id    private int id;    @Field(type = FieldType.Integer)    private int userId;    // äº’è”ç½‘æ ¡æ‹›    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)    private String title;    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)    private String content;    @Field(type = FieldType.Integer)    private int type;    @Field(type = FieldType.Integer)    private int status;    @Field(type = FieldType.Date)    private Date createTime;    @Field(type = FieldType.Integer)    private int commentCount;    @Field(type = FieldType.Double)    private double score;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public int getUserId() &#123;        return userId;    &#125;    public void setUserId(int userId) &#123;        this.userId = userId;    &#125;    public String getTitle() &#123;        return title;    &#125;    public void setTitle(String title) &#123;        this.title = title;    &#125;    public String getContent() &#123;        return content;    &#125;    public void setContent(String content) &#123;        this.content = content;    &#125;    public int getType() &#123;        return type;    &#125;    public void setType(int type) &#123;        this.type = type;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public Date getCreateTime() &#123;        return createTime;    &#125;    public void setCreateTime(Date createTime) &#123;        this.createTime = createTime;    &#125;    public int getCommentCount() &#123;        return commentCount;    &#125;    public void setCommentCount(int commentCount) &#123;        this.commentCount = commentCount;    &#125;    public double getScore() &#123;        return score;    &#125;    public void setScore(double score) &#123;        this.score = score;    &#125;    @Override    public String toString() &#123;        return &quot;DiscussPost&#123;&quot; +                &quot;id=&quot; + id +                &quot;, userId=&quot; + userId +                &quot;, title=&#39;&quot; + title + &#39;\&#39;&#39; +                &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; +                &quot;, type=&quot; + type +                &quot;, status=&quot; + status +                &quot;, createTime=&quot; + createTime +                &quot;, commentCount=&quot; + commentCount +                &quot;, score=&quot; + score +                &#39;&#125;&#39;;    &#125;&#125;</code></pre><h1 id="2- åˆ›å»ºæ•°æ®è®¿é—®å±‚çš„æ¥å£"><a href="#2- åˆ›å»ºæ•°æ®è®¿é—®å±‚çš„æ¥å£" class="headerlink" title="2. åˆ›å»ºæ•°æ®è®¿é—®å±‚çš„æ¥å£"></a>2. åˆ›å»ºæ•°æ®è®¿é—®å±‚çš„æ¥å£ </h1><ul><li> åˆ›å»ºæ•°æ®è®¿é—®å±‚çš„æ¥å£ DiscussPostRepositoryï¼Œè¯¥æ¥å£ç»§æ‰¿æ¥å£ ElasticsearchRepository</li></ul><pre><code class="java">@Repositorypublic interface DiscussPostRepository extends ElasticsearchRepository&lt;DiscussPost, Integer&gt; &#123;&#125;</code></pre><h1 id="3- è®¿é—® -Elasticsearch- æœåŠ¡å™¨"><a href="#3- è®¿é—® -Elasticsearch- æœåŠ¡å™¨" class="headerlink" title="3. è®¿é—® Elasticsearch æœåŠ¡å™¨"></a>3. è®¿é—® Elasticsearch æœåŠ¡å™¨ </h1><ul><li> ä½¿ç”¨ Spring æ•´åˆ Elasticsearchï¼Œå¹¶ç¼–å†™æµ‹è¯•ä»£ç è®¿é—® Elasticsearch æœåŠ¡å™¨ã€‚</li></ul><pre><code class="java">@RunWith(SpringRunner.class)@SpringBootTest@ContextConfiguration(classes = CommunityApplication.class)public class ElasticsearchTests &#123;    @Autowired    private DiscussPostMapper discussMapper;    @Autowired    private DiscussPostRepository discussRepository;    @Autowired    private ElasticsearchTemplate elasticTemplate;    @Test    public void testInsert() &#123;        discussRepository.save(discussMapper.selectDiscussPostById(241));        discussRepository.save(discussMapper.selectDiscussPostById(242));        discussRepository.save(discussMapper.selectDiscussPostById(243));    &#125;    @Test    public void testInsertList() &#123;        discussRepository.saveAll(discussMapper.selectDiscussPosts(101, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(102, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(103, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(111, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(112, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(131, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(132, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(133, 0, 100));        discussRepository.saveAll(discussMapper.selectDiscussPosts(134, 0, 100));    &#125;    @Test    public void testUpdate() &#123;        DiscussPost post = discussMapper.selectDiscussPostById(231);        post.setContent(&quot;This is some contents.&quot;);        discussRepository.save(post);    &#125;    @Test    public void testDelete() &#123;        // discussRepository.deleteById(231);        discussRepository.deleteAll();    &#125;    @Test    public void testSearchByRepository() &#123;        SearchQuery searchQuery = new NativeSearchQueryBuilder()                .withQuery(QueryBuilders.multiMatchQuery(&quot;xx å…³é”®è¯ &quot;, &quot;title&quot;, &quot;content&quot;))                .withSort(SortBuilders.fieldSort(&quot;type&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;score&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;createTime&quot;).order(SortOrder.DESC))                .withPageable(PageRequest.of(0, 10))                .withHighlightFields(new HighlightBuilder.Field(&quot;title&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;),                        new HighlightBuilder.Field(&quot;content&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;)                ).build();        // elasticTemplate.queryForPage(searchQuery, class, SearchResultMapper)        // åº•å±‚è·å–å¾—åˆ°äº†é«˜äº®æ˜¾ç¤ºçš„å€¼, ä½†æ˜¯æ²¡æœ‰è¿”å›.        Page&lt;DiscussPost&gt; page = discussRepository.search(searchQuery);        System.out.println(page.getTotalElements());        System.out.println(page.getTotalPages());        System.out.println(page.getNumber());        System.out.println(page.getSize());        for (DiscussPost post : page) &#123;            System.out.println(post);        &#125;    &#125;    @Test    public void testSearchByTemplate() &#123;        SearchQuery searchQuery = new NativeSearchQueryBuilder()                .withQuery(QueryBuilders.multiMatchQuery(&quot;xx å…³é”®è¯ &quot;, &quot;title&quot;, &quot;content&quot;))                .withSort(SortBuilders.fieldSort(&quot;type&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;score&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;createTime&quot;).order(SortOrder.DESC))                .withPageable(PageRequest.of(0, 10))                .withHighlightFields(new HighlightBuilder.Field(&quot;title&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;),                        new HighlightBuilder.Field(&quot;content&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;)                ).build();        Page&lt;DiscussPost&gt; page = elasticTemplate.queryForPage(searchQuery, DiscussPost.class, new SearchResultMapper() &#123;            @Override            public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse response, Class&lt;T&gt; aClass, Pageable pageable) &#123;                SearchHits hits = response.getHits();                if (hits.getTotalHits() &lt;= 0) &#123;                    return null;                &#125;                List&lt;DiscussPost&gt; list = new ArrayList&lt;&gt;();                for (SearchHit hit : hits) &#123;                    DiscussPost post = new DiscussPost();                    String id = hit.getSourceAsMap().get(&quot;id&quot;).toString();                    post.setId(Integer.valueOf(id));                    String userId = hit.getSourceAsMap().get(&quot;userId&quot;).toString();                    post.setUserId(Integer.valueOf(userId));                    String title = hit.getSourceAsMap().get(&quot;title&quot;).toString();                    post.setTitle(title);                    String content = hit.getSourceAsMap().get(&quot;content&quot;).toString();                    post.setContent(content);                    String status = hit.getSourceAsMap().get(&quot;status&quot;).toString();                    post.setStatus(Integer.valueOf(status));                    String createTime = hit.getSourceAsMap().get(&quot;createTime&quot;).toString();                    post.setCreateTime(new Date(Long.valueOf(createTime)));                    String commentCount = hit.getSourceAsMap().get(&quot;commentCount&quot;).toString();                    post.setCommentCount(Integer.valueOf(commentCount));                    // å¤„ç†é«˜äº®æ˜¾ç¤ºçš„ç»“æœ                    HighlightField titleField = hit.getHighlightFields().get(&quot;title&quot;);                    if (titleField != null) &#123;                        post.setTitle(titleField.getFragments()[0].toString());                    &#125;                    HighlightField contentField = hit.getHighlightFields().get(&quot;content&quot;);                    if (contentField != null) &#123;                        post.setContent(contentField.getFragments()[0].toString());                    &#125;                    list.add(post);                &#125;                return new AggregatedPageImpl(list, pageable,                        hits.getTotalHits(), response.getAggregations(), response.getScrollId(), hits.getMaxScore());            &#125;        &#125;);        System.out.println(page.getTotalElements());        System.out.println(page.getTotalPages());        System.out.println(page.getNumber());        System.out.println(page.getSize());        for (DiscussPost post : page) &#123;            System.out.println(post);        &#125;    &#125;&#125;</code></pre><h1 id="4- å¼€å‘ç¤¾åŒºæœç´¢åŠŸèƒ½"><a href="#4- å¼€å‘ç¤¾åŒºæœç´¢åŠŸèƒ½" class="headerlink" title="4. å¼€å‘ç¤¾åŒºæœç´¢åŠŸèƒ½"></a>4. å¼€å‘ç¤¾åŒºæœç´¢åŠŸèƒ½ </h1><ol><li> æœç´¢æœåŠ¡ï¼šå°†å¸–å­ä¿å­˜è‡³ Elasticsearch æœåŠ¡å™¨ï¼›ä» Elasticsearch æœåŠ¡å™¨ä¸­åˆ é™¤ &#x2F; æœç´¢å¸–å­ã€‚</li><li> å‘å¸ƒäº‹ä»¶ï¼šå‘å¸ƒå¸–å­æ—¶ï¼Œå°†å¸–å­ä»¥å¼‚æ­¥çš„æ–¹å¼æäº¤åˆ° Elasticsearch æœåŠ¡å™¨ï¼›å¢åŠ å¸–å­æ—¶ï¼Œå°†å¸–å­ä»¥å¼‚æ­¥çš„æ–¹å¼æäº¤åˆ° Elasticsearch æœåŠ¡å™¨ï¼›åœ¨æ¶ˆè´¹ç»„ä»¶ä¸­æ–°å¢æ–¹æ³•ï¼šæ¶ˆè´¹å¸–å­å‘å¸ƒäº‹ä»¶ã€‚</li><li> æ˜¾ç¤ºç»“æœï¼šåœ¨ Controller ä¸­å¤„ç†æœç´¢è¯·æ±‚ï¼Œå¹¶åœ¨ HTML é¡µé¢æ˜¾ç¤ºæœç´¢ç»“æœã€‚</li></ol><h2 id="4-1- æœç´¢æœåŠ¡"><a href="#4-1- æœç´¢æœåŠ¡" class="headerlink" title="4.1 æœç´¢æœåŠ¡"></a>4.1 æœç´¢æœåŠ¡ </h2><ul><li> åˆ›å»ºä¸šåŠ¡å±‚çš„ ElasticsearchService ç±»ï¼š<ul><li> æ³¨å…¥ DiscussPostRepository å®ä¾‹å’Œ ElasticsearchTemplate ç¤ºä¾‹ã€‚</li><li> æ–°å¢æ–¹æ³• <code>saveDiscussPost()</code>ï¼šä¿å­˜å¸–å­åˆ° Elasticsearch æœåŠ¡å™¨ã€‚</li><li> æ–°å¢æ–¹æ³• <code>deleteDiscussPost()</code>ï¼šåˆ é™¤ Elasticsearch æœåŠ¡å™¨ä¸­çš„å¸–å­ã€‚</li><li> æ–°å¢æ–¹æ³• <code>searchDiscussPost()</code>ï¼šæœç´¢ Elasticsearch æœåŠ¡å™¨ä¸­çš„å¸–å­ã€‚</li></ul></li></ul><pre><code class="java">@Servicepublic class ElasticsearchService &#123;    @Autowired    private DiscussPostRepository discussRepository;    @Autowired    private ElasticsearchTemplate elasticTemplate;    public void saveDiscussPost(DiscussPost post) &#123;        discussRepository.save(post);    &#125;    public void deleteDiscussPost(int id) &#123;        discussRepository.deleteById(id);    &#125;    public Page&lt;DiscussPost&gt; searchDiscussPost(String keyword, int current, int limit) &#123;        SearchQuery searchQuery = new NativeSearchQueryBuilder()                .withQuery(QueryBuilders.multiMatchQuery(keyword, &quot;title&quot;, &quot;content&quot;))                .withSort(SortBuilders.fieldSort(&quot;type&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;score&quot;).order(SortOrder.DESC))                .withSort(SortBuilders.fieldSort(&quot;createTime&quot;).order(SortOrder.DESC))                .withPageable(PageRequest.of(current, limit))                .withHighlightFields(new HighlightBuilder.Field(&quot;title&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;),                        new HighlightBuilder.Field(&quot;content&quot;).preTags(&quot;&lt;em&gt;&quot;).postTags(&quot;&lt;/em&gt;&quot;)                ).build();        return elasticTemplate.queryForPage(searchQuery, DiscussPost.class, new SearchResultMapper() &#123;            @Override            public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse response, Class&lt;T&gt; aClass, Pageable pageable) &#123;                SearchHits hits = response.getHits();                if (hits.getTotalHits() &lt;= 0) &#123;                    return null;                &#125;                List&lt;DiscussPost&gt; list = new ArrayList&lt;&gt;();                for (SearchHit hit : hits) &#123;                    DiscussPost post = new DiscussPost();                    String id = hit.getSourceAsMap().get(&quot;id&quot;).toString();                    post.setId(Integer.valueOf(id));                    String userId = hit.getSourceAsMap().get(&quot;userId&quot;).toString();                    post.setUserId(Integer.valueOf(userId));                    String title = hit.getSourceAsMap().get(&quot;title&quot;).toString();                    post.setTitle(title);                    String content = hit.getSourceAsMap().get(&quot;content&quot;).toString();                    post.setContent(content);                    String status = hit.getSourceAsMap().get(&quot;status&quot;).toString();                    post.setStatus(Integer.valueOf(status));                    String createTime = hit.getSourceAsMap().get(&quot;createTime&quot;).toString();                    post.setCreateTime(new Date(Long.valueOf(createTime)));                    String commentCount = hit.getSourceAsMap().get(&quot;commentCount&quot;).toString();                    post.setCommentCount(Integer.valueOf(commentCount));                    // å¤„ç†é«˜äº®æ˜¾ç¤ºçš„ç»“æœ                    HighlightField titleField = hit.getHighlightFields().get(&quot;title&quot;);                    if (titleField != null) &#123;                        post.setTitle(titleField.getFragments()[0].toString());                    &#125;                    HighlightField contentField = hit.getHighlightFields().get(&quot;content&quot;);                    if (contentField != null) &#123;                        post.setContent(contentField.getFragments()[0].toString());                    &#125;                    list.add(post);                &#125;                return new AggregatedPageImpl(list, pageable,                        hits.getTotalHits(), response.getAggregations(), response.getScrollId(), hits.getMaxScore());            &#125;        &#125;);    &#125;&#125;</code></pre><h2 id="4-2- å‘å¸ƒäº‹ä»¶"><a href="#4-2- å‘å¸ƒäº‹ä»¶" class="headerlink" title="4.2 å‘å¸ƒäº‹ä»¶"></a>4.2 å‘å¸ƒäº‹ä»¶ </h2><ul><li> æ›´æ–°è¡¨ç°å±‚çš„ DiscussPostController ç±»ï¼š<ul><li> æ›´æ–°æ–¹æ³• <code>addDiscussPost()</code>ï¼šæ–°å¢è§¦å‘å‘å¸–äº‹ä»¶ã€‚</li></ul></li></ul><pre><code class="java">@PostMapping(&quot;/add&quot;)@ResponseBodypublic String addDiscussPost(String title, String content) &#123;    User user = hostHolder.getUser();    if (user == null) &#123;        return CommunityUtil.getJSONString(403, &quot; ä½ è¿˜æ²¡æœ‰ç™»å½•å“¦!&quot;);    &#125;    DiscussPost post = new DiscussPost();    post.setUserId(user.getId());    post.setTitle(title);    post.setContent(content);    post.setCreateTime(new Date());    discussPostService.addDiscussPost(post);    // è§¦å‘å‘å¸–äº‹ä»¶    Event event = new Event()            .setTopic(TOPIC_PUBLISH)            .setUserId(user.getId())            .setEntityType(ENTITY_TYPE_POST)            .setEntityId(post.getId());    eventProducer.fireEvent(event);    // æŠ¥é”™çš„æƒ…å†µ, å°†æ¥ç»Ÿä¸€å¤„ç†.    return CommunityUtil.getJSONString(0, &quot; å‘å¸ƒæˆåŠŸ!&quot;);&#125;</code></pre><ul><li> æ›´æ–°è¡¨ç°å±‚çš„ CommentController ç±»ï¼š<ul><li> æ›´æ–°æ–¹æ³• <code>addComment()</code>ï¼šæ–°å¢è§¦å‘å‘å¸–äº‹ä»¶ã€‚</li></ul></li></ul><pre><code class="java">@PostMapping(&quot;/add/&#123;discussPostId&#125;&quot;)public String addComment(@PathVariable(&quot;discussPostId&quot;) int discussPostId, Comment comment) &#123;    comment.setUserId(hostHolder.getUser().getId());    comment.setStatus(0);    comment.setCreateTime(new Date());    commentService.addComment(comment);    // è§¦å‘è¯„è®ºäº‹ä»¶    Event event = new Event()            .setTopic(TOPIC_COMMENT)            .setUserId(hostHolder.getUser().getId())            .setEntityType(comment.getEntityType())            .setEntityId(comment.getEntityId())            .setData(&quot;postId&quot;, discussPostId);    if (comment.getEntityType() == ENTITY_TYPE_POST) &#123;        DiscussPost target = discussPostService.findDiscussPostById(comment.getEntityId());        event.setEntityUserId(target.getUserId());    &#125; else if (comment.getEntityType() == ENTITY_TYPE_COMMENT) &#123;        Comment target = commentService.findCommentById(comment.getEntityId());        event.setEntityUserId(target.getUserId());    &#125;    eventProducer.fireEvent(event);    if (comment.getEntityType() == ENTITY_TYPE_POST) &#123;        // è§¦å‘å‘å¸–äº‹ä»¶        event = new Event()                .setTopic(TOPIC_PUBLISH)                .setUserId(comment.getUserId())                .setEntityType(ENTITY_TYPE_POST)                .setEntityId(discussPostId);        eventProducer.fireEvent(event);    &#125;    return &quot;redirect:/discuss/detail/&quot; + discussPostId;&#125;</code></pre><h2 id="4-3- æ¶ˆè´¹äº‹ä»¶"><a href="#4-3- æ¶ˆè´¹äº‹ä»¶" class="headerlink" title="4.3 æ¶ˆè´¹äº‹ä»¶"></a>4.3 æ¶ˆè´¹äº‹ä»¶ </h2><ul><li> æ›´æ–°æ¶ˆè´¹ç»„ä»¶ EventConsumer ç±»ï¼š<ul><li> æ–°å¢æ–¹æ³• <code>handlePublishMessage()</code>ï¼šæ¶ˆè´¹å¸–å­å‘å¸ƒäº‹ä»¶ã€‚</li></ul></li></ul><pre><code class="java">// æ¶ˆè´¹å‘å¸–äº‹ä»¶@KafkaListener(topics = &#123;TOPIC_PUBLISH&#125;)public void handlePublishMessage(ConsumerRecord record) &#123;    if (record == null || record.value() == null) &#123;        logger.error(&quot; æ¶ˆæ¯çš„å†…å®¹ä¸ºç©º!&quot;);        return;    &#125;    Event event = JSONObject.parseObject(record.value().toString(), Event.class);    if (event == null) &#123;        logger.error(&quot; æ¶ˆæ¯æ ¼å¼é”™è¯¯!&quot;);        return;    &#125;    DiscussPost post = discussPostService.findDiscussPostById(event.getEntityId());    elasticsearchService.saveDiscussPost(post);&#125;</code></pre><h2 id="4-4- æ˜¾ç¤ºæœç´¢ç»“æœ"><a href="#4-4- æ˜¾ç¤ºæœç´¢ç»“æœ" class="headerlink" title="4.4 æ˜¾ç¤ºæœç´¢ç»“æœ"></a>4.4 æ˜¾ç¤ºæœç´¢ç»“æœ </h2><ul><li> åˆ›å»ºè¡¨ç°å±‚çš„ SearchController ç±»ï¼š<ul><li> æ³¨å…¥ ElasticsearchService å®ä¾‹ã€UserService å®ä¾‹ã€LikeService å®ä¾‹ã€‚</li><li> æ–°å¢æ–¹æ³• <code>search()</code>ï¼šå®ç°å¸–å­æœç´¢ (èšåˆæ•°æ®ã€åˆ†é¡µä¿¡æ¯) åŠŸèƒ½ã€‚</li></ul></li></ul><pre><code class="java">@Controllerpublic class SearchController implements CommunityConstant &#123;    @Autowired    private ElasticsearchService elasticsearchService;    @Autowired    private UserService userService;    @Autowired    private LikeService likeService;    // search?keyword=xxx    @RequestMapping(path = &quot;/search&quot;, method = RequestMethod.GET)    public String search(String keyword, Page page, Model model) &#123;        // æœç´¢å¸–å­        org.springframework.data.domain.Page&lt;DiscussPost&gt; searchResult =                elasticsearchService.searchDiscussPost(keyword, page.getCurrent() - 1, page.getLimit());        // èšåˆæ•°æ®        List&lt;Map&lt;String, Object&gt;&gt; discussPosts = new ArrayList&lt;&gt;();        if (searchResult != null) &#123;            for (DiscussPost post : searchResult) &#123;                Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();                // å¸–å­                map.put(&quot;post&quot;, post);                // ä½œè€…                map.put(&quot;user&quot;, userService.findUserById(post.getUserId()));                // ç‚¹èµæ•°é‡                map.put(&quot;likeCount&quot;, likeService.findEntityLikeCount(ENTITY_TYPE_POST, post.getId()));                discussPosts.add(map);            &#125;        &#125;        model.addAttribute(&quot;discussPosts&quot;, discussPosts);        model.addAttribute(&quot;keyword&quot;, keyword);        // åˆ†é¡µä¿¡æ¯        page.setPath(&quot;/search?keyword=&quot; + keyword);        page.setRows(searchResult == null ? 0 : (int) searchResult.getTotalElements());        return &quot;/site/search&quot;;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®ä¹‹ Kafka</title>
      <link href="/2023/03/07/community5/"/>
      <url>/2023/03/07/community5/</url>
      
        <content type="html"><![CDATA[<p>ğŸŒŸ æœ¬å¸–è®°å½• Spring Boot æ•´åˆ Kafka å®ç°æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®çš„å‘é€ç³»ç»Ÿé€šçŸ¥ã€æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥çš„åŠŸèƒ½ã€‚</p><p>ğŸŒŸ å‡†å¤‡å·¥ä½œï¼š</p><ol><li>å¼•å…¥ Kafka ä¾èµ–åˆ° pom.xml æ–‡ä»¶ä¸­ï¼š</li></ol><pre><code class="xml">&lt;dependency&gt;        &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;        &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><ol start="2"><li>åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½® Kafka çš„ server å’Œ consumerï¼š</li></ol><pre><code class="properties"># KafkaPropertiesspring.kafka.bootstrap-servers=localhost:9092spring.kafka.consumer.group-id=community-consumer-groupspring.kafka.consumer.enable-auto-commit=truespring.kafka.consumer.auto-commit-interval=3000</code></pre><ol start="3"><li>è®¿é—® Kafkaï¼š</li></ol><p>ç”Ÿäº§è€…</p><pre><code>kafkaTemplate.send(topic, data);</code></pre><p>æ¶ˆè´¹è€…</p><pre><code>@KafkaListener(topic = &#123;&quot;test&quot;&#125;)</code></pre><pre><code>public void handleMessage(ConsumerRecord record)&#123;&#125;</code></pre><h1 id="1- å‘é€ç³»ç»Ÿé€šçŸ¥"><a href="#1- å‘é€ç³»ç»Ÿé€šçŸ¥" class="headerlink" title="1. å‘é€ç³»ç»Ÿé€šçŸ¥"></a>1. å‘é€ç³»ç»Ÿé€šçŸ¥</h1><ol><li>è§¦å‘äº‹ä»¶ï¼šè¯„è®ºåå‘å¸ƒé€šçŸ¥ï¼›ç‚¹èµåå‘å¸ƒé€šçŸ¥ï¼›å…³æ³¨åå‘å¸ƒé€šçŸ¥ã€‚</li><li>å¤„ç†äº‹ä»¶ï¼šå°è£…äº‹ä»¶å¯¹è±¡ï¼›å¼€å‘äº‹ä»¶çš„ç”Ÿäº§è€…ï¼›å¼€å‘äº‹ä»¶çš„æ¶ˆè´¹è€…ã€‚</li></ol><h2 id="åˆ›å»ºå®ä½“ç±» -Event"><a href="# åˆ›å»ºå®ä½“ç±» -Event" class="headerlink" title="åˆ›å»ºå®ä½“ç±» Event"></a>åˆ›å»ºå®ä½“ç±» Event</h2><ul><li>å°è£…äº‹ä»¶å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸»é¢˜ã€ç”¨æˆ· idã€å®ä½“ç±»å‹ã€å®ä½“ idã€å®ä½“ç”¨æˆ· id ä»¥åŠä¸€ä¸ª map é›†åˆå­˜æ”¾å…¶å®ƒä¿¡æ¯ã€‚</li></ul><pre><code class="java">public class Event &#123;    private String topic;    private int userId;    private int entityType;    private int entityId;    private int entityUserId;    private Map&lt;String, Object&gt; data = new HashMap&lt;&gt;();    public String getTopic() &#123;        return topic;    &#125;    public Event setTopic(String topic) &#123;        this.topic = topic;        return this;    &#125;    public int getUserId() &#123;        return userId;    &#125;    public Event setUserId(int userId) &#123;        this.userId = userId;        return this;    &#125;    public int getEntityType() &#123;        return entityType;    &#125;    public Event setEntityType(int entityType) &#123;        this.entityType = entityType;        return this;    &#125;    public int getEntityId() &#123;        return entityId;    &#125;    public Event setEntityId(int entityId) &#123;        this.entityId = entityId;        return this;    &#125;    public int getEntityUserId() &#123;        return entityUserId;    &#125;    public Event setEntityUserId(int entityUserId) &#123;        this.entityUserId = entityUserId;        return this;    &#125;    public Map&lt;String, Object&gt; getData() &#123;        return data;    &#125;    public Event setData(String key, Object value) &#123;        this.data.put(key, value);        return this;    &#125;&#125;</code></pre><h2 id="æ›´æ–°æ¥å£ -CommunityConstant"><a href="# æ›´æ–°æ¥å£ -CommunityConstant" class="headerlink" title="æ›´æ–°æ¥å£ CommunityConstant"></a>æ›´æ–°æ¥å£ CommunityConstant</h2><ul><li>åœ¨æ¥å£ä¸­æ–°å¢ä¸‰ä¸ªå¸¸é‡ï¼Œä»£è¡¨ä¸‰ä¸ªä¸»é¢˜ï¼šè¯„è®ºã€ç‚¹èµã€å…³æ³¨ã€‚</li></ul><pre><code class="java">/** * ä¸»é¢˜: è¯„è®º */String TOPIC_COMMENT = &quot;comment&quot;;/** * ä¸»é¢˜: ç‚¹èµ */String TOPIC_LIKE = &quot;like&quot;;/** * ä¸»é¢˜: å…³æ³¨ */String TOPIC_FOLLOW = &quot;follow&quot;;</code></pre><h2 id="åˆ›å»ºäº‹ä»¶ç”Ÿäº§è€…ç±» -EventProducer"><a href="# åˆ›å»ºäº‹ä»¶ç”Ÿäº§è€…ç±» -EventProducer" class="headerlink" title="åˆ›å»ºäº‹ä»¶ç”Ÿäº§è€…ç±» EventProducer"></a>åˆ›å»ºäº‹ä»¶ç”Ÿäº§è€…ç±» EventProducer</h2><ul><li>æ–°å¢æ–¹æ³• <code>fireEvent(Event event)</code> ï¼šé€šè¿‡ Event è·å–äº‹ä»¶ç±»å‹ï¼Œå¹¶å°†å…¶å°è£…æˆ JSON æ•°æ®ï¼Œç„¶åè°ƒç”¨æ³¨å…¥çš„ KafkaTemplate å®ä¾‹çš„æ–¹æ³• <code>send()</code> å‘é€ã€‚</li></ul><pre><code class="java">@Componentpublic class EventProducer &#123;    @Autowired    private KafkaTemplate kafkaTemplate;    // å¤„ç†äº‹ä»¶    public void fireEvent(Event event) &#123;        // å°†äº‹ä»¶å‘å¸ƒåˆ°æŒ‡å®šçš„ä¸»é¢˜        kafkaTemplate.send(event.getTopic(), JSONObject.toJSONString(event));    &#125;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -CommentControllerã€LikeControllerã€FollowController"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -CommentControllerã€LikeControllerã€FollowController" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ CommentControllerã€LikeControllerã€FollowController"></a>æ›´æ–°è¡¨ç°å±‚çš„ CommentControllerã€LikeControllerã€FollowController</h2><ul><li>æ³¨å…¥ EventProducer å®ä¾‹ã€‚</li><li>é‡æ„è¡¨ç°å±‚ CommentController ç±»çš„æ–¹æ³• <code>addComment()</code>  ï¼Œå°è£… Event å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ EventProducer ç±»çš„ <code>fireEvent()</code>  æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚</li></ul><pre><code class="java">@PostMapping(&quot;/add/&#123;discussPostId&#125;&quot;)public String addComment(@PathVariable(&quot;discussPostId&quot;) int discussPostId, Comment comment) &#123;    comment.setUserId(hostHolder.getUser().getId());    comment.setStatus(0);    comment.setCreateTime(new Date());    commentService.addComment(comment);    // è§¦å‘è¯„è®ºäº‹ä»¶    Event event = new Event()            .setTopic(TOPIC_COMMENT)            .setUserId(hostHolder.getUser().getId())            .setEntityType(comment.getEntityType())            .setEntityId(comment.getEntityId())            .setData(&quot;postId&quot;, discussPostId);    if (comment.getEntityType() == ENTITY_TYPE_POST) &#123;        DiscussPost target = discussPostService.findDiscussPostById(comment.getEntityId());        event.setEntityUserId(target.getUserId());    &#125; else if (comment.getEntityType() == ENTITY_TYPE_COMMENT) &#123;        Comment target = commentService.findCommentById(comment.getEntityId());        event.setEntityUserId(target.getUserId());    &#125;    eventProducer.fireEvent(event);    return &quot;redirect:/discuss/detail/&quot; + discussPostId;&#125;</code></pre><ul><li>é‡æ„è¡¨ç°å±‚ LikeController ç±»çš„æ–¹æ³• <code>like()</code>  ï¼Œå°è£… Event å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ EventProducer ç±»çš„ <code>fireEvent()</code>  æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚</li></ul><pre><code class="java">@PostMapping(&quot;/like&quot;)@ResponseBodypublic String like(int entityType, int entityId, int entityUserId, int postId) &#123;    User user = hostHolder.getUser();    // ç‚¹èµ    likeService.like(user.getId(), entityType, entityId, entityUserId);    // æ•°é‡    long likeCount = likeService.findEntityLikeCount(entityType, entityId);    // çŠ¶æ€    int likeStatus = likeService.findEntityLikeStatus(user.getId(), entityType, entityId);    // è¿”å›çš„ç»“æœ    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();    map.put(&quot;likeCount&quot;, likeCount);    map.put(&quot;likeStatus&quot;, likeStatus);    // è§¦å‘ç‚¹èµäº‹ä»¶    if (likeStatus == 1) &#123;        Event event = new Event()                .setTopic(TOPIC_LIKE)                .setUserId(hostHolder.getUser().getId())                .setEntityType(entityType)                .setEntityId(entityId)                .setEntityUserId(entityUserId)                .setData(&quot;postId&quot;, postId);        eventProducer.fireEvent(event);    &#125;    return CommunityUtil.getJSONString(0, null, map);&#125;</code></pre><ul><li>é‡æ„è¡¨ç°å±‚ FollowController ç±»çš„æ–¹æ³• <code>follow()</code> ï¼Œå°è£… Event å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ EventProducer ç±»çš„ <code>fireEvent()</code>  æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚</li></ul><pre><code class="java">@PostMapping(&quot;/follow&quot;)@ResponseBodypublic String follow(int entityType, int entityId) &#123;    User user = hostHolder.getUser();    followService.follow(user.getId(), entityType, entityId);    // è§¦å‘å…³æ³¨äº‹ä»¶    Event event = new Event()            .setTopic(TOPIC_FOLLOW)            .setUserId(hostHolder.getUser().getId())            .setEntityType(entityType)            .setEntityId(entityId)            .setEntityUserId(entityId);    eventProducer.fireEvent(event);    return CommunityUtil.getJSONString(0, &quot; å·²å…³æ³¨!&quot;);&#125;</code></pre><h2 id="åˆ›å»ºäº‹ä»¶æ¶ˆè´¹è€…ç±» -EventConsumer"><a href="# åˆ›å»ºäº‹ä»¶æ¶ˆè´¹è€…ç±» -EventConsumer" class="headerlink" title="åˆ›å»ºäº‹ä»¶æ¶ˆè´¹è€…ç±» EventConsumer"></a>åˆ›å»ºäº‹ä»¶æ¶ˆè´¹è€…ç±» EventConsumer</h2><ul><li>æ³¨å…¥ MessageService å®ä¾‹ã€‚</li><li>æ–°å¢æ–¹æ³• <code>handleCommentMessage(ConsumerRecord record)</code> ï¼šé€šè¿‡ <code>@KafkaListener</code> æ³¨è§£ï¼Œtopic åŒ…æ‹¬äº†è¯„è®ºã€ç‚¹èµå’Œå…³æ³¨ã€‚ä» record ä¸­è·å–ä¿¡æ¯ï¼Œå°è£…æˆ Message å¯¹è±¡ç„¶åè°ƒç”¨æ–¹æ³• <code>addMessage()</code> æ’å…¥æ•°æ®åº“ã€‚</li></ul><pre><code class="java">@Componentpublic class EventConsumer implements CommunityConstant &#123;    private static final Logger logger = LoggerFactory.getLogger(EventConsumer.class);    @Autowired    private MessageService messageService;    @KafkaListener(topics = &#123;TOPIC_COMMENT, TOPIC_LIKE, TOPIC_FOLLOW&#125;)    public void handleCommentMessage(ConsumerRecord record) &#123;        if (record == null || record.value() == null) &#123;            logger.error(&quot; æ¶ˆæ¯çš„å†…å®¹ä¸ºç©º!&quot;);            return;        &#125;        Event event = JSONObject.parseObject(record.value().toString(), Event.class);        if (event == null) &#123;            logger.error(&quot; æ¶ˆæ¯æ ¼å¼é”™è¯¯!&quot;);            return;        &#125;        // å‘é€ç«™å†…é€šçŸ¥        Message message = new Message();        message.setFromId(SYSTEM_USER_ID);        message.setToId(event.getEntityUserId());        message.setConversationId(event.getTopic());        message.setCreateTime(new Date());        Map&lt;String, Object&gt; content = new HashMap&lt;&gt;();        content.put(&quot;userId&quot;, event.getUserId());        content.put(&quot;entityType&quot;, event.getEntityType());        content.put(&quot;entityId&quot;, event.getEntityId());        if (!event.getData().isEmpty()) &#123;            for (Map.Entry&lt;String, Object&gt; entry : event.getData().entrySet()) &#123;                content.put(entry.getKey(), entry.getValue());            &#125;        &#125;        message.setContent(JSONObject.toJSONString(content));        messageService.addMessage(message);    &#125;&#125;</code></pre><h1 id="2- æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥"><a href="#2- æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥" class="headerlink" title="2. æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥"></a>2. æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥</h1><ol><li>é€šçŸ¥åˆ—è¡¨ï¼šæ˜¾ç¤ºè¯„è®ºã€ç‚¹èµã€å…³æ³¨ä¸‰ç§ç±»å‹çš„é€šçŸ¥ã€‚</li><li>é€šçŸ¥è¯¦æƒ…ï¼šåˆ†é¡µæ˜¾ç¤ºæŸä¸€ç±»ä¸»é¢˜æ‰€åŒ…å«çš„é€šçŸ¥ã€‚</li><li>æœªè¯»æ¶ˆæ¯ï¼šåœ¨é¡µé¢å¤´éƒ¨æ˜¾ç¤ºæ‰€æœ‰æœªè¯»æ¶ˆæ¯çš„æ•°é‡ã€‚</li></ol><h2 id="æ›´æ–°æ¥å£ -MessageMapper"><a href="# æ›´æ–°æ¥å£ -MessageMapper" class="headerlink" title="æ›´æ–°æ¥å£ MessageMapper"></a>æ›´æ–°æ¥å£ MessageMapper</h2><ul><li>æ–°å¢æ–¹æ³• <code>selectLatestNotice(int userId, String topic)</code> ï¼ŒæŸ¥è¯¢æŸä¸»é¢˜æœ€æ–°çš„é€šçŸ¥ã€‚</li><li>æ–°å¢æ–¹æ³• <code>selectNoticeCount(int userId, String topic)</code> ï¼ŒæŸ¥è¯¢æŸä¸»é¢˜é€šçŸ¥çš„æ•°é‡ã€‚</li><li>æ–°å¢æ–¹æ³• <code>selectNoticeUnreadCount(int userId, String topic)</code> ï¼ŒæŸ¥è¯¢æœªè¯»é€šçŸ¥çš„æ•°é‡ã€‚</li></ul><pre><code class="java">// æŸ¥è¯¢æŸä¸ªä¸»é¢˜ä¸‹æœ€æ–°çš„é€šçŸ¥Message selectLatestNotice(int userId, String topic);// æŸ¥è¯¢æŸä¸ªä¸»é¢˜æ‰€åŒ…å«çš„é€šçŸ¥æ•°é‡int selectNoticeCount(int userId, String topic);// æŸ¥è¯¢æœªè¯»çš„é€šçŸ¥çš„æ•°é‡int selectNoticeUnreadCount(int userId, String topic);</code></pre><ul><li>åœ¨ <code>message-mapper.xml</code> é…ç½®ä¸‰ä¸ªæ–¹æ³•çš„ sql è¯­å¥ï¼Œå…¶ä¸­æŸ¥è¯¢æœªè¯»é€šçŸ¥æ—¶ä½¿ç”¨ if åŠ¨æ€è¯­å¥ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥ topic å°±æŸ¥è¯¢æœªè¯»æ€»é‡ã€‚</li></ul><pre><code class="xml">&lt;sql id=&quot;selectFields&quot;&gt;    id, from_id, to_id, conversation_id, content, status, create_time&lt;/sql&gt;&lt;select id=&quot;selectLatestNotice&quot; resultType=&quot;Message&quot;&gt;    select &lt;include refid=&quot;selectFields&quot;&gt;&lt;/include&gt;    from message    where id in (select max(id) from message        where status != 2        and from_id = 1        and to_id = #&#123;userId&#125;        and conversation_id = #&#123;topic&#125;    )&lt;/select&gt;&lt;select id=&quot;selectNoticeCount&quot; resultType=&quot;int&quot;&gt;    select count(id) from message    where status != 2    and from_id = 1    and to_id = #&#123;userId&#125;    and conversation_id = #&#123;topic&#125;&lt;/select&gt;&lt;select id=&quot;selectNoticeUnreadCount&quot; resultType=&quot;int&quot;&gt;    select count(id) from message    where status = 0    and from_id = 1    and to_id = #&#123;userId&#125;    &lt;if test=&quot;topic!=null&quot;&gt;        and conversation_id = #&#123;topic&#125;    &lt;/if&gt;&lt;/select&gt;</code></pre><h2 id="æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageService- ç±»"><a href="# æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageService- ç±»" class="headerlink" title="æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageService ç±»"></a>æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageService ç±»</h2><ul><li>æ–°å¢æ–¹æ³• <code>findLatestNotice()</code> ï¼Œè°ƒç”¨æ–¹æ³• <code>selectLatestNotice()</code> æŸ¥è¯¢æœ€æ–°é€šçŸ¥ã€‚</li><li>æ–°å¢æ–¹æ³• <code>findNoticeCount()</code> ï¼Œè°ƒç”¨æ–¹æ³• <code>selectNoticeCount()</code> æŸ¥è¯¢æŸä¸»é¢˜é€šçŸ¥çš„æ•°é‡ã€‚</li><li>æ–°å¢æ–¹æ³• <code>findNoticeUnreadCount()</code> ï¼Œè°ƒç”¨æ–¹æ³• <code>selectNoticeUnreadCount()</code> æŸ¥è¯¢æœªè¯»é€šçŸ¥çš„æ•°é‡ã€‚</li></ul><pre><code class="java">public Message findLatestNotice(int userId, String topic) &#123;    return messageMapper.selectLatestNotice(userId, topic);&#125;public int findNoticeCount(int userId, String topic) &#123;    return messageMapper.selectNoticeCount(userId, topic);&#125;public int findNoticeUnreadCount(int userId, String topic) &#123;    return messageMapper.selectNoticeUnreadCount(userId, topic);&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -MessageController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -MessageController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ MessageController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ MessageController ç±»</h2><ul><li>æ–°å¢æ–¹æ³• <code>getNoticeList()</code> ï¼šè·å–é€šçŸ¥åˆ—è¡¨ã€‚<ul><li>è°ƒç”¨ä¸šåŠ¡å±‚çš„ MessageService ç±»çš„æ–¹æ³•æŸ¥è¯¢è¯„è®ºã€ç‚¹èµã€å…³æ³¨çš„é€šçŸ¥ï¼Œå°†å…¶å°è£…åœ¨ä¸€ä¸ª HashMap é›†åˆä¸­ç„¶åæ·»åŠ åˆ° Model å¯¹è±¡ä¸­ã€‚</li><li>è°ƒç”¨ä¸šåŠ¡å±‚çš„ MessageService ç±»çš„æ–¹æ³•æŸ¥è¯¢ç§ä¿¡å’Œé€šçŸ¥çš„æ€»æœªè¯»æ•°é‡ï¼Œæ·»åŠ åˆ° Model å¯¹è±¡ä¸­ã€‚</li><li>è¿”å› <code>notice.html</code> é¡µé¢ã€‚</li></ul></li></ul><pre><code class="java">@GetMapping(&quot;/notice/list&quot;)public String getNoticeList(Model model) &#123;    User user = hostHolder.getUser();    // æŸ¥è¯¢è¯„è®ºç±»é€šçŸ¥    Message message = messageService.findLatestNotice(user.getId(), TOPIC_COMMENT);    Map&lt;String, Object&gt; messageVO = new HashMap&lt;&gt;();    if (message != null) &#123;        messageVO.put(&quot;message&quot;, message);        String content = HtmlUtils.htmlUnescape(message.getContent());        Map&lt;String, Object&gt; data = JSONObject.parseObject(content, HashMap.class);        messageVO.put(&quot;user&quot;, userService.findUserById((Integer) data.get(&quot;userId&quot;)));        messageVO.put(&quot;entityType&quot;, data.get(&quot;entityType&quot;));        messageVO.put(&quot;entityId&quot;, data.get(&quot;entityId&quot;));        messageVO.put(&quot;postId&quot;, data.get(&quot;postId&quot;));        int count = messageService.findNoticeCount(user.getId(), TOPIC_COMMENT);        messageVO.put(&quot;count&quot;, count);        int unread = messageService.findNoticeUnreadCount(user.getId(), TOPIC_COMMENT);        messageVO.put(&quot;unread&quot;, unread);    &#125;    model.addAttribute(&quot;commentNotice&quot;, messageVO);    // æŸ¥è¯¢ç‚¹èµç±»é€šçŸ¥    message = messageService.findLatestNotice(user.getId(), TOPIC_LIKE);    messageVO = new HashMap&lt;&gt;();    if (message != null) &#123;        messageVO.put(&quot;message&quot;, message);        String content = HtmlUtils.htmlUnescape(message.getContent());        Map&lt;String, Object&gt; data = JSONObject.parseObject(content, HashMap.class);        messageVO.put(&quot;user&quot;, userService.findUserById((Integer) data.get(&quot;userId&quot;)));        messageVO.put(&quot;entityType&quot;, data.get(&quot;entityType&quot;));        messageVO.put(&quot;entityId&quot;, data.get(&quot;entityId&quot;));        messageVO.put(&quot;postId&quot;, data.get(&quot;postId&quot;));        int count = messageService.findNoticeCount(user.getId(), TOPIC_LIKE);        messageVO.put(&quot;count&quot;, count);        int unread = messageService.findNoticeUnreadCount(user.getId(), TOPIC_LIKE);        messageVO.put(&quot;unread&quot;, unread);    &#125;    model.addAttribute(&quot;likeNotice&quot;, messageVO);    // æŸ¥è¯¢å…³æ³¨ç±»é€šçŸ¥    message = messageService.findLatestNotice(user.getId(), TOPIC_FOLLOW);    messageVO = new HashMap&lt;&gt;();    if (message != null) &#123;        messageVO.put(&quot;message&quot;, message);        String content = HtmlUtils.htmlUnescape(message.getContent());        Map&lt;String, Object&gt; data = JSONObject.parseObject(content, HashMap.class);        messageVO.put(&quot;user&quot;, userService.findUserById((Integer) data.get(&quot;userId&quot;)));        messageVO.put(&quot;entityType&quot;, data.get(&quot;entityType&quot;));        messageVO.put(&quot;entityId&quot;, data.get(&quot;entityId&quot;));        int count = messageService.findNoticeCount(user.getId(), TOPIC_FOLLOW);        messageVO.put(&quot;count&quot;, count);        int unread = messageService.findNoticeUnreadCount(user.getId(), TOPIC_FOLLOW);        messageVO.put(&quot;unread&quot;, unread);    &#125;    model.addAttribute(&quot;followNotice&quot;, messageVO);    // æŸ¥è¯¢ç§ä¿¡çš„æ€»æœªè¯»æ•°    int letterUnreadCount = messageService.findLetterUnreadCount(user.getId(), null);    model.addAttribute(&quot;letterUnreadCount&quot;, letterUnreadCount);      // æŸ¥è¯¢é€šçŸ¥çš„æ€»æœªè¯»æ•°    int noticeUnreadCount = messageService.findNoticeUnreadCount(user.getId(), null);    model.addAttribute(&quot;noticeUnreadCount&quot;, noticeUnreadCount);    return &quot;/site/notice&quot;;&#125;</code></pre><h2 id="å†æ¬¡æ›´æ–°æ¥å£ -MessageMapper"><a href="# å†æ¬¡æ›´æ–°æ¥å£ -MessageMapper" class="headerlink" title="å†æ¬¡æ›´æ–°æ¥å£ MessageMapper"></a>å†æ¬¡æ›´æ–°æ¥å£ MessageMapper</h2><ul><li>æ–°å¢æ–¹æ³• <code>selectNotices()</code> ï¼šæŸ¥è¯¢æŸä¸ªä¸»é¢˜çš„é€šçŸ¥åˆ—è¡¨ã€‚</li><li>åœ¨ <code>message-mapper.xml</code> æ–‡ä»¶ä¸­é…ç½® SQLã€‚</li></ul><pre><code class="java">// æŸ¥è¯¢æŸä¸ªä¸»é¢˜æ‰€åŒ…å«çš„é€šçŸ¥åˆ—è¡¨List&lt;Message&gt; selectNotices(int userId, String topic, int offset, int limit);</code></pre><pre><code class="xml">&lt;select id=&quot;selectNotices&quot; resultType=&quot;Message&quot;&gt;    select &lt;include refid=&quot;selectFields&quot;&gt;&lt;/include&gt;    from message    where status != 2    and from_id = 1    and to_id = #&#123;userId&#125;    and conversation_id = #&#123;topic&#125;    order by create_time desc    limit #&#123;offset&#125;, #&#123;limit&#125;&lt;/select&gt;</code></pre><h2 id="å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageService- ç±»"><a href="# å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageService- ç±»" class="headerlink" title="å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageService ç±»"></a>å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageService ç±» </h2><p> æ–°å¢æ–¹æ³• <code>findNotices()</code> ï¼šè°ƒç”¨æ–¹æ³• <code>selectNotices()</code> ã€‚</p><pre><code class="java">public List&lt;Message&gt; findNotices(int userId, String topic, int offset, int limit) &#123;    return messageMapper.selectNotices(userId, topic, offset, limit);&#125;</code></pre><h2 id="å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageController- ç±»"><a href="# å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ -MessageController- ç±»" class="headerlink" title="å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageController ç±»"></a>å†æ¬¡æ›´æ–°ä¸šåŠ¡å±‚çš„ MessageController ç±»</h2><ul><li>æ–°å¢æ–¹æ³• <code>getNoticeDetail()</code> ï¼š<ul><li>è°ƒç”¨æ–¹æ³• <code>findNotices()</code> è·å–é€šçŸ¥åˆ—è¡¨è¯¦æƒ…ï¼Œå°è£…åˆ° List é›†åˆå¹¶å­˜å…¥ Model å¯¹è±¡ã€‚</li><li>ä»é€šçŸ¥é›†åˆä¸­è·å– id é›†åˆï¼Œè°ƒç”¨æ–¹æ³• <code>readMessage()</code> å°†æ¶ˆæ¯è®¾ä¸ºå·²è¯»ã€‚</li><li>è¿”å› <code>notice-detail.html</code> é¡µé¢ã€‚</li></ul></li></ul><pre><code class="java">@GetMapping(&quot;/notice/detail/&#123;topic&#125;&quot;)public String getNoticeDetail(@PathVariable(&quot;topic&quot;) String topic, Page page, Model model) &#123;    User user = hostHolder.getUser();    page.setLimit(5);    page.setPath(&quot;/notice/detail/&quot; + topic);    page.setRows(messageService.findNoticeCount(user.getId(), topic));    List&lt;Message&gt; noticeList = messageService.findNotices(user.getId(), topic, page.getOffset(), page.getLimit());    List&lt;Map&lt;String, Object&gt;&gt; noticeVoList = new ArrayList&lt;&gt;();    if (noticeList != null) &#123;        for (Message notice : noticeList) &#123;            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();            // é€šçŸ¥            map.put(&quot;notice&quot;, notice);            // å†…å®¹            String content = HtmlUtils.htmlUnescape(notice.getContent());            Map&lt;String, Object&gt; data = JSONObject.parseObject(content, HashMap.class);            map.put(&quot;user&quot;, userService.findUserById((Integer) data.get(&quot;userId&quot;)));            map.put(&quot;entityType&quot;, data.get(&quot;entityType&quot;));            map.put(&quot;entityId&quot;, data.get(&quot;entityId&quot;));            map.put(&quot;postId&quot;, data.get(&quot;postId&quot;));            // é€šçŸ¥ä½œè€…            map.put(&quot;fromUser&quot;, userService.findUserById(notice.getFromId()));            noticeVoList.add(map);        &#125;    &#125;    model.addAttribute(&quot;notices&quot;, noticeVoList);    // è®¾ç½®å·²è¯»    List&lt;Integer&gt; ids = getLetterIds(noticeList);    if (!ids.isEmpty()) &#123;        messageService.readMessage(ids);    &#125;    return &quot;/site/notice-detail&quot;;&#125;</code></pre><h2 id="åˆ›å»ºè¡¨ç°å±‚çš„æ‹¦æˆªå™¨ -MessageInterceptor- ç±»"><a href="# åˆ›å»ºè¡¨ç°å±‚çš„æ‹¦æˆªå™¨ -MessageInterceptor- ç±»" class="headerlink" title="åˆ›å»ºè¡¨ç°å±‚çš„æ‹¦æˆªå™¨ MessageInterceptor ç±»"></a>åˆ›å»ºè¡¨ç°å±‚çš„æ‹¦æˆªå™¨ MessageInterceptor ç±»</h2><ul><li>æ³¨å…¥ MessageService å®ä¾‹å’Œ HostHolder å®ä¾‹ã€‚</li><li>é‡å†™æ–¹æ³• <code>postHandle()</code> ï¼ŒæŸ¥è¯¢ç§ä¿¡å’Œé€šçŸ¥çš„æœªè¯»æ•°é‡å’Œï¼Œç„¶åæ·»åŠ åˆ° ModelAndView å¯¹è±¡ã€‚</li></ul><pre><code class="java">@Componentpublic class MessageInterceptor implements HandlerInterceptor &#123;    @Autowired    private HostHolder hostHolder;    @Autowired    private MessageService messageService;    @Override    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;        User user = hostHolder.getUser();        if (user != null &amp;&amp; modelAndView != null) &#123;            int letterUnreadCount = messageService.findLetterUnreadCount(user.getId(), null);            int noticeUnreadCount = messageService.findNoticeUnreadCount(user.getId(), null);            modelAndView.addObject(&quot;allUnreadCount&quot;, letterUnreadCount + noticeUnreadCount);        &#125;    &#125;&#125;</code></pre><h2 id="æ›´æ–°é…ç½®ç±» -WebConfig"><a href="# æ›´æ–°é…ç½®ç±» -WebConfig" class="headerlink" title="æ›´æ–°é…ç½®ç±» WebConfig"></a>æ›´æ–°é…ç½®ç±» WebConfig</h2><ul><li>æ³¨å…¥ MessageInterceptor å®ä¾‹ã€‚</li><li>åœ¨æ–¹æ³• <code>addInterceptors()</code> ä¸­æ·»åŠ æ‹¦æˆªå™¨ MessageInterceptor å®ä¾‹ã€‚</li></ul><pre><code class="java">@Overridepublic void addInterceptors(InterceptorRegistry registry) &#123;    registry.addInterceptor(alphaInterceptor)            .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;)            .addPathPatterns(&quot;/register&quot;, &quot;/login&quot;);    registry.addInterceptor(loginTicketInterceptor)            .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;);    registry.addInterceptor(loginRequiredInterceptor)            .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;);    registry.addInterceptor(messageInterceptor)            .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;);&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®ä¹‹ Redis</title>
      <link href="/2023/03/07/community4/"/>
      <url>/2023/03/07/community4/</url>
      
        <content type="html"><![CDATA[<p>ğŸŒŸ æœ¬å¸–è®°å½• Spring Boot æ•´åˆ Redis å®ç°æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®çš„ç‚¹èµã€å…³æ³¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¼˜åŒ–äº†ç™»å½•æ¨¡å—ä¸­çš„éªŒè¯ç å­˜å‚¨ã€ç™»å½•å‡­è¯å­˜å‚¨ã€ç”¨æˆ·ä¿¡æ¯ç¼“å­˜åŠŸèƒ½ã€‚</p><p>ğŸŒŸ å‡†å¤‡å·¥ä½œï¼š</p><ol><li>å¼•å…¥ Redis ä¾èµ–åˆ° pom.xml æ–‡ä»¶ä¸­ï¼š</li></ol><pre><code class="xml">&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><ol start="2"><li>åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½® Redisï¼š</li></ol><pre><code class="properties"># RedisPropertiesspring.redis.database=11spring.redis.host=localhostspring.redis.port=6379</code></pre><ol start="3"><li>ç¼–å†™é…ç½®ç±» RedisConfigï¼š</li></ol><pre><code class="java">@Configurationpublic class RedisConfig &#123;    @Bean    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) &#123;        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();        template.setConnectionFactory(factory);        // è®¾ç½® key çš„åºåˆ—åŒ–æ–¹å¼        template.setKeySerializer(RedisSerializer.string());        // è®¾ç½® value çš„åºåˆ—åŒ–æ–¹å¼        template.setValueSerializer(RedisSerializer.json());        // è®¾ç½® hash çš„ key çš„åºåˆ—åŒ–æ–¹å¼        template.setHashKeySerializer(RedisSerializer.string());        // è®¾ç½® hash çš„ value çš„åºåˆ—åŒ–æ–¹å¼        template.setHashValueSerializer(RedisSerializer.json());        template.afterPropertiesSet();        return template;    &#125;&#125;</code></pre><h1 id="1- ç‚¹èµæ¨¡å—"><a href="#1- ç‚¹èµæ¨¡å—" class="headerlink" title="1. ç‚¹èµæ¨¡å—"></a>1. ç‚¹èµæ¨¡å— </h1><p> ç‚¹èµæ¨¡å—åŒ…å«ï¼š</p><ol><li>ç‚¹èµï¼š(1) æ”¯æŒå¯¹å¸–å­ã€è¯„è®ºè¿›è¡Œç‚¹èµï¼›(2) ç¬¬ä¸€æ¬¡ç‚¹å‡»â€œèµâ€å®Œæˆç‚¹èµæ“ä½œï¼Œç¬¬äºŒæ¬¡ç‚¹å‡»â€œå·²èµâ€å®Œæˆå–æ¶ˆç‚¹èµæ“ä½œã€‚</li><li>é¦–é¡µï¼šç»Ÿè®¡å¸–å­çš„ç‚¹èµæ•°ã€‚</li><li>è¯¦æƒ…é¡µï¼š(1) ç»Ÿè®¡å¸–å­çš„ç‚¹èµæ•°ï¼›(2) æ˜¾ç¤ºç‚¹èµçŠ¶æ€ã€‚</li></ol><h2 id="åˆ›å»ºå·¥å…·ç±» -RedisKeyUtil"><a href="# åˆ›å»ºå·¥å…·ç±» -RedisKeyUtil" class="headerlink" title="åˆ›å»ºå·¥å…·ç±» RedisKeyUtil"></a>åˆ›å»ºå·¥å…·ç±» RedisKeyUtil</h2><ul><li>å®šä¹‰åˆ†éš”ç¬¦ <code>:</code></li><li>å®šä¹‰å®ä½“è·å¾—èµçš„ key å‰ç¼€å¸¸é‡  <code>like:entity</code></li><li>æ–°å¢æ–¹æ³• <code>getEntityLikeKey(int entityType, int entityId)</code>ï¼Œé€šè¿‡å®ä½“ç±»å‹å’Œå®ä½“ id ç”Ÿæˆå¯¹åº”å®ä½“è·å¾—èµçš„ keyï¼Œè¿™ä¸ª key çš„å‘ˆç°å½¢å¼ä¸º <code>like:entity:entityType:entityId</code>ã€‚</li></ul><pre><code class="jade">public class RedisKeyUtil &#123;    private static final String SPLIT = &quot;:&quot;;    private static final String PREFIX_ENTITY_LIKE = &quot;like:entity&quot;;    // æŸä¸ªå®ä½“çš„èµ    // like:entity:entityType:entityId -&gt; set(userId)    public static String getEntityLikeKey(int entityType, int entityId) &#123;        return PREFIX_ENTITY_LIKE + SPLIT + entityType + SPLIT + entityId;    &#125;&#125;</code></pre><h2 id="åˆ›å»ºä¸šåŠ¡å±‚çš„ -LikeService- ç±»"><a href="# åˆ›å»ºä¸šåŠ¡å±‚çš„ -LikeService- ç±»" class="headerlink" title="åˆ›å»ºä¸šåŠ¡å±‚çš„ LikeService ç±»"></a>åˆ›å»ºä¸šåŠ¡å±‚çš„ LikeService ç±»</h2><ul><li>æ³¨å…¥ <code>RedisTemplate</code> å®ä¾‹</li></ul><pre><code class="java">@Autowiredprivate RedisTemplate redisTemplate;</code></pre><ul><li>æ–°å¢æ–¹æ³• <code>like()</code> å®ç°ç‚¹èµåŠŸèƒ½ï¼š<ul><li>é¦–å…ˆï¼Œè°ƒç”¨å·¥å…·ç±» <code>RedisKeyUtil</code> ä¸­çš„æ–¹æ³• <code>getEntityLikeKey()</code> è·å¾—å®ä½“ç‚¹èµçš„ keyï¼›</li><li>ç„¶åï¼Œé€šè¿‡ <code>RedisTemplate</code> å®ä¾‹ï¼Œè°ƒç”¨ set é›†åˆçš„æ–¹æ³• <code>isMember()</code> æŸ¥è¯¢ userId æ˜¯å¦å­˜åœ¨äºå¯¹åº” key çš„ set é›†åˆä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™ç§»å‡ºç‚¹èµçš„ç”¨æˆ·é›†åˆï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ åˆ°ç‚¹èµçš„ç”¨æˆ·é›†åˆä¸­ã€‚</li></ul></li></ul><pre><code class="java"> // ç‚¹èµpublic void like(int userId, int entityType, int entityId) &#123;    String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);    boolean isMember = redisTemplate.opsForSet().isMember(entityLikeKey, userId);      // åˆ¤æ–­æ˜¯å¦ç‚¹è¿‡èµ    if (isMember) &#123;        redisTemplate.opsForSet().remove(entityLikeKey, userId);    &#125; else &#123;        redisTemplate.opsForSet().add(entityLikeKey, userId);    &#125;&#125;</code></pre><ul><li>æ–°å¢æ–¹æ³• <code>findEntityLikeCount()</code>ï¼šæŸ¥è¯¢æŸå®ä½“çš„ç‚¹èµæ•°ï¼Œé€šè¿‡è°ƒç”¨ set é›†åˆçš„æ–¹æ³• <code>size()</code> æŸ¥è¯¢å…ƒç´ çš„ä¸ªæ•°ã€‚</li></ul><pre><code class="java">// æŸ¥è¯¢æŸå®ä½“ç‚¹èµçš„æ•°é‡public long findEntityLikeCount(int entityType, int entityId) &#123;    String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);    return redisTemplate.opsForSet().size(entityLikeKey);&#125;</code></pre><ul><li>æ–°å¢æ–¹æ³• <code>findEntityLikeStatus()</code>ï¼šæŸ¥è¯¢æŸç”¨æˆ·å¯¹æŸå®ä½“çš„ç‚¹èµçŠ¶æ€ï¼Œé€»è¾‘å®ç°åŒæ–¹æ³• <code>like()</code>ï¼Œå³é€šè¿‡è°ƒç”¨ set é›†åˆçš„æ–¹æ³• <code>isMember()</code> å®ç°ã€‚</li></ul><pre><code class="java">// æŸ¥è¯¢æŸäººå¯¹æŸå®ä½“çš„ç‚¹èµçŠ¶æ€public int findEntityLikeStatus(int userId, int entityType, int entityId) &#123;    String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);    // 1 è¡¨ç¤ºå·²èµï¼›0 è¡¨ç¤ºæœªèµ    return redisTemplate.opsForSet().isMember(entityLikeKey, userId) ? 1 : 0;&#125;</code></pre><h2 id="åˆ›å»ºè¡¨ç°å±‚çš„ -LikeController- ç±»"><a href="# åˆ›å»ºè¡¨ç°å±‚çš„ -LikeController- ç±»" class="headerlink" title="åˆ›å»ºè¡¨ç°å±‚çš„ LikeController ç±»"></a>åˆ›å»ºè¡¨ç°å±‚çš„ LikeController ç±»</h2><ul><li>æ³¨å…¥ <code>LikeService</code> å’Œ <code>HostHolder</code> å®ä¾‹</li><li>æ–°å¢æ–¹æ³• <code>like()</code>ï¼šå®ç°ç‚¹èµåŠŸèƒ½ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚çš„æ–¹æ³• <code>like()</code> è¿›è¡Œç‚¹èµï¼Œè°ƒç”¨ <code>findEntityLikeCount()</code> å’Œ <code>findEntityLikeStatus()</code> æŸ¥è¯¢ç‚¹èµæ•°å’Œç‚¹èµçŠ¶æ€ï¼Œå¹¶å°è£…åˆ° map é›†åˆä¸­ï¼Œç„¶åé€šè¿‡å·¥å…·ç±»å°è£…æˆ JSON æ•°æ®è¿”å›ã€‚</li></ul><pre><code class="java">@Controllerpublic class LikeController &#123;    @Autowired    private LikeService likeService;    @Autowired    private HostHolder hostHolder;    @PostMapping(&quot;/like&quot;)    @ResponseBody    public String like(int entityType, int entityId) &#123;        User user = hostHolder.getUser();        // ç‚¹èµ        likeService.like(user.getId(), entityType, entityId);        // æ•°é‡        long likeCount = likeService.findEntityLikeCount(entityType, entityId);        // çŠ¶æ€        int likeStatus = likeService.findEntityLikeStatus(user.getId(), entityType, entityId);        // è¿”å›çš„ç»“æœ        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        map.put(&quot;likeCount&quot;, likeCount);        map.put(&quot;likeStatus&quot;, likeStatus);        return CommunityUtil.getJSONString(0, null, map);    &#125;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -HomeController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -HomeController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ HomeController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ HomeController ç±»</h2><ul><li><p>æ³¨å…¥  <code>LikeService</code> å®ä¾‹</p></li><li><p>æ›´æ–°æ–¹æ³•  <code>getIndexPage()</code>ï¼šæ–°å¢æ›´æ–°é¦–é¡µå¸–å­ç‚¹èµæ•°åŠŸèƒ½ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>LikeService</code> ç±»çš„æ–¹æ³•è·å¾—ç‚¹èµæ•°ï¼Œå¹¶å­˜å‚¨åˆ° map é›†åˆä¸­ã€‚</p></li></ul><pre><code class="java">@GetMapping(&quot;/index&quot;)public String getIndexPage(Model model, Page page) &#123;    // æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼ŒSpringMVC ä¼šè‡ªåŠ¨å®ä¾‹åŒ– Model å’Œ Pageï¼Œå¹¶å°† Page æ³¨å…¥åˆ° Model ä¸­ã€‚    // æ‰€ä»¥ï¼Œåœ¨ thymeleaf ä¸­å¯ä»¥ç›´æ¥è®¿é—® Page å¯¹è±¡ä¸­çš„æ•°æ®ã€‚    page.setRows(discussPostService.findDiscussPostRows(0));    page.setPath(&quot;/index&quot;);    List&lt;DiscussPost&gt; list = discussPostService.findDiscussPosts(0, page.getOffset(), page.getLimit());    List&lt;Map&lt;String, Object&gt;&gt; discussPosts = new ArrayList&lt;&gt;();    if (list != null) &#123;        for (DiscussPost post : list) &#123;            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();            map.put(&quot;post&quot;, post);            User user = userService.findUserById(post.getUserId());            map.put(&quot;user&quot;, user);            long likeCount = likeService.findEntityLikeCount(ENTITY_TYPE_POST, post.getId());            map.put(&quot;likeCount&quot;, likeCount);            discussPosts.add(map);        &#125;    &#125;    model.addAttribute(&quot;discussPosts&quot;, discussPosts);    return &quot;/index&quot;;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -DiscussPostController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -DiscussPostController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ DiscussPostController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ DiscussPostController ç±»</h2><ul><li>æ³¨å…¥  <code>LikeService</code> å®ä¾‹</li><li>æ›´æ–°æ–¹æ³• <code>addDiscussPost()</code>ï¼šæ–°å¢æ›´æ–°è¯¦æƒ…é¡µå¸–å­ï¼ˆè¯„è®ºã€å›å¤ï¼‰çš„ç‚¹èµæ•°åŠŸèƒ½ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>LikeService</code> ç±»çš„æ–¹æ³•è·å¾—ç‚¹èµæ•°å’Œç‚¹èµçŠ¶æ€ï¼Œå¹¶å°†å…¶å­˜å…¥è§†å›¾å¯¹è±¡ä¸­ã€‚</li></ul><pre><code class="java">@GetMapping(&quot;/detail/&#123;discussPostId&#125;&quot;)public String getDiscussPost(@PathVariable(&quot;discussPostId&quot;) int discussPostId, Model model, Page page) &#123;    // å¸–å­    DiscussPost post = discussPostService.findDiscussPostById(discussPostId);    model.addAttribute(&quot;post&quot;, post);    // ä½œè€…    User user = userService.findUserById(post.getUserId());    model.addAttribute(&quot;user&quot;, user);    // ç‚¹èµæ•°é‡    long likeCount = likeService.findEntityLikeCount(ENTITY_TYPE_POST, discussPostId);    model.addAttribute(&quot;likeCount&quot;, likeCount);    // ç‚¹èµçŠ¶æ€    int likeStatus = hostHolder.getUser() == null ? 0 :            likeService.findEntityLikeStatus(hostHolder.getUser().getId(), ENTITY_TYPE_POST, discussPostId);    model.addAttribute(&quot;likeStatus&quot;, likeStatus);    // è¯„è®ºåˆ†é¡µä¿¡æ¯    page.setLimit(5);    page.setPath(&quot;/discuss/detail/&quot; + discussPostId);    page.setRows(post.getCommentCount());    // è¯„è®º: ç»™å¸–å­çš„è¯„è®º    // å›å¤: ç»™è¯„è®ºçš„è¯„è®º    // è¯„è®ºåˆ—è¡¨    List&lt;Comment&gt; commentList = commentService.findCommentsByEntity(ENTITY_TYPE_POST, post.getId(), page.getOffset(), page.getLimit());    // è¯„è®º VO åˆ—è¡¨    List&lt;Map&lt;String, Object&gt;&gt; commentVoList = new ArrayList&lt;&gt;();    if (commentList != null) &#123;        for (Comment comment : commentList) &#123;            // è¯„è®º VO            Map&lt;String, Object&gt; commentVo = new HashMap&lt;&gt;();            // è¯„è®º            commentVo.put(&quot;comment&quot;, comment);            // ä½œè€…            commentVo.put(&quot;user&quot;, userService.findUserById(comment.getUserId()));            // ç‚¹èµæ•°é‡            likeCount = likeService.findEntityLikeCount(ENTITY_TYPE_COMMENT, comment.getId());            commentVo.put(&quot;likeCount&quot;, likeCount);            // ç‚¹èµçŠ¶æ€            likeStatus = hostHolder.getUser() == null ? 0 :                    likeService.findEntityLikeStatus(hostHolder.getUser().getId(), ENTITY_TYPE_COMMENT, comment.getId());            commentVo.put(&quot;likeStatus&quot;, likeStatus);            // å›å¤åˆ—è¡¨            List&lt;Comment&gt; replyList = commentService.findCommentsByEntity(ENTITY_TYPE_COMMENT, comment.getId(), 0, Integer.MAX_VALUE);            // å›å¤ VO åˆ—è¡¨            List&lt;Map&lt;String, Object&gt;&gt; replyVoList = new ArrayList&lt;&gt;();            if (replyList != null) &#123;                for (Comment reply : replyList) &#123;                    Map&lt;String, Object&gt; replyVo = new HashMap&lt;&gt;();                    // å›å¤                    replyVo.put(&quot;reply&quot;, reply);                    // ä½œè€…                    replyVo.put(&quot;user&quot;, userService.findUserById(reply.getUserId()));                    // å›å¤ç›®æ ‡                    User target = reply.getTargetId() == 0 ? null : userService.findUserById(reply.getTargetId());                    replyVo.put(&quot;target&quot;, target);                    // ç‚¹èµæ•°é‡                    likeCount = likeService.findEntityLikeCount(ENTITY_TYPE_COMMENT, reply.getId());                    replyVo.put(&quot;likeCount&quot;, likeCount);                    // ç‚¹èµçŠ¶æ€                    likeStatus = hostHolder.getUser() == null ? 0 :                            likeService.findEntityLikeStatus(hostHolder.getUser().getId(), ENTITY_TYPE_COMMENT, reply.getId());                    replyVo.put(&quot;likeStatus&quot;, likeStatus);                    replyVoList.add(replyVo);                &#125;            &#125;            commentVo.put(&quot;replys&quot;, replyVoList);            // å›å¤æ•°é‡            int replyCount = commentService.findCommentCount(ENTITY_TYPE_COMMENT, comment.getId());            commentVo.put(&quot;replyCount&quot;, replyCount);            commentVoList.add(commentVo);        &#125;    &#125;    model.addAttribute(&quot;comments&quot;, commentVoList);    return &quot;/site/discuss-detail&quot;;&#125;</code></pre><h1 id="2- æ”¶åˆ°çš„èµ"><a href="#2- æ”¶åˆ°çš„èµ" class="headerlink" title="2. æ”¶åˆ°çš„èµ"></a>2. æ”¶åˆ°çš„èµ</h1><ol><li>é‡æ„ç‚¹èµåŠŸèƒ½ï¼šä»¥ç”¨æˆ·ä¸º keyï¼Œè®°å½•ç‚¹èµæ•°é‡ï¼›<code>increment(key)</code>ã€<code>decrement(key)</code></li><li>å¼€å‘ä¸ªäººä¸»é¡µï¼šä»¥ç”¨æˆ·ä¸º keyï¼ŒæŸ¥è¯¢ç‚¹èµæ•°ã€‚</li></ol><h2 id="æ›´æ–°å·¥å…·ç±» -RedisUtil"><a href="# æ›´æ–°å·¥å…·ç±» -RedisUtil" class="headerlink" title="æ›´æ–°å·¥å…·ç±» RedisUtil"></a>æ›´æ–°å·¥å…·ç±» RedisUtil</h2><ul><li><p>æ–°å¢ç”¨æˆ·è·å¾—èµ key çš„å‰ç¼€å¸¸é‡ <code>like:user</code></p></li><li><p>æ–°å¢æ–¹æ³• <code>getUserLikeKey(int userId)</code>ï¼Œé€šè¿‡ç”¨æˆ· id ç”Ÿæˆå¯¹åº”ç”¨æˆ·è·å¾—èµçš„ keyã€‚</p></li></ul><pre><code class="java">public class RedisKeyUtil &#123;    private static final String SPLIT = &quot;:&quot;;    private static final String PREFIX_ENTITY_LIKE = &quot;like:entity&quot;;    private static final String PREFIX_USER_LIKE = &quot;like:user&quot;;    // æŸä¸ªå®ä½“çš„èµ    // like:entity:entityType:entityId -&gt; set(userId)    public static String getEntityLikeKey(int entityType, int entityId) &#123;        return PREFIX_ENTITY_LIKE + SPLIT + entityType + SPLIT + entityId;    &#125;    // æŸä¸ªç”¨æˆ·çš„èµ    // like:user:userId -&gt; int    public static String getUserLikeKey(int userId) &#123;        return PREFIX_USER_LIKE + SPLIT + userId;    &#125;&#125;</code></pre><h2 id="æ›´æ–°ä¸šåŠ¡å±‚çš„ -LikeService ç±»"><a href="# æ›´æ–°ä¸šåŠ¡å±‚çš„ -LikeService ç±»" class="headerlink" title="æ›´æ–°ä¸šåŠ¡å±‚çš„ LikeService ç±»"></a>æ›´æ–°ä¸šåŠ¡å±‚çš„ LikeService ç±»</h2><ul><li>é‡æ„æ–¹æ³• <code>like()</code>ï¼Œåœ¨å‚æ•°åˆ—è¡¨ä¸­æ–°å¢ï¼šentityUserIdï¼ˆè¡¨ç¤ºè¢«ç‚¹èµç”¨æˆ·çš„ idï¼‰ï¼Œè¯¥å‚æ•°ç”¨æ¥æ›´æ–°ç”¨æˆ·çš„è¢«ç‚¹èµæ•°é‡ã€‚<ul><li>è°ƒç”¨ <code>RedisTemplate</code> å®ä¾‹çš„æ–¹æ³• <code>execute()</code> å®ç°äº‹åŠ¡ï¼Œä¿è¯è¢«ç‚¹èµç”¨æˆ·ä¸ç‚¹èµç”¨æˆ·çš„æ•°æ®æ›´æ–°ä¿æŒä¸€è‡´ã€‚è°ƒç”¨ <code>isMember()</code> æŸ¥è¯¢ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€ï¼Œä¹‹åè°ƒç”¨ <code>multi()</code> å¼€å¯äº‹åŠ¡ã€‚</li><li>å½“ç”¨æˆ·å·²ç‚¹èµæ—¶ï¼Œè°ƒç”¨æ–¹æ³• <code>remove()</code> å°†å½“å‰ç”¨æˆ·ä»ç‚¹èµçš„ç”¨æˆ·é›†åˆä¸­ç§»é™¤ï¼Œè°ƒç”¨æ–¹æ³• <code>decrement()</code> å°†è¢«ç‚¹èµç”¨æˆ·çš„è¢«ç‚¹èµæ•°å‡å» 1ï¼›å½“ç”¨æˆ·æœªç‚¹èµæ—¶ï¼Œè°ƒç”¨æ–¹æ³• <code>add()</code> å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°ç‚¹èµçš„ç”¨æˆ·é›†åˆä¸­ï¼Œè°ƒç”¨æ–¹æ³• <code>increment()</code> å°†è¢«ç‚¹èµç”¨æˆ·çš„ç‚¹èµæ•°åŠ ä¸Š 1ã€‚</li></ul></li><li>æ–°å¢æ–¹æ³• <code>findUserLikeCount()</code>ï¼Œä»¥ç”¨æˆ· id ä¸º keyï¼Œè°ƒç”¨æ–¹æ³• <code>get()</code> æŸ¥è¯¢ç”¨æˆ·æ‰€è·ç‚¹èµæ•°ã€‚</li></ul><pre><code class="java">@Servicepublic class LikeService &#123;    @Autowired    private RedisTemplate redisTemplate;    // ç‚¹èµ    public void like(int userId, int entityType, int entityId, int entityUserId) &#123;        redisTemplate.execute(new SessionCallback() &#123;            @Override            public Object execute(RedisOperations operations) throws DataAccessException &#123;                String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);                String userLikeKey = RedisKeyUtil.getUserLikeKey(entityUserId);                boolean isMember = operations.opsForSet().isMember(entityLikeKey, userId);                operations.multi();                if (isMember) &#123;                    operations.opsForSet().remove(entityLikeKey, userId);                    operations.opsForValue().decrement(userLikeKey);                &#125; else &#123;                    operations.opsForSet().add(entityLikeKey, userId);                    operations.opsForValue().increment(userLikeKey);                &#125;                return operations.exec();            &#125;        &#125;);    &#125;    // æŸ¥è¯¢æŸå®ä½“ç‚¹èµçš„æ•°é‡    public long findEntityLikeCount(int entityType, int entityId) &#123;        String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);        return redisTemplate.opsForSet().size(entityLikeKey);    &#125;    // æŸ¥è¯¢æŸäººå¯¹æŸå®ä½“çš„ç‚¹èµçŠ¶æ€    public int findEntityLikeStatus(int userId, int entityType, int entityId) &#123;        String entityLikeKey = RedisKeyUtil.getEntityLikeKey(entityType, entityId);        return redisTemplate.opsForSet().isMember(entityLikeKey, userId) ? 1 : 0;    &#125;    // æŸ¥è¯¢æŸä¸ªç”¨æˆ·è·å¾—çš„èµ    public int findUserLikeCount(int userId) &#123;        String userLikeKey = RedisKeyUtil.getUserLikeKey(userId);        Integer count = (Integer) redisTemplate.opsForValue().get(userLikeKey);        return count == null ? 0 : count.intValue();    &#125;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -LikeController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -LikeController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ LikeController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ LikeController ç±»</h2><ul><li>æ›´æ–°æ–¹æ³• <code>like()</code>ï¼šåœ¨å‚æ•°åˆ—è¡¨ä¸­æ–°å¢å‚æ•° entityUserIdï¼ˆè¡¨ç¤ºè¢«ç‚¹èµç”¨æˆ·çš„ idï¼‰ã€‚</li></ul><pre><code class="java">@Controllerpublic class LikeController &#123;    @Autowired    private LikeService likeService;    @Autowired    private HostHolder hostHolder;    @PostMapping(&quot;/like&quot;)    @ResponseBody    public String like(int entityType, int entityId, int entityUserId) &#123;        User user = hostHolder.getUser();        // ç‚¹èµ        likeService.like(user.getId(), entityType, entityId, entityUserId);        // æ•°é‡        long likeCount = likeService.findEntityLikeCount(entityType, entityId);        // çŠ¶æ€        int likeStatus = likeService.findEntityLikeStatus(user.getId(), entityType, entityId);        // è¿”å›çš„ç»“æœ        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        map.put(&quot;likeCount&quot;, likeCount);        map.put(&quot;likeStatus&quot;, likeStatus);        return CommunityUtil.getJSONString(0, null, map);    &#125;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -UserController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -UserController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ UserController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ UserController ç±»</h2><ul><li>æ–°å¢æ–¹æ³•<code>getProfilePage()</code>ï¼šè°ƒç”¨ä¸šåŠ¡å±‚çš„æ–¹æ³•æŸ¥è¯¢ç”¨æˆ·å’Œç‚¹èµæ•°ï¼Œå¹¶å°†ä¸¤é¡¹ä¿¡æ¯å­˜å‚¨äº Model å¯¹è±¡ä¸­ã€‚</li></ul><pre><code class="java">// ä¸ªäººä¸»é¡µ@RequestMapping(path = &quot;/profile/&#123;userId&#125;&quot;, method = RequestMethod.GET)public String getProfilePage(@PathVariable(&quot;userId&quot;) int userId, Model model) &#123;    User user = userService.findUserById(userId);    if (user == null) &#123;        throw new RuntimeException(&quot; è¯¥ç”¨æˆ·ä¸å­˜åœ¨!&quot;);    &#125;    // ç”¨æˆ·    model.addAttribute(&quot;user&quot;, user);    // ç‚¹èµæ•°é‡    int likeCount = likeService.findUserLikeCount(userId);    model.addAttribute(&quot;likeCount&quot;, likeCount);    return &quot;/site/profile&quot;;&#125;</code></pre><h1 id="3- å…³æ³¨"><a href="#3- å…³æ³¨" class="headerlink" title="3. å…³æ³¨"></a>3. å…³æ³¨ </h1><h2 id="æ›´æ–°å·¥å…·ç±» -RedisUtil-1"><a href="# æ›´æ–°å·¥å…·ç±» -RedisUtil-1" class="headerlink" title="æ›´æ–°å·¥å…·ç±» RedisUtil"></a> æ›´æ–°å·¥å…·ç±» RedisUtil</h2><ul><li>æ–°å¢ç”¨æˆ·å…³æ³¨å®ä½“ï¼ˆå¸–å­ã€è¯„è®ºã€ç”¨æˆ·ç­‰ï¼‰çš„å‰ç¼€å¸¸é‡ followee å’Œç²‰ä¸ï¼ˆç”¨æˆ·ï¼‰çš„å‰ç¼€å¸¸é‡ followerã€‚</li><li>æ–°å¢æ–¹æ³• <code>getFolloweeKey(int userId, int entityType)</code>ï¼Œé€šè¿‡ç”¨æˆ· id å’Œå®ä½“ç±»å‹ç”Ÿæˆç”¨æˆ·å…³æ³¨å®ä½“çš„ keyã€‚</li><li>æ–°å¢æ–¹æ³• <code>getFollowerKey(int entityType, int entityId)</code>ï¼Œé€šè¿‡å®ä½“ç±»å‹å’Œå®ä½“ id ç”Ÿæˆå®ä½“ç”¨æˆ·ç²‰ä¸çš„ keyã€‚</li></ul><pre><code class="java">public class RedisKeyUtil &#123;    private static final String SPLIT = &quot;:&quot;;    private static final String PREFIX_ENTITY_LIKE = &quot;like:entity&quot;;    private static final String PREFIX_USER_LIKE = &quot;like:user&quot;;    private static final String PREFIX_FOLLOWEE = &quot;followee&quot;;    private static final String PREFIX_FOLLOWER = &quot;follower&quot;;    // æŸä¸ªå®ä½“çš„èµ    // like:entity:entityType:entityId -&gt; set(userId)    public static String getEntityLikeKey(int entityType, int entityId) &#123;        return PREFIX_ENTITY_LIKE + SPLIT + entityType + SPLIT + entityId;    &#125;    // æŸä¸ªç”¨æˆ·çš„èµ    // like:user:userId -&gt; int    public static String getUserLikeKey(int userId) &#123;        return PREFIX_USER_LIKE + SPLIT + userId;    &#125;    // æŸä¸ªç”¨æˆ·å…³æ³¨çš„å®ä½“    // followee:userId:entityType -&gt; zset(entityId,now)    public static String getFolloweeKey(int userId, int entityType) &#123;        return PREFIX_FOLLOWEE + SPLIT + userId + SPLIT + entityType;    &#125;    // æŸä¸ªå®ä½“æ‹¥æœ‰çš„ç²‰ä¸    // follower:entityType:entityId -&gt; zset(userId,now)    public static String getFollowerKey(int entityType, int entityId) &#123;        return PREFIX_FOLLOWER + SPLIT + entityType + SPLIT + entityId;    &#125;&#125;</code></pre><h2 id="åˆ›å»ºä¸šåŠ¡å±‚çš„ -FollowService- ç±»"><a href="# åˆ›å»ºä¸šåŠ¡å±‚çš„ -FollowService- ç±»" class="headerlink" title="åˆ›å»ºä¸šåŠ¡å±‚çš„ FollowService ç±»"></a>åˆ›å»ºä¸šåŠ¡å±‚çš„ FollowService ç±»</h2><ul><li><p>æ–°å¢æ–¹æ³• <code>follow()</code>ï¼Œå½“ç”¨æˆ·å…³æ³¨æŸå®ä½“æ—¶ï¼š</p><ul><li>è°ƒç”¨æ–¹æ³• <code>add() </code>å°†å½“å‰å®ä½“ id å’Œæ—¶é—´ä½œä¸º value å’Œ score åŠ å…¥åˆ°ç”¨æˆ·çš„å…³æ³¨é›†åˆä¸­ã€‚</li><li>è°ƒç”¨æ–¹æ³• <code>add()</code> å°†å½“å‰ç”¨æˆ· id å’Œæ—¶é—´ä½œä¸º value å’Œ score åŠ å…¥åˆ°å®ä½“çš„ç²‰ä¸é›†åˆä¸­ã€‚</li></ul></li><li><p>æ–°å¢æ–¹æ³• <code>unfollow()</code>ï¼Œå½“ç”¨æˆ·å–å…³æŸå®ä½“æ—¶ï¼š</p><ul><li>è°ƒç”¨æ–¹æ³• <code>remove()</code> å°†å½“å‰å®ä½“ä»ç”¨æˆ·çš„å…³æ³¨é›†åˆä¸­ç§»é™¤ã€‚</li><li>è°ƒç”¨æ–¹æ³• <code>remove()</code> å°†ç”¨æˆ·ä»å®ä½“çš„ç²‰ä¸é›†åˆä¸­ç§»é™¤ã€‚</li></ul></li></ul><pre><code class="java">@Servicepublic class FollowService &#123;    @Autowired    private RedisTemplate redisTemplate;    public void follow(int userId, int entityType, int entityId) &#123;        redisTemplate.execute(new SessionCallback() &#123;            @Override            public Object execute(RedisOperations operations) throws DataAccessException &#123;                String followeeKey = RedisKeyUtil.getFolloweeKey(userId, entityType);                String followerKey = RedisKeyUtil.getFollowerKey(entityType, entityId);                operations.multi();                operations.opsForZSet().add(followeeKey, entityId, System.currentTimeMillis());                operations.opsForZSet().add(followerKey, userId, System.currentTimeMillis());                return operations.exec();            &#125;        &#125;);    &#125;    public void unfollow(int userId, int entityType, int entityId) &#123;        redisTemplate.execute(new SessionCallback() &#123;            @Override            public Object execute(RedisOperations operations) throws DataAccessException &#123;                String followeeKey = RedisKeyUtil.getFolloweeKey(userId, entityType);                String followerKey = RedisKeyUtil.getFollowerKey(entityType, entityId);                operations.multi();                operations.opsForZSet().remove(followeeKey, entityId);                operations.opsForZSet().remove(followerKey, userId);                return operations.exec();            &#125;        &#125;);    &#125;&#125;</code></pre><h2 id="åˆ›å»ºè¡¨ç°å±‚çš„ -FollowController"><a href="# åˆ›å»ºè¡¨ç°å±‚çš„ -FollowController" class="headerlink" title="åˆ›å»ºè¡¨ç°å±‚çš„ FollowController"></a>åˆ›å»ºè¡¨ç°å±‚çš„ FollowController</h2><ul><li>æ–°å¢æ–¹æ³• <code>follow()</code>ï¼šè°ƒç”¨ HostHolder å¯¹è±¡çš„æ–¹æ³•è·å–ç”¨æˆ·ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>FollowService</code> ç±»çš„å¯¹è±¡çš„æ–¹æ³• <code>follow()</code> å®ç°ç‚¹èµçš„åŠŸèƒ½ã€‚</li><li>æ–°å¢æ–¹æ³• <code>unfollow()</code>ï¼šè°ƒç”¨ HostHolder å¯¹è±¡çš„æ–¹æ³•è·å–ç”¨æˆ·ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>FollowService</code> ç±»çš„å¯¹è±¡çš„æ–¹æ³• <code>unfollow()</code> å®ç°å–æ¶ˆç‚¹èµçš„åŠŸèƒ½ã€‚</li></ul><pre><code class="java">@Controllerpublic class FollowController &#123;    @Autowired    private FollowService followService;    @Autowired    private HostHolder hostHolder;    @PostMapping(&quot;/follow&quot;)    @ResponseBody    public String follow(int entityType, int entityId) &#123;        User user = hostHolder.getUser();        followService.follow(user.getId(), entityType, entityId);        return CommunityUtil.getJSONString(0, &quot; å·²å…³æ³¨!&quot;);    &#125;    @PostMapping(&quot;/unfollow&quot;)    @ResponseBody    public String unfollow(int entityType, int entityId) &#123;        User user = hostHolder.getUser();        followService.unfollow(user.getId(), entityType, entityId);        return CommunityUtil.getJSONString(0, &quot; å·²å–æ¶ˆå…³æ³¨!&quot;);    &#125;&#125;</code></pre><h1 id="4- ä¸ªäººä¸»é¡µ"><a href="#4- ä¸ªäººä¸»é¡µ" class="headerlink" title="4. ä¸ªäººä¸»é¡µ"></a>4. ä¸ªäººä¸»é¡µ </h1><h2 id="æ›´æ–°ä¸šåŠ¡å±‚çš„ -FollowService- ç±»"><a href="# æ›´æ–°ä¸šåŠ¡å±‚çš„ -FollowService- ç±»" class="headerlink" title="æ›´æ–°ä¸šåŠ¡å±‚çš„ FollowService ç±»"></a> æ›´æ–°ä¸šåŠ¡å±‚çš„ FollowService ç±»</h2><ul><li><p>æ–°å¢æ–¹æ³• <code>findFolloweeCount()</code>ï¼Œè°ƒç”¨ zset é›†åˆçš„æ–¹æ³• <code>zcard()</code> æŸ¥è¯¢æŸç”¨æˆ·å…³æ³¨çš„å®ä½“æ•°é‡ã€‚</p></li><li><p>æ–°å¢æ–¹æ³• <code>findFollowerCount()</code>ï¼Œè°ƒç”¨ zset é›†åˆçš„æ–¹æ³• <code>zcard()</code> æŸ¥è¯¢æŸå®ä½“çš„ç²‰ä¸æ•°é‡ã€‚</p></li><li><p>æ–°å¢æ–¹æ³• <code>hasFollowed()</code>ï¼Œæ ¹æ® zset é›†åˆçš„æ–¹æ³• <code>zscore()</code> çš„è¿”å›å€¼æŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦å…³æ³¨äº†æŸå®ä½“ã€‚</p></li></ul><pre><code class="java">// æŸ¥è¯¢å…³æ³¨çš„å®ä½“çš„æ•°é‡public long findFolloweeCount(int userId, int entityType) &#123;    String followeeKey = RedisKeyUtil.getFolloweeKey(userId, entityType);    return redisTemplate.opsForZSet().zCard(followeeKey);&#125;// æŸ¥è¯¢å®ä½“çš„ç²‰ä¸çš„æ•°é‡public long findFollowerCount(int entityType, int entityId) &#123;    String followerKey = RedisKeyUtil.getFollowerKey(entityType, entityId);    return redisTemplate.opsForZSet().zCard(followerKey);&#125;// æŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦å·²å…³æ³¨è¯¥å®ä½“public boolean hasFollowed(int userId, int entityType, int entityId) &#123;    String followeeKey = RedisKeyUtil.getFolloweeKey(userId, entityType);    return redisTemplate.opsForZSet().score(followeeKey, entityId) != null;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -UserController- ç±» -1"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -UserController- ç±» -1" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ UserController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ UserController ç±»</h2><ul><li><p>è°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>LikeService</code> ç±»ä¸­çš„æ–¹æ³• <code>findUserLikeCount()</code> æŸ¥è¯¢ç”¨æˆ·è·èµæ•°ï¼Œå¹¶æ·»åŠ åˆ° Model ä¸­ã€‚</p></li><li><p>è°ƒç”¨ä¸šåŠ¡å±‚çš„ <code>FollowService</code> ç±»ä¸­çš„æ–¹æ³• <code>findFolloweeCount()</code> æŸ¥è¯¢å…³æ³¨æ•°é‡ï¼Œè°ƒç”¨æ–¹æ³• <code>findFollowerCount()</code> æŸ¥è¯¢ç²‰ä¸æ•°é‡ï¼Œè°ƒç”¨æ–¹æ³• <code>hasFollowed()</code> æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å…³æ³¨ï¼Œå¹¶å°†ä¸‰é¡¹ä¿¡æ¯å­˜å‚¨äº Model å¯¹è±¡ä¸­ã€‚</p></li><li><p>æ›´æ–°è·å–ä¸ªäººä¸»é¡µæ–¹æ³• <code>getProfilePage()</code>ï¼šæ–°å¢å…³æ³¨æ•°ã€ç²‰ä¸æ•°ã€åˆ¤æ–­æ˜¯å¦å·²å…³æ³¨ï¼Œå¹¶å°†ä¸‰é¡¹ä¿¡æ¯å­˜å‚¨äº Model å¯¹è±¡ä¸­ã€‚</p></li></ul><pre><code class="java">// ä¸ªäººä¸»é¡µ@RequestMapping(path = &quot;/profile/&#123;userId&#125;&quot;, method = RequestMethod.GET)public String getProfilePage(@PathVariable(&quot;userId&quot;) int userId, Model model) &#123;    User user = userService.findUserById(userId);    if (user == null) &#123;        throw new RuntimeException(&quot; è¯¥ç”¨æˆ·ä¸å­˜åœ¨!&quot;);    &#125;    // ç”¨æˆ·    model.addAttribute(&quot;user&quot;, user);    // ç‚¹èµæ•°é‡    int likeCount = likeService.findUserLikeCount(userId);    model.addAttribute(&quot;likeCount&quot;, likeCount);    // å…³æ³¨æ•°é‡    long followeeCount = followService.findFolloweeCount(userId, ENTITY_TYPE_USER);    model.addAttribute(&quot;followeeCount&quot;, followeeCount);    // ç²‰ä¸æ•°é‡    long followerCount = followService.findFollowerCount(ENTITY_TYPE_USER, userId);    model.addAttribute(&quot;followerCount&quot;, followerCount);    // æ˜¯å¦å·²å…³æ³¨    boolean hasFollowed = false;    if (hostHolder.getUser() != null) &#123;        hasFollowed = followService.hasFollowed(hostHolder.getUser().getId(), ENTITY_TYPE_USER, userId);    &#125;    model.addAttribute(&quot;hasFollowed&quot;, hasFollowed);    return &quot;/site/profile&quot;;&#125;</code></pre><h1 id="5- å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨"><a href="#5- å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨" class="headerlink" title="5. å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨"></a>5. å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨ </h1><h2 id="æ›´æ–°ä¸šåŠ¡å±‚çš„ -FollowService- ç±» -1"><a href="# æ›´æ–°ä¸šåŠ¡å±‚çš„ -FollowService- ç±» -1" class="headerlink" title="æ›´æ–°ä¸šåŠ¡å±‚çš„ FollowService ç±»"></a> æ›´æ–°ä¸šåŠ¡å±‚çš„ FollowService ç±»</h2><ul><li><p>æ–°å¢æ–¹æ³• <code>findFollowees()</code>ï¼šæŸ¥è¯¢ç”¨æˆ·å…³æ³¨åˆ—è¡¨ã€‚é€šè¿‡ zset é›†åˆçš„æ–¹æ³• <code>reverseRange()</code> è·å– value å³å…³æ³¨ç”¨æˆ·çš„ userIdï¼Œå†æŸ¥è¯¢å‡ºå…¶å¯¹åº”çš„ userï¼Œä¹‹åé€šè¿‡ score è·å–å…³æ³¨æ—¶é—´ï¼Œå­˜å…¥ map é›†åˆä¸­ï¼Œå°† map æ·»åŠ åˆ° list åˆ—è¡¨ä¸­å¹¶è¿”å›ã€‚</p></li><li><p>æ–°å¢æ–¹æ³• <code>findFollowers()</code>ï¼šæŸ¥è¯¢ç”¨æˆ·ç²‰ä¸åˆ—è¡¨ã€‚é€šè¿‡ zset é›†åˆçš„æ–¹æ³• <code>reverseRange()</code> è·å– value å³ç²‰ä¸çš„ userIdï¼Œå†æŸ¥è¯¢å‡ºå…¶å¯¹åº”çš„ userï¼Œä¹‹åé€šè¿‡ score è·å–å…³æ³¨æ—¶é—´ï¼Œå­˜å…¥ map é›†åˆä¸­ï¼Œå°† map æ·»åŠ åˆ° list åˆ—è¡¨ä¸­å¹¶è¿”å›ã€‚</p></li><li><p>æ–°å¢æ–¹æ³• <code>hasFollowed()</code>ï¼Œæ ¹æ® zset é›†åˆçš„æ–¹æ³• <code>zscore()</code> çš„è¿”å›å€¼æŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦å…³æ³¨äº†æŸå®ä½“ã€‚</p></li></ul><pre><code class="java">// æŸ¥è¯¢æŸç”¨æˆ·å…³æ³¨çš„äººpublic List&lt;Map&lt;String, Object&gt;&gt; findFollowees(int userId, int offset, int limit) &#123;    String followeeKey = RedisKeyUtil.getFolloweeKey(userId, ENTITY_TYPE_USER);    Set&lt;Integer&gt; targetIds = redisTemplate.opsForZSet().reverseRange(followeeKey, offset, offset + limit - 1);    if (targetIds == null) &#123;        return null;    &#125;    List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;&gt;();    for (Integer targetId : targetIds) &#123;        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        User user = userService.findUserById(targetId);        map.put(&quot;user&quot;, user);        Double score = redisTemplate.opsForZSet().score(followeeKey, targetId);        map.put(&quot;followTime&quot;, new Date(score.longValue()));        list.add(map);    &#125;    return list;&#125;// æŸ¥è¯¢æŸç”¨æˆ·çš„ç²‰ä¸public List&lt;Map&lt;String, Object&gt;&gt; findFollowers(int userId, int offset, int limit) &#123;    String followerKey = RedisKeyUtil.getFollowerKey(ENTITY_TYPE_USER, userId);    Set&lt;Integer&gt; targetIds = redisTemplate.opsForZSet().reverseRange(followerKey, offset, offset + limit - 1);    if (targetIds == null) &#123;        return null;    &#125;    List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;&gt;();    for (Integer targetId : targetIds) &#123;        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        User user = userService.findUserById(targetId);        map.put(&quot;user&quot;, user);        Double score = redisTemplate.opsForZSet().score(followerKey, targetId);        map.put(&quot;followTime&quot;, new Date(score.longValue()));        list.add(map);    &#125;    return list;&#125;</code></pre><h2 id="æ›´æ–°è¡¨ç°å±‚çš„ -FollowController- ç±»"><a href="# æ›´æ–°è¡¨ç°å±‚çš„ -FollowController- ç±»" class="headerlink" title="æ›´æ–°è¡¨ç°å±‚çš„ FollowController ç±»"></a>æ›´æ–°è¡¨ç°å±‚çš„ FollowController ç±»</h2><ul><li>æ–°å¢æ–¹æ³• <code>getFollowees()</code>ï¼Œè·å–å…³æ³¨åˆ—è¡¨ï¼Œå­˜å…¥ Model å¯¹è±¡ä¸­ã€‚</li><li>æ–°å¢æ–¹æ³• <code>getFollowers()</code>ï¼Œè·å–ç²‰ä¸åˆ—è¡¨ï¼Œå­˜å…¥ Model å¯¹è±¡ä¸­ã€‚</li></ul><pre><code class="java">@GetMapping(&quot;/followees/&#123;userId&#125;&quot;)public String getFollowees(@PathVariable(&quot;userId&quot;) int userId, Page page, Model model) &#123;    User user = userService.findUserById(userId);    if (user == null) &#123;        throw new RuntimeException(&quot; è¯¥ç”¨æˆ·ä¸å­˜åœ¨!&quot;);    &#125;    model.addAttribute(&quot;user&quot;, user);    page.setLimit(5);    page.setPath(&quot;/followees/&quot; + userId);    page.setRows((int) followService.findFolloweeCount(userId, ENTITY_TYPE_USER));    List&lt;Map&lt;String, Object&gt;&gt; userList = followService.findFollowees(userId, page.getOffset(), page.getLimit());    if (userList != null) &#123;        for (Map&lt;String, Object&gt; map : userList) &#123;            User u = (User) map.get(&quot;user&quot;);            map.put(&quot;hasFollowed&quot;, hasFollowed(u.getId()));        &#125;    &#125;    model.addAttribute(&quot;users&quot;, userList);    return &quot;/site/followee&quot;;&#125;@GetMapping(&quot;/followers/&#123;userId&#125;&quot;)public String getFollowers(@PathVariable(&quot;userId&quot;) int userId, Page page, Model model) &#123;    User user = userService.findUserById(userId);    if (user == null) &#123;        throw new RuntimeException(&quot; è¯¥ç”¨æˆ·ä¸å­˜åœ¨!&quot;);    &#125;    model.addAttribute(&quot;user&quot;, user);    page.setLimit(5);    page.setPath(&quot;/followers/&quot; + userId);    page.setRows((int) followService.findFollowerCount(ENTITY_TYPE_USER, userId));    List&lt;Map&lt;String, Object&gt;&gt; userList = followService.findFollowers(userId, page.getOffset(), page.getLimit());    if (userList != null) &#123;        for (Map&lt;String, Object&gt; map : userList) &#123;            User u = (User) map.get(&quot;user&quot;);            map.put(&quot;hasFollowed&quot;, hasFollowed(u.getId()));        &#125;    &#125;    model.addAttribute(&quot;users&quot;, userList);    return &quot;/site/follower&quot;;&#125;private boolean hasFollowed(int userId) &#123;    if (hostHolder.getUser() == null) &#123;        return false;    &#125;    return followService.hasFollowed(hostHolder.getUser().getId(), ENTITY_TYPE_USER, userId);&#125;</code></pre><h1 id="6- ä¼˜åŒ–ç™»å½•æ¨¡å—"><a href="#6- ä¼˜åŒ–ç™»å½•æ¨¡å—" class="headerlink" title="6. ä¼˜åŒ–ç™»å½•æ¨¡å—"></a>6. ä¼˜åŒ–ç™»å½•æ¨¡å—</h1><ol><li><p>ä½¿ç”¨ Redis å­˜å‚¨éªŒè¯ç ï¼šéªŒè¯ç éœ€è¦é¢‘ç¹è®¿é—®ä¸åˆ·æ–°ï¼Œå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼›éªŒè¯ç ä¸éœ€è¦æ°¸ä¹…ä¿å­˜ï¼Œé€šå¸¸åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å°±ä¼šå¤±æ•ˆï¼›åˆ†å¸ƒå¼éƒ¨ç½²æ—¶ï¼Œå­˜åœ¨ Session å…±äº«çš„é—®é¢˜ã€‚</p></li><li><p>ä½¿ç”¨ Redis å­˜å‚¨ç™»å½•å‡­è¯ï¼šå¤„ç†æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œéƒ½è¦æŸ¥è¯¢ç”¨æˆ·çš„ç™»å½•å‡­è¯ï¼Œè®¿é—®çš„é¢‘ç‡éå¸¸é«˜ã€‚</p></li><li><p>ä½¿ç”¨ Redis ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ï¼šæ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶ï¼Œéƒ½è¦æ ¹æ®å‡­è¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè®¿é—®çš„é¢‘ç‡éå¸¸é«˜ã€‚</p></li></ol><h2 id="6-1- å­˜å‚¨éªŒè¯ç "><a href="#6-1- å­˜å‚¨éªŒè¯ç " class="headerlink" title="6.1 å­˜å‚¨éªŒè¯ç "></a>6.1 å­˜å‚¨éªŒè¯ç </h2><ul><li>æ›´æ–°å·¥å…·ç±» RedisUtil<ul><li>æ–°å¢éªŒè¯ç å‰ç¼€å¸¸é‡ <code>kaptcha</code></li><li>æ–°å¢æ–¹æ³• <code>getKaptchaKey()</code>ï¼Œé€šè¿‡ç”¨æˆ·å‡­è¯ï¼ˆç”±äºæœªç™»å½•ï¼Œé‡‡ç”¨ cookie å®ç°ï¼‰è·å¾—å¯¹åº”éªŒè¯ç çš„ keyï¼ˆåˆ©ç”¨ String å­˜å‚¨éªŒè¯ç ï¼‰ã€‚</li></ul></li></ul><pre><code class="java">private static final String PREFIX_KAPTCHA = &quot;kaptcha&quot;;// ç™»å½•éªŒè¯ç public static String getKaptchaKey(String owner) &#123;    return PREFIX_KAPTCHA + SPLIT + owner;&#125;</code></pre><ul><li>æ›´æ–°è¡¨ç°å±‚çš„ LoginController ç±»<ul><li>é‡æ„æ–¹æ³• <code>getKaptcha()</code>ï¼Œå°†éªŒè¯ç å­˜å…¥ redisï¼Œkey ä¸ºå½“å‰éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼ŒåŒæ—¶å°†è¯¥å­—ç¬¦ä¸²å­˜å…¥ cookieã€‚</li><li>é‡æ„æ–¹æ³• <code>login()</code>ï¼Œä» cookie ä¸­è·å–éšæœºå­—ç¬¦ä¸²ï¼Œç”ŸæˆéªŒè¯ç çš„ keyï¼Œç„¶åè·å– key å¯¹åº”çš„ value å³éªŒè¯ç ã€‚</li></ul></li></ul><pre><code class="java">@GetMapping(&quot;/kaptcha&quot;)public void getKaptcha(HttpServletResponse response/*, HttpSession session*/) &#123;    // ç”ŸæˆéªŒè¯ç     String text = kaptchaProducer.createText();    BufferedImage image = kaptchaProducer.createImage(text);    // åŸæ¥çš„åšæ³•ï¼šå°†éªŒè¯ç å­˜å…¥ session    // session.setAttribute(&quot;kaptcha&quot;, text);    // éªŒè¯ç çš„å½’å±    String kaptchaOwner = CommunityUtil.generateUUID();    Cookie cookie = new Cookie(&quot;kaptchaOwner&quot;, kaptchaOwner);    cookie.setMaxAge(60);    cookie.setPath(contextPath);    response.addCookie(cookie);    // å°†éªŒè¯ç å­˜å…¥ Redis    String redisKey = RedisKeyUtil.getKaptchaKey(kaptchaOwner);    redisTemplate.opsForValue().set(redisKey, text, 60, TimeUnit.SECONDS);    // å°†å›¾ç‰‡è¾“å‡ºç»™æµè§ˆå™¨    response.setContentType(&quot;image/png&quot;);    try &#123;        OutputStream os = response.getOutputStream();        ImageIO.write(image, &quot;png&quot;, os);    &#125; catch (IOException e) &#123;        logger.error(&quot; å“åº”éªŒè¯ç å¤±è´¥:&quot; + e.getMessage());    &#125;&#125;@PostMapping(&quot;/login&quot;)public String login(String username, String password, String code, boolean rememberme,                    Model model, /*HttpSession session, */HttpServletResponse response,                    @CookieValue(&quot;kaptchaOwner&quot;) String kaptchaOwner) &#123;    // æ£€æŸ¥éªŒè¯ç     // String kaptcha = (String) session.getAttribute(&quot;kaptcha&quot;);    String kaptcha = null;    if (StringUtils.isNotBlank(kaptchaOwner)) &#123;        String redisKey = RedisKeyUtil.getKaptchaKey(kaptchaOwner);        kaptcha = (String) redisTemplate.opsForValue().get(redisKey);    &#125;    if (StringUtils.isBlank(kaptcha) || StringUtils.isBlank(code) || !kaptcha.equalsIgnoreCase(code)) &#123;        model.addAttribute(&quot;codeMsg&quot;, &quot; éªŒè¯ç ä¸æ­£ç¡®!&quot;);        return &quot;/site/login&quot;;    &#125;    // æ£€æŸ¥è´¦å·, å¯†ç     int expiredSeconds = rememberme ? REMEMBER_EXPIRED_SECONDS : DEFAULT_EXPIRED_SECONDS;    Map&lt;String, Object&gt; map = userService.login(username, password, expiredSeconds);    if (map.containsKey(&quot;ticket&quot;)) &#123;        Cookie cookie = new Cookie(&quot;ticket&quot;, map.get(&quot;ticket&quot;).toString());        cookie.setPath(contextPath);        cookie.setMaxAge(expiredSeconds);        response.addCookie(cookie);        return &quot;redirect:/index&quot;;    &#125; else &#123;        model.addAttribute(&quot;usernameMsg&quot;, map.get(&quot;usernameMsg&quot;));        model.addAttribute(&quot;passwordMsg&quot;, map.get(&quot;passwordMsg&quot;));        return &quot;/site/login&quot;;    &#125;&#125;</code></pre><h2 id="6-2- å­˜å‚¨ç™»å½•å‡­è¯"><a href="#6-2- å­˜å‚¨ç™»å½•å‡­è¯" class="headerlink" title="6.2 å­˜å‚¨ç™»å½•å‡­è¯"></a>6.2 å­˜å‚¨ç™»å½•å‡­è¯</h2><ul><li>æ›´æ–°å·¥å…·ç±» RedisUtil<ul><li>æ–°å¢ç™»å½•å‡­è¯å‰ç¼€å¸¸é‡ <code>ticket</code></li><li>æ–°å¢æ–¹æ³• <code>getTicketKey</code>() ï¼Œé€šè¿‡å­—ç¬¦ä¸²è·å¾—ç™»å½•å‡­è¯çš„å¯¹åº” key ï¼ˆåˆ©ç”¨ String å­˜å‚¨ï¼‰ã€‚</li></ul></li></ul><pre><code class="java">private static final String PREFIX_TICKET = &quot;ticket&quot;;// ç™»å½•çš„å‡­è¯public static String getTicketKey(String ticket) &#123;    return PREFIX_TICKET + SPLIT + ticket;&#125;</code></pre><ul><li><p>æ›´æ–°ä¸šåŠ¡å±‚çš„ UserService ç±»</p><ul><li><p>é‡æ„æ–¹æ³• <code>login()</code> ï¼Œå°†ç™»å½•å‡­è¯å­˜å…¥ redis ä¸­ã€‚</p></li><li><p>é‡æ„æ–¹æ³• <code>logout</code>() ï¼Œå…ˆä» redis ä¸­è·å–ç™»å½•å‡­è¯å¯¹è±¡ï¼Œå°†çŠ¶æ€è®¾ä¸ºæ— æ•ˆå†é‡æ–°å­˜å‚¨è¿› redisã€‚</p></li><li><p>é‡æ„æ–¹æ³• <code>findLoginTicket</code>() ï¼Œæ ¹æ® ticket å­—ç¬¦ä¸²è·å¾—å¯¹åº”ç™»å½•å‡­è¯çš„ keyï¼Œç„¶åä» redis æŸ¥è¯¢ç™»å½•å‡­è¯ã€‚</p></li></ul></li></ul><pre><code class="java">public Map&lt;String, Object&gt; login(String username, String password, int expiredSeconds) &#123;    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();    // ç©ºå€¼å¤„ç†    if (StringUtils.isBlank(username)) &#123;        map.put(&quot;usernameMsg&quot;, &quot; è´¦å·ä¸èƒ½ä¸ºç©º!&quot;);        return map;    &#125;    if (StringUtils.isBlank(password)) &#123;        map.put(&quot;passwordMsg&quot;, &quot; å¯†ç ä¸èƒ½ä¸ºç©º!&quot;);        return map;    &#125;    // éªŒè¯è´¦å·    User user = userMapper.selectByName(username);    if (user == null) &#123;        map.put(&quot;usernameMsg&quot;, &quot; è¯¥è´¦å·ä¸å­˜åœ¨!&quot;);        return map;    &#125;    // éªŒè¯çŠ¶æ€    if (user.getStatus() == 0) &#123;        map.put(&quot;usernameMsg&quot;, &quot; è¯¥è´¦å·æœªæ¿€æ´»!&quot;);        return map;    &#125;    // éªŒè¯å¯†ç     password = CommunityUtil.md5(password + user.getSalt());    if (!user.getPassword().equals(password)) &#123;        map.put(&quot;passwordMsg&quot;, &quot; å¯†ç ä¸æ­£ç¡®!&quot;);        return map;    &#125;    // ç”Ÿæˆç™»å½•å‡­è¯    LoginTicket loginTicket = new LoginTicket();    loginTicket.setUserId(user.getId());    loginTicket.setTicket(CommunityUtil.generateUUID());    loginTicket.setStatus(0);    loginTicket.setExpired(new Date(System.currentTimeMillis() + expiredSeconds * 1000));        // loginTicketMapper.insertLoginTicket(loginTicket);    String redisKey = RedisKeyUtil.getTicketKey(loginTicket.getTicket());    redisTemplate.opsForValue().set(redisKey, loginTicket);    map.put(&quot;ticket&quot;, loginTicket.getTicket());    return map;&#125;public void logout(String ticket) &#123;        // loginTicketMapper.updateStatus(ticket, 1);    String redisKey = RedisKeyUtil.getTicketKey(ticket);    LoginTicket loginTicket = (LoginTicket) redisTemplate.opsForValue().get(redisKey);    loginTicket.setStatus(1);    redisTemplate.opsForValue().set(redisKey, loginTicket);&#125;public LoginTicket findLoginTicket(String ticket) &#123;        // return loginTicketMapper.selectByTicket(ticket);    String redisKey = RedisKeyUtil.getTicketKey(ticket);    return (LoginTicket) redisTemplate.opsForValue().get(redisKey);&#125;public int updateHeader(int userId, String headerUrl) &#123;        // return userMapper.updateHeader(userId, headerUrl);    int rows = userMapper.updateHeader(userId, headerUrl);    clearCache(userId);    return rows;&#125;</code></pre><h2 id="6-3- ç¼“å­˜ç”¨æˆ·ä¿¡æ¯"><a href="#6-3- ç¼“å­˜ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="6.3 ç¼“å­˜ç”¨æˆ·ä¿¡æ¯"></a>6.3 ç¼“å­˜ç”¨æˆ·ä¿¡æ¯</h2><ul><li><p>æ›´æ–°å·¥å…·ç±» RedisUtil </p><ul><li><p>æ–°å¢ç”¨æˆ·å‰ç¼€å¸¸é‡ <code>user</code></p></li><li><p>æ–°å¢ <code>getUserKey</code> æ–¹æ³•ï¼Œé€šè¿‡ç”¨æˆ· id è·å¾—ç”¨æˆ·çš„å¯¹åº” key å€¼ï¼ˆåˆ©ç”¨ String å­˜å‚¨ï¼‰ã€‚</p></li></ul></li></ul><pre><code class="java">private static final String PREFIX_USER = &quot;user&quot;;// ç”¨æˆ·public static String getUserKey(int userId) &#123;    return PREFIX_USER + SPLIT + userId;&#125;</code></pre><ul><li><p>æ›´æ–°ä¸šåŠ¡å±‚çš„ UserService ç±»</p><ul><li><p>æ–°å¢ <code>getCache</code>()ï¼Œä»ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p></li><li><p>æ–°å¢ <code>initCache()</code>ï¼Œä» MySQL æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶å­˜å…¥ redisã€‚</p></li><li><p>æ–°å¢ <code>clearCache()</code>ï¼Œç”¨æˆ·ä¿¡æ¯å˜æ›´ï¼ˆæ›´æ–°å¤´åƒï¼Œæ¿€æ´»ï¼‰æ—¶æ¸…é™¤ç¼“å­˜ã€‚</p></li><li><p>é‡æ„ <code>findUserById()</code> æ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨ <code>getCache()</code>ä»ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœè·å–ä¸º null åˆ™è°ƒç”¨ <code>initCache()</code>ã€‚</p></li></ul></li></ul><pre><code class="java">// 1. ä¼˜å…ˆä»ç¼“å­˜ä¸­å–å€¼private User getCache(int userId) &#123;    String redisKey = RedisKeyUtil.getUserKey(userId);    return (User) redisTemplate.opsForValue().get(redisKey);&#125;// 2. å–ä¸åˆ°æ—¶åˆå§‹åŒ–ç¼“å­˜æ•°æ®private User initCache(int userId) &#123;    User user = userMapper.selectById(userId);    String redisKey = RedisKeyUtil.getUserKey(userId);    redisTemplate.opsForValue().set(redisKey, user, 3600, TimeUnit.SECONDS);    return user;&#125;// 3. æ•°æ®å˜æ›´æ—¶æ¸…é™¤ç¼“å­˜æ•°æ®private void clearCache(int userId) &#123;    String redisKey = RedisKeyUtil.getUserKey(userId);    redisTemplate.delete(redisKey);&#125;public User findUserById(int id) &#123;        // return userMapper.selectById(id);    User user = getCache(id);    if (user == null) &#123;        user = initCache(id);    &#125;    return user;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼æµåª’ä½“å¹³å° Kafka</title>
      <link href="/2023/03/07/Kafka/"/>
      <url>/2023/03/07/Kafka/</url>
      
        <content type="html"><![CDATA[<h1 id="Kafka- ç®€ä»‹"><a href="#Kafka- ç®€ä»‹" class="headerlink" title="Kafka ç®€ä»‹"></a>Kafka ç®€ä»‹ </h1><p>ğŸŒŸ <a href="http://kafka.apach.org/">Kafka å®˜ç½‘ </a></p><ul><li>Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµåª’ä½“å¹³å°ã€‚</li><li> åº”ç”¨åœºæ™¯ï¼šæ¶ˆæ¯ç³»ç»Ÿã€æ—¥å¿—æ”¶é›†ã€ç”¨æˆ·è¡Œä¸ºè¿½è¸ªã€æµå¼å¤„ç†ã€‚</li></ul><h1 id="Kafka- ç‰¹ç‚¹"><a href="#Kafka- ç‰¹ç‚¹" class="headerlink" title="Kafka ç‰¹ç‚¹"></a>Kafka ç‰¹ç‚¹ </h1><ul><li> é«˜ååé‡ </li><li> æ¶ˆæ¯æŒä¹…åŒ– </li><li> é«˜å¯é æ€§ </li><li> é«˜æ‰©å±•æ€§ </li></ul><h1 id="Kafka- æœ¯è¯­"><a href="#Kafka- æœ¯è¯­" class="headerlink" title="Kafka æœ¯è¯­"></a>Kafka æœ¯è¯­ </h1><ul><li>Broker</li><li>Zookeeper</li><li>Topic</li><li>Partition</li><li>Offset</li><li>Leader Replica</li><li>Follower Replica</li></ul><h1 id="Kafka- é…ç½®"><a href="#Kafka- é…ç½®" class="headerlink" title="Kafka é…ç½®"></a>Kafka é…ç½® </h1><ol><li> åœ¨ Kafka å®‰è£…åŒ…ä¸‹çš„ config æ–‡ä»¶å¤¹ä¸‹çš„ <code>zookeeper.properties</code> æ–‡ä»¶å†…ä¿®æ”¹ï¼š</li></ol><pre><code class="properties"># é»˜è®¤å­˜æ”¾è·¯å¾„dataDir=/tmp/zookeeper</code></pre><ol start="2"><li> åœ¨ Kafka å®‰è£…åŒ…ä¸‹çš„ config æ–‡ä»¶å¤¹ä¸‹çš„ <code>server.properties</code> æ–‡ä»¶å†…ä¿®æ”¹ï¼š</li></ol><pre><code class="properties"># é»˜è®¤å­˜æ”¾è·¯å¾„log.dirs=/tmp/kafka-logs</code></pre><h1 id="Kafka- å¸¸ç”¨å‘½ä»¤"><a href="#Kafka- å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Kafka å¸¸ç”¨å‘½ä»¤"></a>Kafka å¸¸ç”¨å‘½ä»¤ </h1><ol><li> æ‰“å¼€ä¸€ä¸ª terminal çª—å£ï¼Œå¯åŠ¨ Zookeeperï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ zookeeper-server-start.sh config\zookeeper.properties</code></pre><ol start="2"><li> æ‰“å¼€å¦ä¸€ä¸ª terminal çª—å£ï¼Œå¯åŠ¨ Kafkaï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ zookeeper-server-start.sh config\server.properties</code></pre><ol start="3"><li> æ‰“å¼€å¦ä¸€ä¸ª terminal çª—å£ï¼Œå‘å¸ƒ topic ä¸º testï¼Œåˆ›å»º 1 ä¸ªå‰¯æœ¬ï¼Œåˆ›å»º 1 ä¸ªåˆ†åŒºï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test</code></pre><ol start="4"><li> æŸ¥çœ‹æ˜¯å¦æˆåŠŸå‘å¸ƒ topicï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ kafka-topics.sh --list --bootstrap-server localhost:9092</code></pre><pre><code class="sh"># å‘å¸ƒ topic æˆåŠŸï¼Œterminal æ˜¾ç¤º testtest</code></pre><ol start="5"><li> ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯ï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ kafka-console-producer.sh --broker-list localhost:9092 --topic test</code></pre><ol start="6"><li> æ¶ˆè´¹è€…è®¢é˜…æ¶ˆæ¯ï¼š</li></ol><pre><code class="sh"># cd åˆ° Kafka çš„ bin ç›®å½•ä¸‹ï¼Œeg: /usr/local/kafka_2.13-3.4.0/bin~$ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning</code></pre><h1 id="Windows- ä¸‹å…³äº -Kafka- çš„ä½¿ç”¨æ³¨æ„ç‚¹"><a href="#Windows- ä¸‹å…³äº -Kafka- çš„ä½¿ç”¨æ³¨æ„ç‚¹" class="headerlink" title="Windows ä¸‹å…³äº Kafka çš„ä½¿ç”¨æ³¨æ„ç‚¹"></a>Windows ä¸‹å…³äº Kafka çš„ä½¿ç”¨æ³¨æ„ç‚¹ </h1><ul><li> é—®é¢˜ï¼šåœ¨ Windows çš„å‘½ä»¤è¡Œé‡Œå¯åŠ¨ Kafka ä¹‹åï¼Œå½“å…³é—­å‘½ä»¤è¡Œçª—å£æ—¶ï¼Œå°±ä¼šå¼ºåˆ¶å…³é—­ Kafkaã€‚è¿™ç§å…³é—­æ–¹å¼ä¸ºæš´åŠ›å…³é—­ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ Kafka æ— æ³•å®Œæˆå¯¹æ—¥å¿—æ–‡ä»¶çš„è§£é”ã€‚å±Šæ—¶ï¼Œå†æ¬¡å¯åŠ¨ Kafka çš„æ—¶å€™ï¼Œå°±ä¼šæç¤ºæ—¥å¿—æ–‡ä»¶è¢«é”ï¼Œæ— æ³•æˆåŠŸå¯åŠ¨ã€‚</li><li> æ–¹æ¡ˆï¼šå°† Kafka çš„æ—¥å¿—æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œå†æ¬¡å¯åŠ¨å³å¯ã€‚</li><li> å»ºè®®ï¼šä¸è¦æš´åŠ›å…³é—­ Kafkaï¼Œå»ºè®®é€šè¿‡åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ <code>kafka-server-stop</code> å‘½ä»¤æ¥å…³é—­å®ƒã€‚</li><li> å…¶ä»–ï¼šå°†æ¥åœ¨ Linux ä¸Šéƒ¨ç½² Kafka ä¹‹åï¼Œé‡‡ç”¨åå°è¿è¡Œçš„æ–¹å¼ï¼Œå°±ä¼šé¿å…è¿™æ ·çš„é—®é¢˜ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Kafka </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS ä¸‹å®‰è£… Node.js é¿å‘æŒ‡å—</title>
      <link href="/2023/03/05/macos_nodejs/"/>
      <url>/2023/03/05/macos_nodejs/</url>
      
        <content type="html"><![CDATA[<ul><li><p>ä¸å»ºè®®çš„æ–¹æ³•ï¼šç›´æ¥åˆ° Node å®˜ç½‘ä¸‹è½½ <code>.pkg</code> æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚</p></li><li><p>å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼šä½¿ç”¨ <code>npm install -g hexo-cli</code> ç­‰æŒ‡ä»¤ä¼šæŠ¥é”™æ²¡æœ‰å†™å…¥çš„æƒé™ï¼Œç”šè‡³å°è¯•å„ç§ <code>sudo</code> æƒé™éƒ½æ— æ•ˆã€‚</p></li><li><p>npm å®˜ç½‘æ•™ç¨‹ä¹Ÿä¸æ¨èé‡‡ç”¨ <code>installer</code> è¿›è¡Œå®‰è£…ã€‚</p></li></ul><h2 id="å®‰è£… Node-js å’Œ npm çš„æ­£ç¡®æ–¹æ³•"><a href="# å®‰è£… Node-js å’Œ npm çš„æ­£ç¡®æ–¹æ³•" class="headerlink" title="å®‰è£… Node.js å’Œ npm çš„æ­£ç¡®æ–¹æ³•"></a>å®‰è£… Node.js å’Œ npm çš„æ­£ç¡®æ–¹æ³• </h2><p>ğŸŒŸ ä½¿ç”¨ node ç‰ˆæœ¬ç®¡ç†å·¥<code>nvm</code>(node version manager) å®‰è£… Node.js å’Œ npmã€‚</p><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>å®‰è£…<code>nvm</code>ï¼š</p><pre><code>~$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</code></pre><p>éªŒè¯ <code>nvm</code> æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><pre><code>~$ command -v nvm</code></pre><p>è‹¥æˆåŠŸåˆ™å‡ºç°ä¸€è¡Œ <code>nvm</code> å­—ç¬¦ (è‹¥æœªå‡ºç°åˆ™é‡å¯<code>terminal</code>)ï¼ŒæŸ¥è¯¢<code>nvm</code> ç‰ˆæœ¬ï¼š</p><pre><code>~$ nvm --version</code></pre><p>è¿”å› <code>nvm</code> ç‰ˆæœ¬å·ï¼š<code>0.34.0</code></p><h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>ä½¿ç”¨ <code>nvm</code> å®‰è£…<code>node</code>ï¼š</p><pre><code>~$ nvm install node # &quot;node&quot; is an alias for the latest version</code></pre><h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>ä½¿ç”¨ <code>npm</code> æŒ‡ä»¤å®‰è£…<code>hexo</code>ï¼š</p><pre><code>~$ npm install -g hexo-cli</code></pre><p>åˆå§‹åŒ–<code>hexo</code>ï¼ŒæŒ‡å®šæ–‡ä»¶å¤¹åä¸º blogï¼š</p><pre><code>~$ hexo init blog</code></pre><p>è¿›å…¥ blog æ–‡ä»¶å¤¹ä¸‹ï¼Œå®‰è£…<code>npm</code>ï¼š</p><pre><code>~ $ cd blog~ $ npm istall</code></pre><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><p>Q1ï¼š<code>zsh: command not found: nvm</code></p><p>A1ï¼šè¿›å…¥ .nvm æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ .bash_profile æ–‡ä»¶ï¼Œè‹¥å­˜åœ¨è¯¥æ–‡ä»¶åˆ™ç›´æ¥æ‰“å¼€ï¼š</p><pre><code>cd ~/.nvmopen .bash_profile</code></pre><p>è‹¥ä¸å­˜åœ¨åˆ™å…ˆåˆ›å»º .bash_profile æ–‡ä»¶ï¼š</p><pre><code>touch .bash_profile</code></pre><p>ç„¶ååœ¨ .bash_profile æ–‡ä»¶å†…å†™å…¥ï¼š</p><pre><code>export NVM_DIR=&quot;$HOME/.nvm&quot;[-s &quot;$NVM_DIR/nvm.sh&quot;] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot; # This loads nvm</code></pre><p>å†™å…¥å®Œæ¯•åï¼Œå…³é—­æ–‡ä»¶ï¼Œæ‰§è¡Œ .bash_profile æ–‡ä»¶ï¼š</p><pre><code>source .bash_profile</code></pre><p>Q2ï¼šæ¯æ¬¡å…³é—­ <code>terminal</code> åï¼Œåˆå‡ºç° <code>zsh: command not found: nvm</code> ç­‰æ— æ³•æ‰¾åˆ°æŸæŒ‡ä»¤çš„æƒ…å†µï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ .bash_profile æ–‡ä»¶ã€‚</p><p>A2ï¼šåŸå› æ˜¯é‡‡ç”¨çš„ <code>terminal</code> æ˜¯<code>zsh</code>ï¼Œéœ€è¦å°†é…ç½®æ·»åŠ åˆ° .zshrc æ–‡ä»¶ä¸­ã€‚</p><p>æ‰“å¼€  .zshrc æ–‡ä»¶ï¼š</p><pre><code>open ~/.zshrc</code></pre><p>åœ¨ .zshrc æ–‡ä»¶å†…å†™å…¥ï¼š</p><pre><code>export NVM_DIR=~/.nvm[-s &quot;$NVM_DIR/nvm.sh&quot;] &amp;&amp; . &quot;$NVM_DIR/nvm.sh&quot;</code></pre><p>å†™å…¥å®Œæ¯•åï¼Œå…³é—­æ–‡ä»¶ï¼Œæ‰§è¡Œ .zshrc æ–‡ä»¶ï¼š</p><pre><code>source ~/.zshrc</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼æœç´¢å¼•æ“ Elasticsearch</title>
      <link href="/2023/03/02/Elasticsearch/"/>
      <url>/2023/03/02/Elasticsearch/</url>
      
        <content type="html"><![CDATA[<h1 id="Elasticsearch ç®€ä»‹"><a href="#Elasticsearch ç®€ä»‹" class="headerlink" title="Elasticsearch ç®€ä»‹"></a>Elasticsearch ç®€ä»‹ </h1><ul><li> ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€Restful é£æ ¼çš„æœç´¢å¼•æ“ã€‚ </li><li> æ”¯æŒå¯¹å„ç§ç±»å‹çš„æ•°æ®çš„æ£€ç´¢ã€‚ </li><li> æœç´¢é€Ÿåº¦å¿«ï¼Œå¯ä»¥æä¾›å®æ—¶çš„æœç´¢æœåŠ¡ã€‚ </li><li> ä¾¿äºæ°´å¹³æ‰©å±•ï¼Œæ¯ç§’å¯ä»¥å¤„ç† PB çº§æµ·é‡æ•°æ®ã€‚ </li><li>Elasticsearch æœ¯è¯­ <ul><li> ç´¢å¼•ã€ç±»å‹ã€æ–‡æ¡£ã€å­—æ®µ </li><li> é›†ç¾¤ã€èŠ‚ç‚¹ã€åˆ†ç‰‡ã€å‰¯æœ¬ã€‚</li></ul></li></ul><h1 id="Elasticsearch- é…ç½®"><a href="#Elasticsearch- é…ç½®" class="headerlink" title="Elasticsearch é…ç½®"></a>Elasticsearch é…ç½® </h1><ol><li> åœ¨ Elasticsearch å®‰è£…åŒ…ä¸‹çš„ config æ–‡ä»¶å¤¹ä¸‹çš„ <code>slasticsearch.yml</code> æ–‡ä»¶å†…ä¿®æ”¹ï¼š</li></ol><pre><code class="yaml"># é›†ç¾¤åcluster.name = my-application# æ•°æ®å­˜å‚¨è·¯å¾„path.data: /path/to/data# æ—¥å¿—å­˜æ”¾è·¯å¾„path.logs: /path/to/logs</code></pre><ol start="2"><li>ES é»˜è®¤ç”³è¯· 1G å†…å­˜ï¼Œå¯åœ¨ Elasticsearch å®‰è£…åŒ…ä¸‹çš„ config æ–‡ä»¶å¤¹ä¸‹çš„ <code>jvm.options</code> æ–‡ä»¶å†…ä¿®æ”¹ï¼š</li></ol><pre><code class="properties"># åˆå§‹å†…å­˜-Xms256m# æœ€å¤§å†…å­˜-Xmx512m</code></pre><ol start="3"><li> å®‰è£…åˆ†è¯æ’ä»¶ <a href="https://github.com/medcl/elasticsearch-analysis-ik">elasticsearch-analysis-ik</a>ï¼Œå°†å…¶æ”¾åˆ° Elasticsearch å®‰è£…åŒ…ä¸‹çš„ plugins æ–‡ä»¶å¤¹ä¸‹çš„ ik æ–‡ä»¶å¤¹ä¸‹ã€‚åœ¨ IKAnalyzer.cfg.xml æ–‡ä»¶å†…å¯ä»¥é…ç½®è‡ªå®šä¹‰è¯ï¼Œåœ¨åŒçº§ç›®å½•ä¸‹æ–°å»º <code>.dic</code> æ–‡ä»¶å³å¯ã€‚</li></ol><table><thead><tr><th align="center">IK version</th><th align="center">ES version</th></tr></thead><tbody><tr><td align="center">master</td><td align="center">7.x -&gt; master</td></tr><tr><td align="center">6.x</td><td align="center">6.x</td></tr><tr><td align="center">5.x</td><td align="center">5.x</td></tr><tr><td align="center">1.10.6</td><td align="center">2.4.6</td></tr><tr><td align="center">1.9.5</td><td align="center">2.3.5</td></tr><tr><td align="center">1.8.1</td><td align="center">2.2.1</td></tr><tr><td align="center">1.7.0</td><td align="center">2.1.1</td></tr><tr><td align="center">1.5.0</td><td align="center">2.0.0</td></tr><tr><td align="center">1.2.6</td><td align="center">1.0.0</td></tr><tr><td align="center">1.2.5</td><td align="center">0.90.x</td></tr><tr><td align="center">1.1.3</td><td align="center">0.20.x</td></tr><tr><td align="center">1.0.0</td><td align="center">0.16.2 -&gt; 0.19.0</td></tr></tbody></table><ol start="4"><li> å®‰è£… <a href="https://www.postman.com/">Postman</a>ï¼Œå¯é€šè¿‡å…¶è®¿é—® Elasticsearch æœåŠ¡å™¨ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®ä¹‹æ•°æ®åº“è¡¨</title>
      <link href="/2023/03/01/table/"/>
      <url>/2023/03/01/table/</url>
      
        <content type="html"><![CDATA[<p>ğŸŒŸ æœ¬å¸–è®°å½•æ ¡å›­ç¤¾åŒºè®ºå›é¡¹ç›®çš„æ•°æ®åº“è¡¨ï¼ŒåŒ…å«äº”å¼ è¡¨ï¼šç”¨æˆ·è¡¨ userã€è¯„è®ºè¡¨ commentã€å¸–å­è¡¨ discuss_postã€ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ login_ticketã€æ¶ˆæ¯è¡¨ messageã€‚</p><p>ğŸŒŸ å°†æ•°æ®åº“å­—æ®µ (ä¸‹åˆ’çº¿å½¢å¼) ä¸å®ä½“ç±» (é©¼å³°å‘½åæ³•) å»ºç«‹æ˜ å°„ã€‚</p><h1 id="1- ç”¨æˆ·è¡¨ -user"><a href="#1- ç”¨æˆ·è¡¨ -user" class="headerlink" title="1. ç”¨æˆ·è¡¨ user"></a>1. ç”¨æˆ·è¡¨ user</h1><ul><li> ç”¨æˆ·è¡¨ user</li></ul><table><thead><tr><th align="center"> å­—æ®µ </th><th align="center"> ç±»å‹ </th><th align="center"> å¤‡æ³¨ </th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"> ä¸»é”®ã€è‡ªå¢ </td></tr><tr><td align="center">username</td><td align="center">varchar</td><td align="center"> ç”¨æˆ·åï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">password</td><td align="center">varchar</td><td align="center"> ç”¨æˆ·å¯†ç  </td></tr><tr><td align="center">salt</td><td align="center">varchar</td><td align="center"> åŠ å¯†ç›å€¼ </td></tr><tr><td align="center">email</td><td align="center">varchar</td><td align="center"> ç”¨æˆ·é‚®ç®±ï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">type</td><td align="center">int</td><td align="center"> ç”¨æˆ·ç±»å‹ï¼š0 - æ™®é€šç”¨æˆ·ã€1 - ç®¡ç†å‘˜ã€2 - ç‰ˆä¸» </td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center"> ç”¨æˆ·çŠ¶æ€ï¼š0 - æœªæ¿€æ´»ã€1 - å·²æ¿€æ´» </td></tr><tr><td align="center">activation_code</td><td align="center">varchar</td><td align="center"> æ¿€æ´»ç  </td></tr><tr><td align="center">header_url</td><td align="center">varchar</td><td align="center"> ç”¨æˆ·å¤´åƒåœ°å€ </td></tr><tr><td align="center">create_time</td><td align="center">timestamp</td><td align="center"> æ³¨å†Œæ—¶é—´ </td></tr></tbody></table><ul><li> å®ä½“ç±» User</li></ul><pre><code class="java">public class User &#123;    private int id;    private String username;    private String password;    private String salt;    private String email;    private int type;    private int status;    private String activationCode;    private String headerUrl;    private Date createTime;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public String getUsername() &#123;        return username;    &#125;    public void setUsername(String username) &#123;        this.username = username;    &#125;    public String getPassword() &#123;        return password;    &#125;    public void setPassword(String password) &#123;        this.password = password;    &#125;    public String getSalt() &#123;        return salt;    &#125;    public void setSalt(String salt) &#123;        this.salt = salt;    &#125;    public String getEmail() &#123;        return email;    &#125;    public void setEmail(String email) &#123;        this.email = email;    &#125;    public int getType() &#123;        return type;    &#125;    public void setType(int type) &#123;        this.type = type;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public String getActivationCode() &#123;        return activationCode;    &#125;    public void setActivationCode(String activationCode) &#123;        this.activationCode = activationCode;    &#125;    public String getHeaderUrl() &#123;        return headerUrl;    &#125;    public void setHeaderUrl(String headerUrl) &#123;        this.headerUrl = headerUrl;    &#125;    public Date getCreateTime() &#123;        return createTime;    &#125;    public void setCreateTime(Date createTime) &#123;        this.createTime = createTime;    &#125;    @Override    public String toString() &#123;        return &quot;User&#123;&quot; +                &quot;id=&quot; + id +                &quot;, username=&#39;&quot; + username + &#39;\&#39;&#39; +                &quot;, password=&#39;&quot; + password + &#39;\&#39;&#39; +                &quot;, salt=&#39;&quot; + salt + &#39;\&#39;&#39; +                &quot;, email=&#39;&quot; + email + &#39;\&#39;&#39; +                &quot;, type=&quot; + type +                &quot;, status=&quot; + status +                &quot;, activationCode=&#39;&quot; + activationCode + &#39;\&#39;&#39; +                &quot;, headerUrl=&#39;&quot; + headerUrl + &#39;\&#39;&#39; +                &quot;, createTime=&quot; + createTime +                &#39;&#125;&#39;;    &#125;&#125;</code></pre><h1 id="2- è¯„è®ºè¡¨ -comment"><a href="#2- è¯„è®ºè¡¨ -comment" class="headerlink" title="2. è¯„è®ºè¡¨ comment"></a>2. è¯„è®ºè¡¨ comment</h1><ul><li> è¯„è®ºè¡¨ comment</li></ul><table><thead><tr><th align="center"> å­—æ®µ </th><th align="center"> ç±»å‹ </th><th align="center"> å¤‡æ³¨ </th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"> ä¸»é”®ã€è‡ªå¢ </td></tr><tr><td align="center">user_id</td><td align="center">int</td><td align="center"> è¯„è®ºçš„ç”¨æˆ· idï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">entity_id</td><td align="center">int</td><td align="center"> è¯„è®ºå®ä½“ idï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">entity_type</td><td align="center">int</td><td align="center"> è¯„è®ºå®ä½“ç±»å‹ï¼š1 - å¸–å­è¯„è®ºã€2 - è¯„è®ºå›å¤ </td></tr><tr><td align="center">target_id</td><td align="center">int</td><td align="center"> è¯„è®ºç›®æ ‡ id</td></tr><tr><td align="center">content</td><td align="center">text</td><td align="center"> è¯„è®ºå†…å®¹ </td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center"> è¯„è®ºçŠ¶æ€ï¼š0 - æœ‰æ•ˆã€1 - æ— æ•ˆ </td></tr><tr><td align="center">create_time</td><td align="center">timestamp</td><td align="center"> è¯„è®ºå‘è¡¨æ—¶é—´ </td></tr></tbody></table><ul><li> å®ä½“ç±» Comment</li></ul><pre><code class="java">public class Comment &#123;    private int id;    private int userId;    private int entityType;    private int entityId;    private int targetId;    private String content;    private int status;    private Date createTime;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public int getUserId() &#123;        return userId;    &#125;    public void setUserId(int userId) &#123;        this.userId = userId;    &#125;    public int getEntityType() &#123;        return entityType;    &#125;    public void setEntityType(int entityType) &#123;        this.entityType = entityType;    &#125;    public int getEntityId() &#123;        return entityId;    &#125;    public void setEntityId(int entityId) &#123;        this.entityId = entityId;    &#125;    public int getTargetId() &#123;        return targetId;    &#125;    public void setTargetId(int targetId) &#123;        this.targetId = targetId;    &#125;    public String getContent() &#123;        return content;    &#125;    public void setContent(String content) &#123;        this.content = content;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public Date getCreateTime() &#123;        return createTime;    &#125;    public void setCreateTime(Date createTime) &#123;        this.createTime = createTime;    &#125;    @Override    public String toString() &#123;        return &quot;Comment&#123;&quot; +                &quot;id=&quot; + id +                &quot;, userId=&quot; + userId +                &quot;, entityType=&quot; + entityType +                &quot;, entityId=&quot; + entityId +                &quot;, targetId=&quot; + targetId +                &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; +                &quot;, status=&quot; + status +                &quot;, createTime=&quot; + createTime +                &#39;&#125;&#39;;    &#125;&#125;</code></pre><h1 id="3- å¸–å­è¡¨ -discuss-post"><a href="#3- å¸–å­è¡¨ -discuss-post" class="headerlink" title="3. å¸–å­è¡¨ discuss_post"></a>3. å¸–å­è¡¨ discuss_post</h1><ul><li> å¸–å­è¡¨ discuss_post</li></ul><table><thead><tr><th align="center"> å­—æ®µ </th><th align="center"> ç±»å‹ </th><th align="center"> å¤‡æ³¨ </th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"> ä¸»é”®ã€è‡ªå¢ </td></tr><tr><td align="center">user_id</td><td align="center">int</td><td align="center"> å‘å¸–çš„ç”¨æˆ· idï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">title</td><td align="center">varchar</td><td align="center"> å¸–å­è¡¨æ ‡é¢˜ </td></tr><tr><td align="center">content</td><td align="center">text</td><td align="center"> å¸–å­å†…å®¹ </td></tr><tr><td align="center">type</td><td align="center">int</td><td align="center"> å¸–å­ç±»å‹ï¼š0 - æ™®é€šã€1 - ç½®é¡¶ </td></tr><tr><td align="center">comment_count</td><td align="center">int</td><td align="center"> è¯„è®ºæ•°é‡ </td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center"> å¸–å­çŠ¶æ€ï¼š0 - æ™®é€šã€1 - ç²¾åã€2 - æ‹‰é»‘ </td></tr><tr><td align="center">create_time</td><td align="center">timestamp</td><td align="center"> è¯„è®ºå‘è¡¨æ—¶é—´ </td></tr></tbody></table><ul><li> å®ä½“ç±» DiscussPost</li></ul><pre><code class="java">public class DiscussPost &#123;    private int id;    private int userId;    private String title;    private String content;    private int type;    private int status;    private Date createTime;    private int commentCount;    private double score;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public int getUserId() &#123;        return userId;    &#125;    public void setUserId(int userId) &#123;        this.userId = userId;    &#125;    public String getTitle() &#123;        return title;    &#125;    public void setTitle(String title) &#123;        this.title = title;    &#125;    public String getContent() &#123;        return content;    &#125;    public void setContent(String content) &#123;        this.content = content;    &#125;    public int getType() &#123;        return type;    &#125;    public void setType(int type) &#123;        this.type = type;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public Date getCreateTime() &#123;        return createTime;    &#125;    public void setCreateTime(Date createTime) &#123;        this.createTime = createTime;    &#125;    public int getCommentCount() &#123;        return commentCount;    &#125;    public void setCommentCount(int commentCount) &#123;        this.commentCount = commentCount;    &#125;    public double getScore() &#123;        return score;    &#125;    public void setScore(double score) &#123;        this.score = score;    &#125;    @Override    public String toString() &#123;        return &quot;DiscussPost&#123;&quot; +                &quot;id=&quot; + id +                &quot;, userId=&quot; + userId +                &quot;, title=&#39;&quot; + title + &#39;\&#39;&#39; +                &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; +                &quot;, type=&quot; + type +                &quot;, status=&quot; + status +                &quot;, createTime=&quot; + createTime +                &quot;, commentCount=&quot; + commentCount +                &quot;, score=&quot; + score +                &#39;&#125;&#39;;    &#125;&#125;</code></pre><h1 id="4- ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ -login-ticket"><a href="#4- ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ -login-ticket" class="headerlink" title="4. ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ login_ticket"></a>4. ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ login_ticket</h1><ul><li> ç”¨æˆ·ç™»å½•å‡­è¯è¡¨ login_ticket</li></ul><table><thead><tr><th align="center"> å­—æ®µ </th><th align="center"> ç±»å‹ </th><th align="center"> å¤‡æ³¨ </th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"> ä¸»é”®ã€è‡ªå¢ </td></tr><tr><td align="center">user_id</td><td align="center">int</td><td align="center"> ç™»å½•ç”¨æˆ· id</td></tr><tr><td align="center">ticket</td><td align="center">varchar</td><td align="center"> ç™»å½•å‡­è¯ï¼Œéšæœºå­—ç¬¦ä¸² </td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center"> ç™»å½•çŠ¶æ€ï¼š0 - æœ‰æ•ˆã€1 - æ— æ•ˆ </td></tr><tr><td align="center">expired</td><td align="center">timestamp</td><td align="center"> è¿‡æœŸæ—¶é—´ </td></tr></tbody></table><ul><li> å®ä½“ç±» LoginTicket</li></ul><pre><code class="java">public class LoginTicket &#123;    private int id;    private int userId;    private String ticket;    private int status;    private Date expired;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public int getUserId() &#123;        return userId;    &#125;    public void setUserId(int userId) &#123;        this.userId = userId;    &#125;    public String getTicket() &#123;        return ticket;    &#125;    public void setTicket(String ticket) &#123;        this.ticket = ticket;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public Date getExpired() &#123;        return expired;    &#125;    public void setExpired(Date expired) &#123;        this.expired = expired;    &#125;    @Override    public String toString() &#123;        return &quot;LoginTicket&#123;&quot; +                &quot;id=&quot; + id +                &quot;, userId=&quot; + userId +                &quot;, ticket=&#39;&quot; + ticket + &#39;\&#39;&#39; +                &quot;, status=&quot; + status +                &quot;, expired=&quot; + expired +                &#39;&#125;&#39;;    &#125;&#125;</code></pre><h1 id="5- æ¶ˆæ¯è¡¨ -message"><a href="#5- æ¶ˆæ¯è¡¨ -message" class="headerlink" title="5. æ¶ˆæ¯è¡¨ message"></a>5. æ¶ˆæ¯è¡¨ message</h1><ul><li> æ¶ˆæ¯è¡¨ message</li></ul><table><thead><tr><th align="center"> ç±»å‹ </th><th align="center"> å­—æ®µ </th><th align="center"> å¤‡æ³¨ </th></tr></thead><tbody><tr><td align="center">int</td><td align="center">id</td><td align="center"> ä¸»é”®ã€è‡ªå¢ </td></tr><tr><td align="center">int</td><td align="center">from_id</td><td align="center"> å‘æ¶ˆæ¯çš„ idï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">int</td><td align="center">to_id</td><td align="center"> æ”¶æ¶ˆæ¯çš„ idï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">varchar</td><td align="center">conversation_id</td><td align="center"> ä¼šè¯ idï¼Œç”±é€šä¿¡åŒæ–¹ id æ‹¼æ¥ï¼Œåˆ›å»ºç´¢å¼• </td></tr><tr><td align="center">text</td><td align="center">content</td><td align="center"> æ¶ˆæ¯å†…å®¹ </td></tr><tr><td align="center">int</td><td align="center">status</td><td align="center"> æ¶ˆæ¯çŠ¶æ€ï¼š0 - æœªè¯»ã€1 - å·²è¯»ã€2 - åˆ é™¤ </td></tr><tr><td align="center">timestamp</td><td align="center">create_time</td><td align="center"> æ¶ˆæ¯å‘é€æ—¶é—´ </td></tr></tbody></table><ul><li> å®ä½“ç±» Message</li></ul><pre><code class="java">public class Message &#123;    private int id;    private int fromId;    private int toId;    private String conversationId;    private String content;    private int status;    private Date createTime;    public int getId() &#123;        return id;    &#125;    public void setId(int id) &#123;        this.id = id;    &#125;    public int getFromId() &#123;        return fromId;    &#125;    public void setFromId(int fromId) &#123;        this.fromId = fromId;    &#125;    public int getToId() &#123;        return toId;    &#125;    public void setToId(int toId) &#123;        this.toId = toId;    &#125;    public String getConversationId() &#123;        return conversationId;    &#125;    public void setConversationId(String conversationId) &#123;        this.conversationId = conversationId;    &#125;    public String getContent() &#123;        return content;    &#125;    public void setContent(String content) &#123;        this.content = content;    &#125;    public int getStatus() &#123;        return status;    &#125;    public void setStatus(int status) &#123;        this.status = status;    &#125;    public Date getCreateTime() &#123;        return createTime;    &#125;    public void setCreateTime(Date createTime) &#123;        this.createTime = createTime;    &#125;    @Override    public String toString() &#123;        return &quot;Message&#123;&quot; +                &quot;id=&quot; + id +                &quot;, fromId=&quot; + fromId +                &quot;, toId=&quot; + toId +                &quot;, conversationId=&#39;&quot; + conversationId + &#39;\&#39;&#39; +                &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; +                &quot;, status=&quot; + status +                &quot;, createTime=&quot; + createTime +                &#39;&#125;&#39;;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ NoSQL æ•°æ®åº“ Redis</title>
      <link href="/2023/03/01/Redis/"/>
      <url>/2023/03/01/Redis/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Redis- åŸºç¡€"><a href="#1-Redis- åŸºç¡€" class="headerlink" title="1. Redis åŸºç¡€"></a>1. Redis åŸºç¡€</h1><h2 id="1-1- ç®€ä»‹"><a href="#1-1- ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h2><p>Redis æ˜¯ä¸€ä¸ªåŸºäº C è¯­è¨€å¼€å‘çš„å¼€æºæ•°æ®åº“ï¼ŒåŒºåˆ«äºä¼ ç»Ÿæ•°æ®åº“ï¼Œå…¶æ•°æ®å­˜å‚¨äºå†…å­˜ä¹‹ä¸­ (å†…å­˜æ•°æ®åº“)ã€‚</p><h2 id="1-2- ç‰¹ç‚¹"><a href="#1-2- ç‰¹ç‚¹" class="headerlink" title="1.2 ç‰¹ç‚¹"></a>1.2 ç‰¹ç‚¹</h2><ul><li><p>è¯»å†™é€Ÿåº¦å¿« (ç¼“å­˜)</p></li><li><p>å­˜å‚¨ key - value é”®å€¼å¯¹æ•°æ®</p></li></ul><h2 id="1-3- æ•°æ®ç»“æ„"><a href="#1-3- æ•°æ®ç»“æ„" class="headerlink" title="1.3 æ•°æ®ç»“æ„"></a>1.3 æ•°æ®ç»“æ„</h2><ul><li>äº”ç§åŸºç¡€æ•°æ®ç»“æ„ï¼š<ul><li>String</li><li>List</li><li>Hash</li><li>Set</li><li>Zset</li></ul></li><li>ä¸‰ç§ç‰¹æ®Šæ•°æ®ç»“æ„ï¼š<ul><li>HyperLogLog</li><li>Bitmap</li><li>Geospatial</li></ul></li></ul><h2 id="1-4- åº”ç”¨åœºæ™¯"><a href="#1-4- åº”ç”¨åœºæ™¯" class="headerlink" title="1.4 åº”ç”¨åœºæ™¯"></a>1.4 åº”ç”¨åœºæ™¯</h2><ul><li>äº‹åŠ¡</li><li>æŒä¹…åŒ–</li><li>Lua è„šæœ¬</li><li>å¼€ç®±å³ç”¨çš„é›†ç¾¤æ–¹æ¡ˆ (Redis Sentinelã€Redis Cluster) ç­‰</li></ul><h2 id="1-5-Redis- ä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#1-5-Redis- ä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="1.5 Redis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>1.5 Redis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h2><ul><li>åŸºäºå†…å­˜ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦è¿œè¶…ç£ç›˜ï¼›</li><li>åŸºäº Reactor è®¾è®¡æ¨¡å¼ï¼Œé‡‡ç”¨å•çº¿ç¨‹æ¶æ„å’Œ IO å¤šè·¯å¤ç”¨ï¼›</li><li>å†…ç½®äº†å¤šç§ä¼˜åŒ–åçš„æ•°æ®ç»“æ„å®ç°ï¼Œæ€§èƒ½é«˜ã€‚</li></ul><h1 id="2-Redis- ä¸ -Memcached- çš„å¼‚åŒç‚¹"><a href="#2-Redis- ä¸ -Memcached- çš„å¼‚åŒç‚¹" class="headerlink" title="2. Redis ä¸ Memcached çš„å¼‚åŒç‚¹"></a>2. Redis ä¸ Memcached çš„å¼‚åŒç‚¹</h1><ul><li>å…±åŒç‚¹<ul><li>å‡åŸºäºå†…å­˜ï¼Œä¸€èˆ¬ç”¨ä½œç¼“å­˜ï¼›</li><li>å‡æœ‰è¿‡æœŸç­–ç•¥ï¼›</li><li>å‡æ€§èƒ½è¾ƒé«˜ã€‚</li></ul></li><li>ä¸åŒç‚¹<ul><li>Redis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹å³å¯ç”¨çš„åœºæ™¯æ›´å¤šï¼›</li><li>Redis æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œå°†å†…å­˜çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯æ—¶å¯ä»¥å†æ¬¡åŠ è½½ä½¿ç”¨ï¼ŒMemcached åˆ™å°†æ‰€æœ‰æ•°æ®å­˜äºå†…å­˜ä¹‹ä¸­ï¼›</li><li>Redis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ï¼Œå¯ä»¥å°†ç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼›</li><li>Redis åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œåå°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ä¸Šï¼ŒMemcached åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œåä¼šæŠ¥å¼‚å¸¸ï¼›</li><li>Redis åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼ï¼ŒMemcached æ— åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œä¾èµ–äºå®¢æˆ·ç«¯å®ç°é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›</li><li>Redis é‡‡ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ï¼ŒMencached åˆ™æ˜¯å¤šçº¿ç¨‹çš„ï¼›</li><li>Redis æ”¯æŒå‘å¸ƒ - è®¢é˜…æ¨¡å¼ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼ŒMemcached åˆ™ä¸æ”¯æŒï¼›</li><li>Redis åŒæ—¶ä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ï¼ŒMemcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ã€‚</li></ul></li></ul><h1 id="3- ä¸ºä»€ä¹ˆè¦ç”¨ -Redis- ç¼“å­˜ -ï¼Ÿ"><a href="#3- ä¸ºä»€ä¹ˆè¦ç”¨ -Redis- ç¼“å­˜ -ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆè¦ç”¨ Redis ( ç¼“å­˜)ï¼Ÿ"></a>3. ä¸ºä»€ä¹ˆè¦ç”¨ Redis (ç¼“å­˜)ï¼Ÿ</h1><ul><li><p>é«˜æ€§èƒ½</p><ul><li>å°†ç”¨æˆ·ç»å¸¸è®¿é—®çš„ã€ä¸ç»å¸¸å˜æ›´çš„é«˜é¢‘æ•°æ®å­˜å…¥ç¼“å­˜ï¼Œç›¸è¾ƒäºæ¯æ¬¡ä»ç¡¬ç›˜è¯»å–æ•°æ®è¦å¿«å¾—å¤šã€‚</li></ul></li><li><p>é«˜å¹¶å‘</p><ul><li>é‡‡ç”¨ Redis ç¼“å­˜çš„ QPS é«˜äº MySQLï¼Œä½¿ç”¨ Redis é›†ç¾¤åˆ™ä¼šæ›´é«˜ã€‚å°†æ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œå¯ä»¥ä½¿å¾—ç”¨æˆ·çš„éƒ¨åˆ†è¯·æ±‚ä¸éœ€è¦ç»è¿‡æ•°æ®åº“è€Œæ˜¯ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œä»è€Œæé«˜æ•´ä½“çš„å¹¶å‘è¡Œã€‚</li></ul></li></ul><h1 id="4-Redis- çš„ç”¨é€”"><a href="#4-Redis- çš„ç”¨é€”" class="headerlink" title="4. Redis çš„ç”¨é€”"></a>4. Redis çš„ç”¨é€” </h1><p> é™¤äº†ç”¨ä½œç¼“å­˜æ„å¤–ä»¥å¤–ï¼ŒRedis è¿˜å¯ä»¥ç”¨ä½œï¼š</p><ul><li>åˆ†å¸ƒå¼é”ï¼šä¸€èˆ¬åŸºäº Redisson å®ç°ï¼›</li><li>é™æµï¼šä¸€èˆ¬é€šè¿‡ Redis + Lua è„šæœ¬çš„æ–¹å¼å®ç°ï¼›</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šè‡ªå¸¦çš„ list å¯ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒRedis 5.0 æ–°å¢çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´é€‚åˆç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸”æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–å’Œ ACK æœºåˆ¶ï¼›</li><li>å¤æ‚ä¸šåŠ¡åœºæ™¯ï¼šé€šè¿‡ bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ï¼Œé€šè¿‡ sorted set ç»´æŠ¤æ’è¡Œæ¦œã€‚</li></ul><h1 id="5-Redis-5-0- æ–°å¢çš„ -Stream"><a href="#5-Redis-5-0- æ–°å¢çš„ -Stream" class="headerlink" title="5. Redis 5.0 æ–°å¢çš„ Stream"></a>5. Redis 5.0 æ–°å¢çš„ Stream</h1><p>æ–°å¢çš„æ•°æ®ç»“æ„ Stream æ”¯æŒï¼š</p><ul><li>å‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼›</li><li>æŒ‰ç…§æ¶ˆè´¹è€…ç»„è¿›è¡Œæ¶ˆè´¹ï¼›</li><li>æ¶ˆæ¯æŒä¹…åŒ– (RDBã€AOF)ã€‚</li></ul><h1 id="6-Redis- å•çº¿ç¨‹æ¨¡å‹"><a href="#6-Redis- å•çº¿ç¨‹æ¨¡å‹" class="headerlink" title="6. Redis å•çº¿ç¨‹æ¨¡å‹"></a>6. Redis å•çº¿ç¨‹æ¨¡å‹</h1><p>Redis åŸºäº Reactor è®¾è®¡æ¨¡å¼å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œå¯¹åº” Redis ä¸­çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ (file event handler) ï¼Œè¯¥å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œå› æ­¤ä¸€èˆ¬è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œæ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥ä¸ Redis ä¸­çš„å…¶ä»–å•çº¿ç¨‹æ¨¡å—å¯¹æ¥ï¼Œä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p><ul><li>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ file event handler çš„å››ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š<ul><li>å¤šä¸ª socket (å®¢æˆ·ç«¯è¿æ¥)</li><li>IO å¤šè·¯å¤ç”¨ç¨‹åº (æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®)</li><li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ (å°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨)</li><li>äº‹ä»¶å¤„ç†å™¨ (è¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ ã€ä¸»ä»è¿æ¥å¤„ç†å™¨)</li></ul></li></ul><h1 id="7- è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥"><a href="#7- è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥" class="headerlink" title="7. è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥"></a>7. è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥</h1><ul><li>æƒ°æ€§åˆ é™¤ï¼šä»…åœ¨å–å‡º key çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æµ‹ï¼Œä½†å¯èƒ½é€ æˆè¿‡å¤šçš„è¿‡æœŸ key æœªè¢«åˆ é™¤ã€‚</li><li>å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´æŠ½å–ä¸€æ‰¹ key æ‰§è¡Œåˆ é™¤è¿‡æœŸ key æ“ä½œï¼ŒRedis åº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU æ—¶é—´çš„å½±å“ã€‚</li></ul><p>æƒ°æ€§åˆ é™¤å¯¹ CPU å‹å¥½ï¼Œå®šæœŸåˆ é™¤å¯¹å†…å­˜å‹å¥½ï¼Œå› æ­¤ Redis é‡‡ç”¨å®šæœŸåˆ é™¤ + æƒ°æ€§åˆ é™¤ &#x2F; æ‡’æ±‰å¼åˆ é™¤ï¼ŒåŒæ—¶ç»“åˆå†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p><h1 id="8-Redis- æŒä¹…åŒ–æœºåˆ¶"><a href="#8-Redis- æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="8. Redis æŒä¹…åŒ–æœºåˆ¶"></a>8. Redis æŒä¹…åŒ–æœºåˆ¶</h1><h2 id="8-1-RDB- æŒä¹…åŒ–"><a href="#8-1-RDB- æŒä¹…åŒ–" class="headerlink" title="8.1 RDB æŒä¹…åŒ–"></a>8.1 RDB æŒä¹…åŒ–</h2><p>RDB æŒä¹…åŒ–å³å¿«ç…§æŒä¹…åŒ– (snapshooting)ï¼ŒRedis é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚ç”±äº Redis å…·æœ‰ä¸»ä»ç»“æ„ï¼Œåœ¨å…¶åˆ›å»ºå¿«ç…§åï¼Œå¯ä»¥å°†å¿«ç…§å¤‡ä»½è‡³å…¶ä»–æœåŠ¡å™¨å³åˆ›å»ºå‰¯æœ¬ã€‚</p><h2 id="8-2-AOF- æŒä¹…åŒ–"><a href="#8-2-AOF- æŒä¹…åŒ–" class="headerlink" title="8.2 AOF æŒä¹…åŒ–"></a>8.2 AOF æŒä¹…åŒ–</h2><p>AOF (append only file) æŒä¹…åŒ–ï¼Œç›¸æ¯”å¿«ç…§æŒä¹…åŒ–å…·æœ‰æ›´å¥½çš„å®æ—¶æ€§ã€‚å¼€å¯ AOF æŒä¹…åŒ–æ–¹å¼åï¼Œæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼Œç„¶åæ ¹æ®é…ç½®æ¥å†³å®šä½•æ—¶å°†å…¶åŒæ­¥åˆ°ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ä¸­ã€‚Redis AOF æŒä¹…åŒ–æœºåˆ¶åœ¨æ‰§è¡Œå®Œå‘½ä»¤åå†è®°å½•æ—¥å¿—ã€‚</p><h1 id="9-Redis- äº‹åŠ¡"><a href="#9-Redis- äº‹åŠ¡" class="headerlink" title="9. Redis äº‹åŠ¡"></a>9. Redis äº‹åŠ¡ </h1><p>Redis é€šè¿‡ <code>MULTI</code>ã€<code>EXEC</code>ã€<code>DISCARD</code>ã€<code>WATCH</code> ç­‰å‘½ä»¤å®ç°äº‹åŠ¡ã€‚</p><p>å®ç° Redis äº‹åŠ¡æµç¨‹ï¼š</p><ul><li>å¼€å§‹äº‹åŠ¡ (MULTI)ï¼›</li><li>å‘½ä»¤å…¥é˜Ÿï¼šæ‰¹é‡æ“ä½œ Redis å‘½ä»¤ï¼ŒæŒ‰ç…§ FIFO çš„é¡ºåºæ‰§è¡Œï¼›</li><li>æ‰§è¡Œäº‹åŠ¡ (EXEC)ã€‚</li></ul><h1 id="10- ç¼“å­˜ç©¿é€"><a href="#10- ç¼“å­˜ç©¿é€" class="headerlink" title="10. ç¼“å­˜ç©¿é€"></a>10. ç¼“å­˜ç©¿é€ </h1><p> å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¤§é‡è¯»è¯·æ±‚æ—¶ï¼Œç”±äº Redis ç¼“å­˜ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¤§é‡è¯»è¯·æ±‚è½åˆ°æ•°æ®åº“ä¸Šï¼Œä½†æ•°æ®åº“ä¹Ÿæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¯¼è‡´â€œç¼“å­˜ç©¿é€â€ã€‚</p><p>æ³¨ï¼šæ­¤å¤„å¤§é‡è¯»è¯·æ±‚çš„ key æ˜¯ä¸åˆç†çš„ã€‚ </p><p>ğŸŒŸ è§£å†³æ–¹æ³•ï¼š</p><ul><li>ç¼“å­˜æ— æ•ˆ key</li><li>å¸ƒéš†è¿‡æ»¤å™¨</li></ul><h1 id="11- ç¼“å­˜å‡»ç©¿"><a href="#11- ç¼“å­˜å‡»ç©¿" class="headerlink" title="11. ç¼“å­˜å‡»ç©¿"></a>11. ç¼“å­˜å‡»ç©¿ </h1><p> å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¤§é‡è¯»è¯·æ±‚æ—¶ï¼Œç”±äº Redis ç¼“å­˜ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ® (å¯èƒ½å·²ç»è¿‡æœŸäº†)ï¼Œå¤§é‡è¯»è¯·æ±‚è½åˆ°æ•°æ®åº“ä¸­ (è™½ç„¶æ•°æ®åº“ä¸­å­˜åœ¨è¯¥æ•°æ®ä½†æ˜¯ Redis ç¼“å­˜ä¸­æ²¡æœ‰è¯¥æ•°æ®)ï¼Œå¯¼è‡´â€œç¼“å­˜å‡»ç©¿â€ã€‚</p><p>æ³¨ï¼šæ­¤å¤„å¤§é‡è¯»è¯·æ±‚çš„ key å¯¹åº”çƒ­ç‚¹æ•°æ®ã€‚</p><p>ğŸŒŸ è§£å†³æ–¹æ³•ï¼š</p><ul><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ &#x2F; è¿‡æœŸæ—¶é—´è¾ƒé•¿ï¼›</li><li>é’ˆå¯¹çƒ­ç‚¹æ•°æ®æå‰é¢„çƒ­ï¼Œå°†å…¶å­˜å…¥ç¼“å­˜å¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼›</li><li>è¯·æ±‚æ•°æ®åº“å†™æ•°æ®åˆ°ç¼“å­˜ä¹‹å‰ï¼Œå…ˆè·å–äº’æ–¥é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚è½åˆ°æ•°æ®åº“ä¸Šï¼Œå‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚</li></ul><h1 id="12- ç¼“å­˜é›ªå´©"><a href="#12- ç¼“å­˜é›ªå´©" class="headerlink" title="12. ç¼“å­˜é›ªå´©"></a>12. ç¼“å­˜é›ªå´© </h1><p> å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¤§é‡è¯»è¯·æ±‚æ—¶ï¼Œç”±äº Redis ç¼“å­˜ä¸­å¯¹åº”çš„å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼Œå¤§é‡è¯»è¯·æ±‚è½åˆ°æ•°æ®åº“ä¸Š (æ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”çš„æ•°æ®)ï¼Œå¯¼è‡´â€œç¼“å­˜é›ªå´©â€ã€‚</p><p>ğŸŒŸ è§£å†³æ–¹æ³•ï¼š</p><ol><li>é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨æƒ…å†µï¼š</li></ol><ul><li>é‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜å¯¼è‡´æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡æ³•ä½¿ç”¨ï¼›</li><li>é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚</li></ul><ol start="2"><li>é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆæƒ…å†µï¼š</li></ol><ul><li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆäº‹ä»¶ï¼Œä¾‹å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼›</li><li>ç¼“å­˜æ°¸ä¸å¤±æ•ˆï¼Œä¸æ¨èï¼›</li><li>è®¾ç½®äºŒçº§ç¼“å­˜ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode ç®—æ³•ç¬”è®°ä¹‹é“¾è¡¨ (åŒæŒ‡é’ˆè§£æ³•)</title>
      <link href="/2023/03/01/linkedlist/"/>
      <url>/2023/03/01/linkedlist/</url>
      
        <content type="html"><![CDATA[<p>ğŸŒŸ LeetCode ç®—æ³•ç¬”è®°ä¹‹é“¾è¡¨ï¼Œå¤ä¹ æ•´ç†åŒæŒ‡é’ˆè§£å†³é“¾è¡¨é¢˜ç›®ã€‚</p><h1 id="141- ç¯å½¢é“¾è¡¨"><a href="#141- ç¯å½¢é“¾è¡¨" class="headerlink" title="141. ç¯å½¢é“¾è¡¨"></a>141. ç¯å½¢é“¾è¡¨ </h1><p><a href="https://leetcode.cn/problems/linked-list-cycle/"> é¢˜æºï¼š141. Linked List Cycle</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªç»“ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ ï¼Œåˆ™è¿”å› <code>true</code> ã€‚ å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p></blockquote><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®åŒæŒ‡é’ˆï¼Œæ…¢æŒ‡é’ˆ slow æ¯æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå¿«æŒ‡é’ˆ fast æ¯æ¬¡å‰è¿›ä¸¤æ­¥ã€‚</li><li>å¦‚æœ fast æœ€ç»ˆé‡åˆ°ç©ºæŒ‡é’ˆï¼Œè¯´æ˜é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</li><li>å¦‚æœ fast æœ€ç»ˆå’Œ slow ç›¸é‡ï¼Œé‚£è‚¯å®šæ˜¯ fast è¶…è¿‡äº† slow ä¸€åœˆï¼Œè¯´æ˜é“¾è¡¨ä¸­å«æœ‰ç¯ã€‚</li></ul><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">/** * Definition for singly-linked list. * class ListNode &#123; *     int val; *     ListNode next; *     ListNode(int x) &#123; *         val = x; *         next = null; *     &#125; * &#125; */public class Solution &#123;    public boolean hasCycle(ListNode head) &#123;        ListNode fast = head, slow = head;        while (fast != null &amp;&amp; fast.next != null) &#123;            fast = fast.next.next;            slow = slow.next;            if (fast == slow) return true;        &#125;        return false;    &#125;&#125;</code></pre><h1 id="142- ç¯å½¢é“¾è¡¨ -II"><a href="#142- ç¯å½¢é“¾è¡¨ -II" class="headerlink" title="142. ç¯å½¢é“¾è¡¨ II"></a>142. ç¯å½¢é“¾è¡¨ II</h1><p><a href="https://leetcode.cn/problems/linked-list-cycle-ii/">é¢˜æºï¼š142. Linked List Cycle II</a></p><blockquote><p>ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹  head ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªç»“ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p><p>ä¸å…è®¸ä¿®æ”¹ é“¾è¡¨ã€‚</p></blockquote><h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><ol><li>åŸç†ï¼š</li></ol><ul><li><p>å½“å¿«ã€æ…¢æŒ‡é’ˆåˆ†åˆ«ä»¥ 2vã€v çš„é€Ÿåº¦å‰è¿›å¹¶ç¬¬ä¸€æ¬¡ç›¸é‡æ—¶ï¼š</p><ul><li><p>å¦‚æœæ…¢æŒ‡é’ˆèµ°äº† k æ­¥ï¼Œåˆ™å¿«æŒ‡é’ˆä¸€å®šèµ°äº† 2k æ­¥ã€‚</p></li><li><p>å¿«æŒ‡é’ˆæ¯”æ…¢æŒ‡é’ˆå¤šèµ°çš„ k æ­¥ï¼Œå…¶å®å°±æ˜¯å¿«æŒ‡é’ˆåœ¨ç¯å†…è½¬åœˆï¼Œå³ k å€¼ä¸ºç¯é•¿åº¦çš„ <em>æ•´æ•°å€</em>ã€‚</p></li><li><p>å‡è®¾ç›¸é‡ç‚¹ M è·ç¦»ç¯çš„èµ·ç‚¹ C çš„è·ç¦»ä¸º mï¼Œåˆ™æ…¢æŒ‡é’ˆä»å¤´ç»“ç‚¹ H åˆ°ç¯çš„èµ·ç‚¹ C çš„ç§»åŠ¨è·ç¦» HC ä¸º <code>k - m</code>ã€‚</p></li><li><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå¿«ã€æ…¢æŒ‡é’ˆåœ¨ç›¸é‡ç‚¹ M æ—¶ï¼Œé‡ç½®æ…¢æŒ‡é’ˆï¼Œè®©æ…¢æŒ‡é’ˆå†æ¬¡ä»å¤´ç»“ç‚¹ H å‡ºå‘ï¼Œå‰è¿› <code>k - m</code> æ­¥å³å¯åˆ°è¾¾ç¯çš„èµ·ç‚¹ Cã€‚</p></li><li><p>æ­¤æ—¶ï¼Œå¦‚æœå¿«æŒ‡é’ˆä»ç›¸é‡ç‚¹ç»§ç»­å‰è¿›ï¼Œä¸”é€Ÿåº¦å’Œæ…¢æŒ‡é’ˆä¿æŒä¸€è‡´éƒ½ä¸º vï¼Œæ°å·§ä¹Ÿéœ€å‰è¿› <code>k - m</code> æ­¥å³å¯åˆ°è¾¾ç¯çš„èµ·ç‚¹ Cã€‚</p></li></ul></li></ul><ol start="2"><li>è§£æ³•ï¼š</li></ol><ul><li>è®¾ç½®åŒæŒ‡é’ˆï¼Œæ…¢æŒ‡é’ˆ slow æ¯æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå¿«æŒ‡é’ˆ fast æ¯æ¬¡å‰è¿›ä¸¤æ­¥ã€‚</li><li>å½“å¿«ã€æ…¢æŒ‡é’ˆç›¸é‡æ—¶ï¼š<ul><li>è®©å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¤´ç»“ç‚¹ï¼›</li><li>æ­¤æ—¶ï¼Œè®¾ç½®å¿«ã€æ…¢æŒ‡é’ˆå‰è¿›é€Ÿåº¦ä¸€è‡´ï¼Œå‡æ¯æ¬¡å‰è¿›ä¸€æ­¥ã€‚</li></ul></li></ul><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><ul><li>ç¬¬ä¸€ä¸ª while å¾ªç¯æ˜¯ä¸ºäº†å¯»æ‰¾ç›¸é‡ç‚¹ Mã€‚</li><li>ç¬¬äºŒä¸ª while å¾ªç¯æ˜¯ä¸ºäº†é‡ç½®æ…¢æŒ‡é’ˆåˆ°å¤´ç»“ç‚¹ï¼Œå¹¶å¯»æ‰¾ä¸¤ä¸ªæŒ‡é’ˆæœ€ç»ˆçš„ä½ç½®å³ç¯èµ·ç‚¹ã€‚</li></ul><pre><code class="java">/** * Definition for singly-linked list. * class ListNode &#123; *     int val; *     ListNode next; *     ListNode(int x) &#123; *         val = x; *         next = null; *     &#125; * &#125; */public class Solution &#123;    public ListNode detectCycle(ListNode head) &#123;        ListNode fast = head, slow = head;        while (fast != null &amp;&amp; fast.next != null) &#123;            fast = fast.next.next;            slow = slow.next;            if (slow == fast) break;        &#125;        if (fast == null || fast.next == null) return null;        slow = head;        while (slow != fast) &#123;            fast = fast.next;            slow = slow.next;        &#125;        return slow;    &#125;&#125;</code></pre><h1 id="160- ç›¸äº¤é“¾è¡¨"><a href="#160- ç›¸äº¤é“¾è¡¨" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨"></a>160. ç›¸äº¤é“¾è¡¨ </h1><p><a href="https://leetcode.cn/problems/intersection-of-two-linked-lists/"> é¢˜æºï¼š160. ç›¸äº¤é“¾è¡¨</a></p><blockquote><p>ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´ç»“ç‚¹ <code>headA</code> å’Œ <code>headB</code> ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹ç»“ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤ç»“ç‚¹ï¼Œè¿”å› <code>null</code> ã€‚</p><p>é¢˜ç›®æ•°æ® <strong>ä¿è¯</strong> æ•´ä¸ªé“¾å¼ç»“æ„ä¸­ä¸å­˜åœ¨ç¯ã€‚</p><p><strong>æ³¨æ„ </strong>ï¼Œå‡½æ•°è¿”å›ç»“æœåï¼Œé“¾è¡¨å¿…é¡» <strong> ä¿æŒå…¶åŸå§‹ç»“æ„</strong> ã€‚</p></blockquote><h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ p1 å’Œ p2ï¼Œåˆ†åˆ«æŒ‡å‘ é“¾è¡¨ A å’Œé“¾è¡¨ B çš„å¤´ç»“ç‚¹ã€‚</li><li>è®©æŒ‡é’ˆ p1 å’Œ p2 åˆ†åˆ«åœ¨åœ¨ä¸¤æ¡é“¾è¡¨ä¸Šéå†ï¼š<ul><li>å½“æŒ‡é’ˆ p1 éå†å®Œé“¾è¡¨ A åï¼Œå¼€å§‹éå†é“¾è¡¨ Bï¼›</li><li>å½“æŒ‡é’ˆ p2 éå†å®Œé“¾è¡¨ B åï¼Œå¼€å§‹éå†é“¾è¡¨ Aï¼›</li><li>åœ¨é€»è¾‘ä¸Šï¼Œä¸¤æ¡é“¾è¡¨â€œè¿æ¥æˆäº†ä¸€æ¡é“¾è¡¨â€ã€‚</li></ul></li></ul><h2 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode(int x) &#123; *         val = x; *         next = null; *     &#125; * &#125; */public class Solution &#123;    public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123;        ListNode p1 = headA, p2 = headB;        while (p1 != p2) &#123;            if (p1 != null) &#123;                p1 = p1.next;            &#125; else &#123;                p1 = headB;            &#125;            if (p2 != null) &#123;                p2 = p2.next;            &#125; else &#123;                p2 =headA;            &#125;        &#125;        return p1;    &#125;&#125;</code></pre><h1 id="19- åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ -N- ä¸ªç»“ç‚¹"><a href="#19- åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ -N- ä¸ªç»“ç‚¹" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a>19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹ </h1><p><a href="https://leetcode.cn/problems/remove-nth-node-from-end-of-list/"> é¢˜æºï¼š19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ <code>n</code> ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚</p></blockquote><h2 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è¦åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œåˆ™éœ€è¦è·å¾—å€’æ•°ç¬¬ n + 1 ä¸ªç»“ç‚¹çš„å¼•ç”¨ã€‚</li><li>è®¾ç½®æŒ‡é’ˆ p1 å’Œ p2ï¼Œé¦–å…ˆè®©æŒ‡é’ˆ p1 æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼Œå¹¶å‘å‰ç§»åŠ¨ k æ­¥ï¼›</li><li>æ­¤æ—¶ï¼Œè®©æŒ‡é’ˆ p2 æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼Œå¹¶è®©ä¸¤ä¸ªæŒ‡é’ˆ p1 å’Œ p2 åŒæ—¶å‘å‰ç§»åŠ¨ï¼›</li><li>å½“æŒ‡é’ˆ p1 ç§»åŠ¨è‡³é“¾è¡¨æœ«å°¾çš„ç©ºæŒ‡é’ˆæ—¶ï¼Œå…¶ç§»åŠ¨çš„ç¬¬äºŒæ®µé•¿åº¦ä¸º <code>n - k</code> æ­¥ï¼Œè€Œæ­¤æ—¶æŒ‡é’ˆ p2 ä¹Ÿç§»åŠ¨äº† <code>n - k</code>æ­¥ï¼Œä½äºé“¾è¡¨çš„å€’æ•°ç¬¬ k ä¸ªç»“ç‚¹ã€‚</li></ul><h2 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h2><ul><li>æ–¹æ³• <code>findFromEnd()</code> ï¼šè¿”å›é“¾è¡¨çš„å€’æ•°ç¬¬ k ä¸ªç»“ç‚¹ã€‚</li><li>ç»“ç‚¹ x ç”¨äºå­˜å‚¨é“¾è¡¨çš„å€’æ•°ç¬¬ n + 1 ä¸ªç»“ç‚¹</li></ul><p>ğŸŒŸ åœ¨é“¾è¡¨çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿç»“ç‚¹ dummyï¼šå¯ä»¥é¿å…åˆ é™¤å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode removeNthFromEnd(ListNode head, int n) &#123;        ListNode dummy = new ListNode(-1);        dummy.next = head;        // åˆ é™¤å€’æ•°ç¬¬ n ä¸ªï¼Œè¦å…ˆæ‰¾å€’æ•°ç¬¬ n + 1 ä¸ªç»“ç‚¹        ListNode x = findFromEnd(dummy, n + 1);        x.next = x.next.next;        return dummy.next;    &#125;    // è¿”å›é“¾è¡¨çš„å€’æ•°ç¬¬ k ä¸ªç»“ç‚¹    private ListNode findFromEnd(ListNode head, int k) &#123;        ListNode p1 = head;        for (int i = 0; i &lt; k; i++) &#123;            p1 = p1.next;        &#125;        ListNode p2 = head;        while (p1 != null) &#123;            p1 = p1.next;            p2 = p2.next;        &#125;        return p2;    &#125;&#125;</code></pre><h1 id="21- åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#21- åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ </h1><p><a href="https://leetcode.cn/problems/merge-two-sorted-lists/"> é¢˜æºï¼š21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></p><blockquote><p>å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ <strong>å‡åº</strong> é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰ç»“ç‚¹ç»„æˆçš„ã€‚ </p></blockquote><h2 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ p1 å’Œ p2ï¼Œåˆ†åˆ«æŒ‡å‘é“¾è¡¨çš„ä¸¤ä¸ªå¤´ç»“ç‚¹ã€‚</li><li>è®©æŒ‡é’ˆ p1 å’Œ p2 åˆ†åˆ«åœ¨ä¸¤ä¸ªé“¾è¡¨ä¸Šéå†ï¼Œæ¯æ¬¡éƒ½æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç»“ç‚¹çš„å€¼ï¼š<ul><li>è‹¥æŒ‡é’ˆ p1 æŒ‡å‘çš„ç»“ç‚¹å€¼å°äºæŒ‡é’ˆ p2 æŒ‡å‘çš„ç»“ç‚¹å€¼ï¼Œåˆ™å°†æŒ‡é’ˆ p1 æŒ‡å‘çš„ç»“ç‚¹åŠ å…¥åˆ°æ–°åˆå¹¶çš„é“¾è¡¨ä¸­ï¼Œå¹¶å°†æŒ‡é’ˆ p1 å¾€å‰ç§»åŠ¨ä¸€æ­¥ï¼›</li><li>è‹¥æŒ‡é’ˆ p1 æŒ‡å‘çš„ç»“ç‚¹å€¼å¤§äºæŒ‡é’ˆ p2 æŒ‡å‘çš„ç»“ç‚¹å€¼ï¼Œåˆ™å°†æŒ‡é’ˆ p2 æŒ‡å‘çš„ç»“ç‚¹åŠ å…¥åˆ°æ–°åˆå¹¶çš„é“¾è¡¨ä¸­ï¼Œå¹¶å°†æŒ‡é’ˆ p2 å¾€å‰ç§»åŠ¨ä¸€æ­¥ï¼›</li></ul></li></ul><h2 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h2><p>ğŸŒŸ åœ¨é“¾è¡¨çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿç»“ç‚¹ dummyï¼šå¯ä»¥é¿å…å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€ç®€åŒ–ä»£ç ã€‚</p><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode mergeTwoLists(ListNode list1, ListNode list2) &#123;        ListNode dummy = new ListNode(-1);        ListNode p = dummy;        ListNode p1 = list1, p2 = list2;        while (p1 != null &amp;&amp; p2 != null) &#123;            if (p1.val &gt; p2.val) &#123;                p.next = p2;                p2= p2.next;            &#125; else &#123;                p.next = p1;                p1= p1.next;            &#125;            p = p.next;        &#125;        if (p1 != null) p.next = p1;        if (p2 != null) p.next = p2;        return dummy.next;    &#125;&#125;</code></pre><h1 id="23- åˆå¹¶ -K- ä¸ªå‡åºé“¾è¡¨"><a href="#23- åˆå¹¶ -K- ä¸ªå‡åºé“¾è¡¨" class="headerlink" title="23. åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨"></a>23. åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨ </h1><p><a href="https://leetcode.cn/problems/merge-k-sorted-lists/"> é¢˜æºï¼š23. åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚</p><p>è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p></blockquote><h2 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h2><ul><li>é‡‡ç”¨ä¼˜å…ˆé˜Ÿåˆ— <code>PriorityQueue</code> å®ç°å°é¡¶å †ã€‚</li><li>å°† k ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹åŠ å…¥åˆ°æœ€å°å †ä¸­ï¼š<ul><li>å½“ä¼˜å…ˆé˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼Œæ¯æ¬¡è·å–æœ€å°ç»“ç‚¹ï¼ŒåŠ å…¥åˆ°ç»“æœé“¾è¡¨ä¸­ã€‚</li></ul></li></ul><h2 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h2><ul><li><code>PriorityQueue&lt;ListNode&gt; pq = new PriorityQueue&lt;&gt;(lists.length, (a, b)-&gt;(a.val - b.val));</code>é‡‡ç”¨ lambda è¡¨è¾¾å¼å®ç°å°é¡¶å †ã€‚</li><li>è®¾ç½®è™šæ‹Ÿå¤´ç»“ç‚¹ dummyã€‚</li></ul><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode mergeKLists(ListNode[] lists) &#123;        if (lists.length == 0) return null;        ListNode dummy = new ListNode(-1);        ListNode p = dummy;        PriorityQueue&lt;ListNode&gt; pq = new PriorityQueue&lt;&gt;(lists.length, (a, b)-&gt;(a.val - b.val)        );        for (ListNode head : lists) &#123;            if (head != null) &#123;                pq.add(head);            &#125;        &#125;        while (!pq.isEmpty()) &#123;            ListNode node = pq.poll();            p.next = node;            if (node.next != null) &#123;                pq.add(node.next);            &#125;            p = p.next;        &#125;        return dummy.next;    &#125;&#125;</code></pre><h1 id="86- åˆ†éš”é“¾è¡¨"><a href="#86- åˆ†éš”é“¾è¡¨" class="headerlink" title="86. åˆ†éš”é“¾è¡¨"></a>86. åˆ†éš”é“¾è¡¨ </h1><p><a href="https://leetcode.cn/problems/partition-list/"> é¢˜æºï¼š86. åˆ†éš”é“¾è¡¨</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ head å’Œä¸€ä¸ªç‰¹å®šå€¼ x ï¼Œè¯·ä½ å¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰ å°äº x çš„ç»“ç‚¹éƒ½å‡ºç°åœ¨ å¤§äºæˆ–ç­‰äº x çš„ç»“ç‚¹ä¹‹å‰ã€‚</p><p>ä½ åº”å½“ ä¿ç•™ ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªç»“ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚</p></blockquote><h2 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®ä¸¤ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹ dummy1 å’Œ dummy2ï¼Œè®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ p1 å’Œ p2ï¼Œè®©ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ª dummy ç»“ç‚¹ã€‚</li><li>éå†ç»™å®šçš„é“¾è¡¨ï¼Œåˆ¤æ–­æ¯ä¸ªéå†çš„ç»“ç‚¹ï¼š<ul><li>å¦‚æœå½“å‰ç»“ç‚¹çš„å€¼å°äºç»™å®šçš„æ•°å€¼ xï¼Œå°†è¯¥ç»“ç‚¹æ¥åˆ° dummy1 ç»“ç‚¹æ‰€åœ¨é“¾è¡¨ï¼Œå¹¶å°†æŒ‡é’ˆ p1 å‘å‰ç§»åŠ¨ä¸€æ­¥ï¼›</li><li>å¦‚æœå½“å‰ç»“ç‚¹çš„å€¼å¤§äºç»™å®šçš„æ•°å€¼ xï¼Œå°†è¯¥ç»“ç‚¹æ¥åˆ° dummy2 ç»“ç‚¹æ‰€åœ¨é“¾è¡¨ï¼Œå¹¶å°†æŒ‡é’ˆ p2 å‘å‰ç§»åŠ¨ä¸€æ­¥ã€‚</li><li>è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯è¿›è¡Œåˆ¤æ–­ã€‚</li></ul></li><li>å°† dummy2 æ‰€åœ¨é“¾è¡¨æ‹¼æ¥åˆ° dummy1 æ‰€åœ¨é“¾è¡¨ä¹‹å‰ï¼Œå¹¶å°†å°¾ç»“ç‚¹çš„åç»§ç»“ç‚¹è®¾ä¸º nullã€‚</li></ul><p>ğŸŒŸ <code>p2.next = null;</code>æ˜¯å…³é”®ï¼Œæ²¡å†™å¯èƒ½å¯¼è‡´è¶…å‡ºå†…å­˜é™åˆ¶ã€‚ </p><h2 id="Code-6"><a href="#Code-6" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode partition(ListNode head, int x) &#123;                ListNode dummy1 = new ListNode(-1);          ListNode dummy2 = new ListNode(-1);          ListNode p1 = dummy1, p2 = dummy2;          ListNode p = head;          while (p != null) &#123;              if (p.val &lt; x) &#123;                    p1.next = p;                  p1 = p1.next;              &#125; else &#123;                  p2.next = p;                  p2 = p2.next;            &#125;              p = p.next;        &#125;          p1.next = dummy2.next;          p2.next = null;          return dummy1.next;    &#125;&#125;</code></pre><h1 id="876- é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹"><a href="#876- é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹" class="headerlink" title="876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹"></a>876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ </h1><p><a href="https://leetcode.cn/problems/middle-of-the-linked-list/"> é¢˜æºï¼š876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></p><blockquote><p>ç»™ä½ å•é“¾è¡¨çš„å¤´ç»“ç‚¹ <code>head</code> ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ã€‚</p><p>å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªä¸­é—´ç»“ç‚¹ã€‚</p></blockquote><h2 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®å¿«ã€æ…¢æŒ‡é’ˆå‘å‰ç§»åŠ¨çš„é€Ÿåº¦åˆ†åˆ«ä¸º 2vã€vã€‚</li><li>å¿«æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œå½“å¿«æŒ‡é’ˆç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆæ°å¥½ä½äºé“¾è¡¨ä¸­ç‚¹ã€‚</li></ul><h2 id="Code-7"><a href="#Code-7" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode middleNode(ListNode head) &#123;        ListNode fast = head, slow = head;        while (fast != null &amp;&amp; fast.next != null) &#123;            fast = fast.next.next;            slow = slow.next;        &#125;        return slow;    &#125;&#125;</code></pre><h1 id="83- åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "><a href="#83- åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ " class="headerlink" title="83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "></a>83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  </h1><p><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-list/"> é¢˜æºï¼š83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ </a></p><blockquote><p>ç»™å®šä¸€ä¸ªå·²æ’åºçš„é“¾è¡¨çš„å¤´ <code>head</code> ï¼Œ <em>åˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ </em> ã€‚è¿”å› <em> å·²æ’åºçš„é“¾è¡¨</em> ã€‚</p></blockquote><h2 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution"></a>Solution</h2><ul><li>æ€è·¯åŒ <a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array">26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a> ã€‚</li><li>å”¯ä¸€çš„åŒºåˆ«æ˜¯æŠŠæ•°ç»„èµ‹å€¼æ“ä½œå˜æˆæ“ä½œæŒ‡é’ˆè€Œå·²ã€‚</li></ul><h2 id="Code-8"><a href="#Code-8" class="headerlink" title="Code"></a>Code</h2><ul><li><code>slow.next = fast;</code> ç›¸å½“äº  <code>nums[slow] = nums[fast];</code>                </li><li><code>slow = slow.next;</code> ç›¸å½“äº <code>slow++;</code></li><li><code>fast = fast.next;</code> ç›¸å½“äº <code>fast++;</code></li></ul><pre><code class="java">/** * Definition for singly-linked list. * public class ListNode &#123; *     int val; *     ListNode next; *     ListNode() &#123;&#125; *     ListNode(int val) &#123; this.val = val; &#125; *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125; * &#125; */class Solution &#123;    public ListNode deleteDuplicates(ListNode head) &#123;        if (head == null) return null;        ListNode slow = head, fast = head;        while (fast != null) &#123;            if (fast.val != slow.val) &#123;                slow.next = fast;                slow = slow.next;            &#125;            fast = fast.next;        &#125;        slow.next = null;        return head;    &#125;&#125;</code></pre><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li><a href="https://labuladong.github.io/algo/di-yi-zhan-da78c/shou-ba-sh-8f30d/shuang-zhi-0f7cc/">labuladong çš„ç®—æ³•å°æŠ„ - åŒæŒ‡é’ˆæŠ€å·§ç§’æ€ä¸ƒé“é“¾è¡¨é¢˜ç›®</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Algorithm </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Welcome to My HomePage!</title>
      <link href="/2023/02/28/hello-world/"/>
      <url>/2023/02/28/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring æ¡†æ¶ä¹‹è®¾è®¡æ¨¡å¼</title>
      <link href="/2023/02/20/spring_dm/"/>
      <url>/2023/02/20/spring_dm/</url>
      
        <content type="html"><![CDATA[<h1 id="1- å·¥å‚æ¨¡å¼"><a href="#1- å·¥å‚æ¨¡å¼" class="headerlink" title="1. å·¥å‚æ¨¡å¼"></a>1. å·¥å‚æ¨¡å¼</h1><h2 id="1-1- ç®€å•å·¥å‚æ¨¡å¼"><a href="#1-1- ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="1.1 ç®€å•å·¥å‚æ¨¡å¼"></a>1.1 ç®€å•å·¥å‚æ¨¡å¼</h2><p>Spring ä¸­çš„ BeanFactory ï¼Œæ ¹æ®ä¼ å…¥ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†æ¥è·å– Bean å¯¹è±¡ã€‚</p><h2 id="1-2- å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#1-2- å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="1.2 å·¥å‚æ–¹æ³•æ¨¡å¼"></a>1.2 å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>FactoryBean æ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£çš„ bean æ˜¯ä¸€ç±»å«åš factory çš„ beanã€‚</p><p>Spring åœ¨è°ƒç”¨æ–¹æ³• getBean() æ¥è·å– bean æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ bean çš„æ–¹æ³• getObject()æ¥è·å–è¯¥å·¥å‚ bean äº§ç”Ÿçš„å®ä¾‹ï¼Œè€Œéå·¥å‚ bean æœ¬èº«å®ä¾‹</p><p>å…¸å‹ç¤ºä¾‹ï¼šSpring æ•´åˆ MyBatis</p><h1 id="2- ä»£ç†æ¨¡å¼"><a href="#2- ä»£ç†æ¨¡å¼" class="headerlink" title="2. ä»£ç†æ¨¡å¼"></a>2. ä»£ç†æ¨¡å¼</h1><p>Spring AOP çš„åŠŸèƒ½å³ä¸ºé‡‡ç”¨åŠ¨æ€ä»£ç†å®ç°çš„ï¼Œæ”¯æŒ JdkDynamicAopProxy å’Œ Cglib2AopProxyã€‚</p><h1 id="3- å•ä¾‹æ¨¡å¼"><a href="#3- å•ä¾‹æ¨¡å¼" class="headerlink" title="3. å•ä¾‹æ¨¡å¼"></a>3. å•ä¾‹æ¨¡å¼ </h1><p> ä¸€ä¸ªç±»åœ¨æ•´ä¸ªç³»ç»Ÿè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œåªå…è®¸äº§ç”Ÿä¸€ä¸ªå®ä¾‹ã€‚</p><p>Spring ä¾èµ–æ³¨å…¥çš„ Bean é»˜è®¤æ˜¯å•ä¾‹çš„ã€‚</p><h1 id="4- æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"><a href="#4- æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼" class="headerlink" title="4. æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"></a>4. æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼</h1><p>Spring ä¸­çš„ JdbcTemplate ç­‰ä»¥ Template ç»“å°¾çš„ç±»å‡é‡‡ç”¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ã€‚</p><h1 id="5- è§‚å¯Ÿè€…æ¨¡å¼"><a href="#5- è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="5. è§‚å¯Ÿè€…æ¨¡å¼"></a>5. è§‚å¯Ÿè€…æ¨¡å¼</h1><p>Spring äº‹ä»¶é©±åŠ¨æ¨¡å¼å³ä¸ºè§‚å¯Ÿè€…æ¨¡å¼çš„ç»å…¸åº”ç”¨ã€‚</p><h1 id="6- è£…é¥°å™¨æ¨¡å¼"><a href="#6- è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="6. è£…é¥°å™¨æ¨¡å¼"></a>6. è£…é¥°å™¨æ¨¡å¼ </h1><p> ç¼“å­˜ä¸æ•°æ®åº“æ­é…ä½¿ç”¨æ—¶ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µï¼šç¼“å­˜å†™æ“ä½œæˆåŠŸï¼Œä½†æ•°æ®åº“äº‹åŠ¡å›æ»šäº†ï¼Œé€ æˆäº†è„æ•°æ®çš„é—®é¢˜ã€‚Spring çš„ TransactionAwareCacheDecorator ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œå¢åŠ äº†å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œåœ¨äº‹åŠ¡æäº¤ã€å›æ»šçš„æ—¶å€™åˆ†åˆ«å¯¹ Cache çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè§£å†³äº†è„æ•°æ®é—®é¢˜ã€‚</p><h1 id="7- ç­–ç•¥æ¨¡å¼"><a href="#7- ç­–ç•¥æ¨¡å¼" class="headerlink" title="7. ç­–ç•¥æ¨¡å¼"></a>7. ç­–ç•¥æ¨¡å¼</h1><p>Spring é€šè¿‡ç­–ç•¥æ¨¡å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°é€‰æ‹©ä¸åŒçš„åŠ¨æ€ä»£ç†å®ç°æ–¹å¼ã€‚</p><h1 id="8- é€‚é…å™¨æ¨¡å¼"><a href="#8- é€‚é…å™¨æ¨¡å¼" class="headerlink" title="8. é€‚é…å™¨æ¨¡å¼"></a>8. é€‚é…å™¨æ¨¡å¼</h1><p>Spring MVC é‡‡ç”¨é€‚é…å™¨æ¨¡å¼é€‚é… Controllerã€‚ Spring MVC ä¸­çš„ Controller ç§ç±»ä¼—å¤šï¼Œä¸åŒç±»å‹çš„ Controller é€šè¿‡ä¸åŒçš„æ–¹æ³•å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸ç”¨é€‚é…å™¨æ¨¡å¼ï¼ŒDispatcherServlet åˆ™éœ€è¦å†™ä¸€å † if-else é€»è¾‘æ¥è°ƒç”¨å¯¹åº” Controller çš„è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚</p><p>é‡‡ç”¨é€‚é…å™¨æ¨¡å¼åï¼Œå¯ä»¥å°†ä¸åŒæ–¹å¼å®šä¹‰çš„ Controller ç±»ä¸­çš„æ–¹æ³•é€‚é…ä¸ºç»Ÿä¸€çš„å‡½æ•°å®šä¹‰ã€‚è¿™æ ·å³å¯åœ¨ DispatcherServlet ç±»ä¸­ä»£ç ä¸­ï¼Œç§»é™¤ if-else åˆ†æ”¯åˆ¤æ–­é€»è¾‘ï¼Œè€Œè°ƒç”¨ç»Ÿä¸€çš„å‡½æ•°ã€‚</p><h1 id="9- è´£ä»»é“¾æ¨¡å¼"><a href="#9- è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="9. è´£ä»»é“¾æ¨¡å¼"></a>9. è´£ä»»é“¾æ¨¡å¼ </h1><p> å°†èƒ½å¤Ÿå¤„ç†åŒä¸€ç±»è¯·æ±‚çš„å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œä½¿è¿™äº›å¯¹è±¡å‡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œæ‰€æäº¤çš„è¯·æ±‚æ²¿ç€é“¾ä¼ é€’ï¼Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´äº§ç”Ÿè€¦åˆå…³ç³»ã€‚</p><p>å…¸å‹ç¤ºä¾‹ï¼šSpring æ‹¦æˆªå™¨</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode ç®—æ³•ç¬”è®°ä¹‹äºŒå‰æ ‘</title>
      <link href="/2023/01/15/tree/"/>
      <url>/2023/01/15/tree/</url>
      
        <content type="html"><![CDATA[<h1 id="104- äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#104- äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ </h1><p><a href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/"> é¢˜æºï¼š104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a></p><blockquote><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚</p><p>äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p></blockquote><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Solution-1- åŠ¨æ€è§„åˆ’"><a href="#Solution-1- åŠ¨æ€è§„åˆ’" class="headerlink" title="Solution 1: åŠ¨æ€è§„åˆ’"></a>Solution 1: åŠ¨æ€è§„åˆ’</h3><ul><li>è¾“å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ã€‚</li><li>æ ¹æ®å·¦ã€å³å­æ ‘çš„æœ€å¤§æ·±åº¦å¾—åˆ°åŸäºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ã€‚</li></ul><h3 id="Solution-2- å›æº¯"><a href="#Solution-2- å›æº¯" class="headerlink" title="Solution 2: å›æº¯"></a>Solution 2: å›æº¯</h3><ul><li>éå†äºŒå‰æ ‘ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­è®°å½•æœ€å¤§æ·±åº¦ã€‚</li></ul><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="Code-1- åŠ¨æ€è§„åˆ’"><a href="#Code-1- åŠ¨æ€è§„åˆ’" class="headerlink" title="Code 1: åŠ¨æ€è§„åˆ’"></a>Code 1: åŠ¨æ€è§„åˆ’</h3><pre><code class="java">/** * Definition for a binary tree node. * public class TreeNode &#123; *     int val; *     TreeNode left; *     TreeNode right; *     TreeNode() &#123;&#125; *     TreeNode(int val) &#123; this.val = val; &#125; *     TreeNode(int val, TreeNode left, TreeNode right) &#123; *         this.val = val; *         this.left = left; *         this.right = right; *     &#125; * &#125; */class Solution &#123;    public int maxDepth(TreeNode root) &#123;        if (root == null) return 0;        int leftMax = maxDepth(root.left);        int rightMax = maxDepth(root.right);        return 1 + Math.max(leftMax, rightMax);    &#125;&#125;</code></pre><h3 id="Code-2- å›æº¯"><a href="#Code-2- å›æº¯" class="headerlink" title="Code 2: å›æº¯"></a>Code 2: å›æº¯</h3><ul><li>æ–°å¢ç±»çš„æˆå‘˜å˜é‡ï¼š<ul><li>res ç”¨äºè®°å½•æœ€å¤§æ·±åº¦ï¼›</li><li>depth ç”¨äºè®°å½•éå†åˆ°çš„èŠ‚ç‚¹çš„æ·±åº¦ã€‚</li></ul></li><li><h2 id="æ–°å¢æ–¹æ³• -traverse-ï¼šéå†äºŒå‰æ ‘ã€‚"><a href="# æ–°å¢æ–¹æ³• -traverse-ï¼šéå†äºŒå‰æ ‘ã€‚" class="headerlink" title="æ–°å¢æ–¹æ³• traverse() ï¼šéå†äºŒå‰æ ‘ã€‚"></a>æ–°å¢æ–¹æ³• <code>traverse()</code> ï¼šéå†äºŒå‰æ ‘ã€‚</h2></li></ul><pre><code class="java">class Solution &#123;    int depth = 0;    int res = 0;    public int maxDepth(TreeNode root) &#123;        traverse(root);        return res;    &#125;    void traverse(TreeNode root) &#123;        if (root == null) return;        depth++;        res = Math.max(res, depth);        traverse(root.left);        traverse(root.right);        depth--;    &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Algorithm </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode ç®—æ³•ç¬”è®°ä¹‹æ•°ç»„ (åŒæŒ‡é’ˆè§£æ³•)</title>
      <link href="/2023/01/01/array/"/>
      <url>/2023/01/01/array/</url>
      
        <content type="html"><![CDATA[<h1 id="167- ä¸¤æ•°ä¹‹å’Œ -II- è¾“å…¥æœ‰åºæ•°ç»„"><a href="#167- ä¸¤æ•°ä¹‹å’Œ -II- è¾“å…¥æœ‰åºæ•°ç»„" class="headerlink" title="167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„"></a>167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„ </h1><p><a href="https://leetcode.cn/problems/two-sum-ii-input-array-is-sorted/"> é¢˜æºï¼š167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 1 å¼€å§‹çš„æ•´æ•°æ•°ç»„ numbers ï¼Œè¯¥æ•°ç»„å·²æŒ‰ éé€’å‡é¡ºåºæ’åˆ—  ï¼Œè¯·ä½ ä»æ•°ç»„ä¸­æ‰¾å‡ºæ»¡è¶³ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•° target çš„ä¸¤ä¸ªæ•°ã€‚å¦‚æœè®¾è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯ numbers[index1] å’Œ numbers[index2] ï¼Œåˆ™ 1 &lt;&#x3D; index1 &lt; index2 &lt;&#x3D; numbers.length ã€‚</p><p>ä»¥é•¿åº¦ä¸º 2 çš„æ•´æ•°æ•°ç»„ [index1, index2] çš„å½¢å¼è¿”å›è¿™ä¸¤ä¸ªæ•´æ•°çš„ä¸‹æ ‡ index1 å’Œ index2ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥ åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆ ï¼Œè€Œä¸”ä½  ä¸å¯ä»¥ é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ æ‰€è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡»åªä½¿ç”¨å¸¸é‡çº§çš„é¢å¤–ç©ºé—´ã€‚</p></blockquote><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ul><li><p>è®¾ç½®åŒæŒ‡é’ˆï¼Œå·¦æŒ‡é’ˆæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³æŒ‡é’ˆæŒ‡å‘æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p></li><li><p>å°†ä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªå’Œ sumï¼Œæ¯”è¾ƒ sum ä¸ ç»™å®šçš„ç›®æ ‡å’Œ target çš„å¤§å°ï¼š</p><ul><li>è‹¥ sum ç­‰äº targetï¼Œåˆ™è¿”å›å¾—åˆ°ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ä¸‹æ ‡ï¼›</li><li>è‹¥ sum å°äº targetï¼Œåˆ™å·¦æŒ‡é’ˆå³ç§»ä¸€ä½ï¼›</li><li>è‹¥ sum å¤§äº targetï¼Œåˆ™å³æŒ‡é’ˆå·¦ç§»ä¸€ä½ã€‚</li></ul></li><li><p>è‹¥æ‰¾ä¸åˆ°ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å›æ•°ç»„ [-1, -1]ã€‚</p></li></ul><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">class Solution &#123;    public int[] twoSum(int[] numbers, int target) &#123;        int l = 0;        int r = numbers.length - 1;        while (l &lt; r) &#123;            int sum = numbers[l] + numbers[r];            if (sum == target) &#123;                return new int[]&#123;l + 1, r + 1&#125;;            &#125; else if (sum &lt; target) &#123;                l++;            &#125; else &#123;                r--;            &#125;        &#125;        return new int[]&#123;-1, -1&#125;;    &#125;&#125;</code></pre><h1 id="26- åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"><a href="#26- åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" class="headerlink" title="26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"></a>26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ </h1><p><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/"> é¢˜æºï¼š26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ª å‡åºæ’åˆ— çš„æ•°ç»„ nums ï¼Œè¯·ä½  åŸåœ° åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´  åªå‡ºç°ä¸€æ¬¡ ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚å…ƒç´ çš„ ç›¸å¯¹é¡ºåº åº”è¯¥ä¿æŒ ä¸€è‡´ ã€‚</p><p>ç”±äºåœ¨æŸäº›è¯­è¨€ä¸­ä¸èƒ½æ”¹å˜æ•°ç»„çš„é•¿åº¦ï¼Œæ‰€ä»¥å¿…é¡»å°†ç»“æœæ”¾åœ¨æ•°ç»„ nums çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚æ›´è§„èŒƒåœ°è¯´ï¼Œå¦‚æœåœ¨åˆ é™¤é‡å¤é¡¹ä¹‹åæœ‰ k ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆ nums çš„å‰ k ä¸ªå…ƒç´ åº”è¯¥ä¿å­˜æœ€ç»ˆç»“æœã€‚</p><p>å°†æœ€ç»ˆç»“æœæ’å…¥ nums çš„å‰ k ä¸ªä½ç½®åè¿”å› k ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p></blockquote><h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®å¿«ã€æ…¢æŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆåœ¨å‰ï¼Œæ…¢æŒ‡é’ˆåœ¨åï¼š<ul><li>å¿«æŒ‡é’ˆæ¯æ‰¾åˆ°ä¸€ä¸ªä¸æ…¢æŒ‡é’ˆä¸åŒçš„å…ƒç´ ï¼Œå°±è®©æ…¢æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€æ­¥å¹¶åœ¨å½“å‰ä½ç½®å…ƒç´ æ›¿æ¢ä¸ºå¿«æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ã€‚</li><li>å¿«æŒ‡é’ˆè‹¥æ‰¾ä¸åˆ°éé‡å¤å…ƒç´ ï¼Œåˆ™ä¸€ç›´å‘å‰ç§»åŠ¨ç›´è‡³æ•°ç»„æœ«å°¾ã€‚</li></ul></li></ul><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><ul><li><code>slow + 1</code> è¡¨ç¤ºæœ€ç»ˆè¿”å›çš„æ•°ç»„é•¿åº¦ä¸ºæ…¢æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ æ•°ç»„ä¸‹æ ‡ + 1ã€‚</li></ul><pre><code class="java">class Solution &#123;    public int removeDuplicates(int[] nums) &#123;        if (nums.length == 0) return 0;        int slow = 0, fast = 0;        while (fast &lt; nums.length) &#123;            if (nums[fast] != nums[slow]) &#123;                slow++;                nums[slow] = nums[fast];            &#125;            fast++;        &#125;        return slow + 1;    &#125;&#125;</code></pre><h1 id="27- ç§»é™¤å…ƒç´ "><a href="#27- ç§»é™¤å…ƒç´ " class="headerlink" title="27. ç§»é™¤å…ƒç´ "></a>27. ç§»é™¤å…ƒç´  </h1><p><a href="https://leetcode.cn/problems/remove-element/"> é¢˜æºï¼š27. ç§»é™¤å…ƒç´ </a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦ åŸåœ° ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚</p><p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p></blockquote><h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®å¿«æ…¢ã€æŒ‡é’ˆï¼š<ul><li>å¦‚æœå¿«æŒ‡é’ˆé‡åˆ°éœ€è¦å»é™¤çš„å…ƒç´ ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼›</li><li>å¦åˆ™å°±å‘Šè¯‰æ…¢æŒ‡é’ˆï¼Œå¹¶è®©æ…¢æŒ‡é’ˆå‰è¿›ä¸€æ­¥ã€‚</li></ul></li></ul><h2 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">class Solution &#123;    public int removeElement(int[] nums, int val) &#123;        int slow = 0, fast = 0;        while (fast &lt; nums.length) &#123;            if (nums[fast] != val) &#123;                nums[slow] = nums[fast];                slow++;            &#125;            fast++;        &#125;        return slow;    &#125;&#125;</code></pre><h1 id="283- ç§»åŠ¨é›¶"><a href="#283- ç§»åŠ¨é›¶" class="headerlink" title="283. ç§»åŠ¨é›¶"></a>283. ç§»åŠ¨é›¶ </h1><p><a href="https://leetcode.cn/problems/move-zeroes/"> é¢˜æºï¼š283. ç§»åŠ¨é›¶</a></p><blockquote><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code>ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ <code>0</code> ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><p><strong>è¯·æ³¨æ„</strong> ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚</p></blockquote><h2 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h2><p>å¯ä»¥ç›´æ¥å¤ç”¨ <a href="https://leetcode.cn/problems/remove-element">27. ç§»é™¤å…ƒç´ </a> çš„è§£æ³•ï¼Œå…ˆç§»é™¤æ‰€æœ‰ 0ï¼Œç„¶åæŠŠæœ€åçš„å…ƒç´ éƒ½ç½®ä¸º 0ï¼Œå°±ç›¸å½“äºç§»åŠ¨ 0 çš„æ•ˆæœã€‚</p><h2 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h2><ul><li>æ–°å¢æ–¹æ³• <code>removeElement()</code> ï¼Œç›´æ¥å¤ç”¨ <a href="https://leetcode.cn/problems/remove-element">27. ç§»é™¤å…ƒç´ </a> çš„è§£æ³•ã€‚</li></ul><pre><code class="java">class Solution &#123;    public void moveZeroes(int[] nums) &#123;        int p = removeElement(nums, 0);        for (; p &lt; nums.length; p++) &#123;            nums[p] = 0;        &#125;    &#125;    int removeElement(int[] nums, int val) &#123;        int fast = 0, slow = 0;        while (fast &lt; nums.length) &#123;            if (nums[fast] != val) &#123;                nums[slow] = nums[fast];                slow++;            &#125;            fast++;        &#125;        return slow;    &#125;&#125;</code></pre><h1 id="344- åè½¬å­—ç¬¦ä¸²"><a href="#344- åè½¬å­—ç¬¦ä¸²" class="headerlink" title="344. åè½¬å­—ç¬¦ä¸²"></a>344. åè½¬å­—ç¬¦ä¸² </h1><p><a href="https://leetcode.cn/problems/reverse-string/"> é¢˜æºï¼š344. åè½¬å­—ç¬¦ä¸²</a></p><blockquote><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ s çš„å½¢å¼ç»™å‡ºã€‚</p><p>ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p></blockquote><h2 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h2><ul><li>è®¾ç½®å·¦å³æŒ‡é’ˆï¼Œåˆ†åˆ«ä»å­—ç¬¦æ•°ç»„çš„ä¸¤ç«¯å¼€å§‹éå†å¹¶äº¤æ¢ã€‚</li></ul><h2 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h2><pre><code class="java">class Solution &#123;    public void reverseString(char[] s) &#123;        int l = 0, r = s.length - 1;        while (l &lt; r) &#123;            char temp = s[l];            s[l] = s[r];            s[r] = temp;            l++;            r--;        &#125;    &#125;&#125;</code></pre><h1 id="5- æœ€é•¿å›æ–‡å­ä¸²"><a href="#5- æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²"></a>5. æœ€é•¿å›æ–‡å­ä¸² </h1><p><a href="https://leetcode.cn/problems/longest-palindromic-substring/"> é¢˜æºï¼š5. æœ€é•¿å›æ–‡å­ä¸²</a></p><blockquote><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚</p><p>å¦‚æœå­—ç¬¦ä¸²çš„ååºä¸åŸå§‹å­—ç¬¦ä¸²ç›¸åŒï¼Œåˆ™è¯¥å­—ç¬¦ä¸²ç§°ä¸ºå›æ–‡å­—ç¬¦ä¸²ã€‚</p></blockquote><h2 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h2><ul><li>æ ¸å¿ƒæ€æƒ³ï¼šä»ä¸­é—´å¼€å§‹å‘ä¸¤è¾¹æ‰©æ•£æ¥åˆ¤æ–­å›æ–‡ä¸²</li></ul><pre><code>for 0 &lt;= i &lt; len(s):        æ‰¾åˆ°ä»¥ s[i] ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    æ›´æ–°ç­”æ¡ˆ</code></pre><ul><li>è®¾ç½®å·¦ã€å³æŒ‡é’ˆå¹¶å‘ä¸¤è¾¹æ‰©æ•£ï¼š</li></ul><pre><code>for 0 &lt;= i &lt; len(s):    # æ‰¾åˆ°ä»¥ s[i] ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    palindrome(s, i, i)    # æ‰¾åˆ°ä»¥ s[i] å’Œ s[i+1] ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    palindrome(s, i, i + 1)    æ›´æ–°ç­”æ¡ˆ</code></pre><h2 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h2><ul><li>æ–°å¢æ–¹æ³• <code>palindrome()</code> :<ul><li>while å¾ªç¯å†…æ¡ä»¶ï¼šé˜²æ­¢ç´¢å¼•è¶Šç•Œã€‚</li><li><code>return s.substring(l + 1, r);</code> è¿”å›ä»¥ s[l] å’Œ s[r] ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²ã€‚</li></ul></li><li>æ–¹æ³• <code>longestPalindrome()</code> ï¼š<ul><li><code>String s1 = palindrome(s, i, i);</code> ä»£è¡¨ä»¥ s[i] ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡å­ä¸² (é’ˆå¯¹å›æ–‡ä¸²é•¿åº¦ä¸ºå¥‡æ•°çš„æƒ…å†µ)ï¼›</li><li><code>String s2 = palindrome(s, i, i + 1);</code> ä»£è¡¨ä»¥ s[i] å’Œ s[i+1] ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡å­ä¸² (é’ˆå¯¹å›æ–‡ä¸²é•¿åº¦ä¸ºå¶æ•°çš„æƒ…å†µ)ã€‚</li></ul></li></ul><pre><code class="java">class Solution &#123;    public String longestPalindrome(String s) &#123;        String res = &quot;&quot;;        for (int i = 0; i &lt; s.length(); i++) &#123;            String s1 = palindrome(s, i, i);            String s2 = palindrome(s, i, i + 1);            res = res.length() &gt; s1.length() ? res : s1;            res = res.length() &gt; s2.length() ? res : s2;        &#125;        return res;    &#125;    String palindrome(String s, int l, int r) &#123;        while (l &gt;= 0 &amp;&amp; r &lt; s.length() &amp;&amp; s.charAt(l) == s.charAt(r)) &#123;            l--;            r++;        &#125;        return s.substring(l + 1, r);    &#125;&#125;</code></pre><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li><a href="https://labuladong.github.io/algo/di-yi-zhan-da78c/shou-ba-sh-48c1d/shuang-zhi-fa4bd/">labuladong çš„ç®—æ³•å°æŠ„ - åŒæŒ‡é’ˆæŠ€å·§ç§’æ€ä¸ƒé“æ•°ç»„é¢˜ç›®</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Algorithm </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
